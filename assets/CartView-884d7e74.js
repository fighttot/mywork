import{b as z,d as A,a as E,r as x,c as w,H as V,f as m,h as v,x as t,i as a,w as s,F as S,m as $,W as H,n as L,k as W,D as i,y as c,t as p,X,B as Y,Y as Z,l as n,Z as j,_ as G,$ as J,a0 as K,a1 as B}from"./index-045adae1.js";import{_ as O}from"./71b8e0fl_cL._AC_SL1500-811e8b6d.js";import{c as Q,a as q,u as ee,b as F,V as te}from"./index.esm-b759020b.js";import{V as ae}from"./VContainer-953a3727.js";import{V as le,a as g}from"./VRow-76dcefdf.js";/* empty css              */const oe={class:"othertitle"},se={class:"bgbox"},re=t("div",{class:"bgbox2"},null,-1),ne=t("h1",null,"購物車",-1),ue=t("thead",null,[t("tr",null,[t("th",null,"圖片"),t("th",null,"名稱"),t("th",null,"單價"),t("th",null,"數量"),t("th",null,"小記"),t("th",null,"操作")])],-1),ce={key:0,colspan:"6",class:"text-center"},_e={__name:"CartView",setup(de){const h=z(),N=A(),y=E(),r=x([]),d=x(!1),C=["萊爾富","7-11","全家"],f=async(o,l)=>{try{const{data:e}=await V.post("users/cart",{product:o,quantity:l}),u=r.value.findIndex(R=>R.product._id===o);r.value[u].quantity+=l,r.value[u].quantity<=0&&r.value.splice(u,1),y.cart=e.result}catch(e){console.log(e),h({text:e.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}},T=w(()=>r.value.length>0&&!r.value.some(o=>!o.product.sell)),U=w(()=>r.value.reduce((o,l)=>o+l.quantity*l.product.price,0));(async()=>{try{const{data:o}=await V.get("/users/cart");r.value.push(...o.result)}catch(o){h({text:o.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}})();const D=Q({seventhome:q().required("缺少製造商").test("地址錯誤",o=>C.includes(o)),paypoint:q().required("缺少店址")}),{handleSubmit:I,isSubmitting:M,handleReset:P}=ee({validationSchema:D}),_=F("seventhome"),b=F("paypoint"),k=I(async o=>{try{await V.post("/orders",{seventhome:o.seventhome+o.paypoint}),y.cart=0,N.push("/orders"),d.value=!1,P()}catch(l){h({text:l.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}});return(o,l)=>(m(),v(S,null,[t("section",oe,[t("div",se,[a($,{class:"mainimg",src:O,cover:""})]),re]),a(ae,null,{default:s(()=>[a(le,null,{default:s(()=>[a(g,{cols:"12"},{default:s(()=>[ne]),_:1}),a(g,{cols:"12"},{default:s(()=>[a(H,null,{default:s(()=>[ue,t("tbody",null,[(m(!0),v(S,null,L(r.value,e=>(m(),v("tr",{key:e._id,class:K({"bg-red-lighten-5":!e.product.sell})},[t("td",null,[a($,{src:e.product.images[0],cover:"","aspect-ratio":"1"},null,8,["src"])]),t("td",{style:B(`color: ${e.product.textColor};`)},i(e.product.name),5),t("td",{style:B(`background-color: ${e.product.color};`)},i(e.product.price),5),t("td",null,[a(c,{color:"primary",variant:"text",icon:"mdi-minus",onClick:u=>f(e.product._id,-1)},null,8,["onClick"]),p(" "+i(e.quantity)+" ",1),a(c,{color:"primary",variant:"text",icon:"mdi-plus",onClick:u=>f(e.product._id,1)},null,8,["onClick"])]),t("td",null,i(e.quantity*e.product.price),1),t("td",null,[a(c,{color:"red",variant:"text",icon:"mdi-delete",onClick:u=>f(e.product._id,e.quantity*-1)},null,8,["onClick"])])],2))),128)),t("tr",null,[r.value.length===0?(m(),v("td",ce,"沒有商品")):W("",!0)])])]),_:1})]),_:1}),a(g,{cols:"12",class:"text-center"},{default:s(()=>[t("p",null,"總金額:"+i(U.value),1),a(c,{color:"green",onClick:l[0]||(l[0]=e=>d.value=!0)},{default:s(()=>[p("結帳")]),_:1})]),_:1})]),_:1}),a(X,{modelValue:d.value,"onUpdate:modelValue":l[4]||(l[4]=e=>d.value=e),width:"400px",persistent:""},{default:s(()=>[a(Y,{class:"text-center"},{default:s(()=>[a(Z,null,{default:s(()=>[p("結帳資訊")]),_:1}),a(te,{disabled:n(M),onSubmit:j(n(k),["prevent"])},{default:s(()=>[a(G,{items:C,label:"便利商店貨到付款",modelValue:n(_).value.value,"onUpdate:modelValue":l[1]||(l[1]=e=>n(_).value.value=e),"error-messages":n(_).errorMessage.value},null,8,["modelValue","error-messages"]),a(J,{label:"哪一家店?",modelValue:n(b).value.value,"onUpdate:modelValue":l[2]||(l[2]=e=>n(b).value.value=e),"error-messages":n(b).errorMessage.value},null,8,["modelValue","error-messages"]),a(c,{color:"green",onClick:n(k),disabled:!T.value},{default:s(()=>[p("結帳")]),_:1},8,["onClick","disabled"]),a(c,{onClick:l[3]||(l[3]=e=>d.value=!1)},{default:s(()=>[p("取消")]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1})]),_:1},8,["modelValue"])]),_:1})],64))}};export{_e as default};

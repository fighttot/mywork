import{b as R,d as j,a as z,I as y,r as b,e as N,o as $,f as D,i as d,j as o,l as r,V as B,G as I,h as a,z as x,x as w,a1 as T,a3 as u}from"./index-351e7491.js";import{_ as G}from"./71b8e0fl_cL._AC_SL1500-811e8b6d.js";import{v as O}from"./index-7e70188e.js";import{c as H,a as i,d as J,u as K,b as m,V as L}from"./index.esm-8721e903.js";import{V as Q}from"./VContainer-34e2f640.js";import{V as F,a as h}from"./VRow-f0a9df4a.js";/* empty css              */const W={class:"editpass"},X={class:"othertitle"},Y={class:"bgbox"},Z=d("div",{class:"bgbox2"},null,-1),ee=d("h1",null,"修改會員資料",-1),ae={class:"text-center"},me={__name:"EditPass",setup(oe){const n=R(),M=j(),t=z(),S=H({account:i().required("帳號必填").min(4,"最少四個字").max(20,"最多20"),email:i().required("信箱必填").test("isEmail","信箱格式錯誤",s=>O.isEmail(s)),password:i().required("密碼必填").min(4,"最少四個字").max(20,"最多20"),passwordConfirm:i().required("密碼必填").min(4,"最少四個字").max(20,"最多20").oneOf([J("password")],"密碼不一致"),name:i().required("暱稱必填").max(10,"最多10")}),{handleSubmit:U,isSubmitting:P,handleReset:_}=K({validationSchema:S}),c=m("account"),p=m("email"),f=m("password"),V=m("passwordConfirm"),v=m("name"),q=U(async s=>{try{const{data:e}=await y.patch("/users/edit",{account:s.account,email:s.email,name:s.name,password:s.password});t.account=e.result.account,t.email=e.result.email,t.name=e.result.name,n({text:"修改成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom",rounded:"pill",variant:"tonal"}}),_(),M.push("/")}catch(e){n({text:e.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom",rounded:"pill",variant:"tonal"}})}}),g=b([]),C=b([]),k=b(null),A=async()=>{try{const s=new FormData;g.value.length>0&&s.append("image",g.value[0].file);const{data:e}=await y.post("/users/upimg",s);console.log(e.result),t.image=e.result,k.value.deleteFileRecord(),n({text:"大頭貼搞定",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom",rounded:"pill",variant:"tonal"}})}catch(s){n({text:s.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom",rounded:"pill",variant:"tonal"}})}};return(async()=>{try{c.value.value=t.account,p.value.value=t.email,v.value.value=t.name,t.loding=!1}catch(s){n({text:s.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom",rounded:"pill",variant:"tonal"}})}})(),(s,e)=>{const E=N("VueFileAgent");return $(),D("section",W,[d("section",X,[d("div",Y,[o(B,{class:"mainimg",src:G,cover:""})]),Z]),o(Q,null,{default:r(()=>[o(F,null,{default:r(()=>[o(h,{cols:"12",class:"text-center"},{default:r(()=>[ee]),_:1}),o(I),o(F,null,{default:r(()=>[o(h,{cols:"6",class:"ppopp"},{default:r(()=>[o(B,{src:a(t).image?a(t).image:a(t).avatar,style:{height:"200px",width:"200px","border-radius":"50%"},cover:""},null,8,["src"]),o(E,{modelValue:g.value,"onUpdate:modelValue":e[0]||(e[0]=l=>g.value=l),"raw-model-value":C.value,"onUpdate:rawModelValue":e[1]||(e[1]=l=>C.value=l),"max-files":1,"max-size":"1MB",accept:"image/jpg,image/jpeg,image/png",multiple:!1,"error-text":{type:"檔案格式錯誤",size:"檔案太大"},"help-text":"選擇檔案或拖放到這裡",deletable:"",ref_key:"fileAgent",ref:k},null,8,["modelValue","raw-model-value"]),o(x,{onClick:A},{default:r(()=>[w("送出大頭貼")]),_:1})]),_:1}),o(h,{cols:"6"},{default:r(()=>[o(L,{disabled:a(P),onSubmit:T(a(q),["prevent"])},{default:r(()=>[o(u,{modelValue:a(c).value.value,"onUpdate:modelValue":e[2]||(e[2]=l=>a(c).value.value=l),label:"帳號:",counter:"","max-length":"20","error-messages":a(c).errorMessage.value},null,8,["modelValue","error-messages"]),o(u,{modelValue:a(f).value.value,"onUpdate:modelValue":e[3]||(e[3]=l=>a(f).value.value=l),label:"密碼:",counter:"","max-length":"20",type:"password","error-messages":a(f).errorMessage.value},null,8,["modelValue","error-messages"]),o(u,{modelValue:a(V).value.value,"onUpdate:modelValue":e[4]||(e[4]=l=>a(V).value.value=l),label:"確認密碼:",counter:"","max-length":"20",type:"password","error-messages":a(V).errorMessage.value},null,8,["modelValue","error-messages"]),o(u,{modelValue:a(p).value.value,"onUpdate:modelValue":e[5]||(e[5]=l=>a(p).value.value=l),label:"信箱(不得重複):",type:"email","error-messages":a(p).errorMessage.value},null,8,["modelValue","error-messages"]),o(u,{modelValue:a(v).value.value,"onUpdate:modelValue":e[6]||(e[6]=l=>a(v).value.value=l),label:"暱稱(不得重複):",counter:"","max-length":"10","error-messages":a(v).errorMessage.value},null,8,["modelValue","error-messages"]),d("div",ae,[o(x,{type:"submit"},{default:r(()=>[w("修改會員資料")]),_:1}),o(x,{onClick:a(_)},{default:r(()=>[w("重製")]),_:1},8,["onClick"])])]),_:1},8,["disabled","onSubmit"])]),_:1})]),_:1})]),_:1})]),_:1})])}}};export{me as default};

import{b as z,d as A,a as E,r as x,c as P,H as w,o as G,e as J,f as u,h as k,x as t,i as l,w as s,m as T,F as I,X as K,Y as O,n as Q,k as m,D as f,y as c,t as d,Z as W,B as ee,_ as te,l as r,$ as ae,j as y,a0 as N,a1 as le,a2 as oe}from"./index-bd1cf992.js";import{c as se,a as S,u as re,b as B,V as ne}from"./index.esm-463ea2d4.js";import{F as ue}from"./FooTer-afa1b727.js";import{p as ie}from"./parallax-7986d7d8.js";import{V as ce}from"./VContainer-abffc603.js";import{V as de,a as $}from"./VRow-91ca0be0.js";/* empty css              */const pe=""+new URL("Zuikaku3-d1cccb77.jpg",import.meta.url).href,me={class:"cardview"},ve={class:"othertitle"},fe={class:"bgbox"},ye={class:"scene"},_e={class:"imgbox","data-depth":"-0.5"},he={class:"d-flex align-center justify-center fill-height"},ge=t("div",{class:"bgbox2"},null,-1),ke=t("h1",null,"購物車",-1),be=t("thead",null,[t("tr",null,[t("th",null,"圖片"),t("th",null,"名稱"),t("th",null,"單價"),t("th",null,"數量"),t("th",null,"小記"),t("th",null,"操作")])],-1),Ve={key:0,colspan:"6",class:"text-center"},Ue={__name:"CartView",setup(Ce){const _=z(),R=A(),q=E(),n=x([]),v=x(!1),i=x(!0),F=["萊爾富","7-11","全家"],X=["貨到付款現金","貨到付款刷卡"],b=async(o,a)=>{try{const{data:p}=await w.post("users/cart",{product:o,quantity:a}),e=n.value.findIndex(g=>g.product._id===o);n.value[e].quantity+=a,n.value[e].quantity<=0&&n.value.splice(e,1),q.cart=p.result}catch(p){console.log(p),_({text:p.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom",rounded:"pill",variant:"tonal"}})}},Y=P(()=>n.value.length>0&&!n.value.some(o=>!o.product.sell)),j=P(()=>n.value.reduce((o,a)=>o+a.quantity*a.product.price,0));(async()=>{try{const{data:o}=await w.get("/users/cart");n.value.push(...o.result)}catch(o){_({text:o.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom",rounded:"pill",variant:"tonal"}})}})();const D=se({seventhome:S().required("缺少製造商").test("地址錯誤",o=>F.includes(o)),paypoint:S().required("缺少店址"),payway:S().required("缺少付款方式")}),{handleSubmit:H,isSubmitting:L,handleReset:U}=re({validationSchema:D}),V=B("seventhome"),C=B("paypoint"),h=B("payway"),Z=()=>{h.value.value?i.value=!1:_({text:"請填寫付款方式",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom",rounded:"pill",variant:"tonal"}})},M=H(async o=>{try{await w.post("/orders",{seventhome:o.seventhome+o.paypoint,paywat:o.payway}),q.cart=0,R.push("/orders"),v.value=!1,i.value=!0,U()}catch(a){_({text:a.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom",rounded:"pill",variant:"tonal"}})}});return G(()=>{const o=document.querySelector(".scene");new ie(o,{scalarX:10,scalarY:10,frictionX:.1,frictionY:.1,limitX:100,limitY:100})}),(o,a)=>{const p=J("router-link");return u(),k(I,null,[t("section",me,[t("section",ve,[t("div",fe,[t("div",ye,[t("div",_e,[l(T,{class:"mainimg",src:pe,cover:""},{placeholder:s(()=>[t("div",he,[l(K,{color:"grey-lighten-4",indeterminate:""})])]),_:1})])])]),ge]),l(ce,null,{default:s(()=>[l(de,null,{default:s(()=>[l($,{cols:"12"},{default:s(()=>[ke]),_:1}),l($,{cols:"12",class:"cartheight"},{default:s(()=>[l(O,null,{default:s(()=>[be,t("tbody",null,[(u(!0),k(I,null,Q(n.value,e=>(u(),k("tr",{key:e._id,class:oe({"bg-red-lighten-5":!e.product.sell})},[t("td",null,[l(T,{src:e.product.images[0],cover:"","aspect-ratio":"1"},null,8,["src"])]),t("td",null,[l(p,{to:`/proHome/${e.product._id}`},{default:s(()=>[d(f(e.product.name),1)]),_:2},1032,["to"])]),t("td",null,f(e.product.price),1),t("td",null,[l(c,{color:"primary",variant:"text",icon:"mdi-minus",onClick:g=>b(e.product._id,-1)},null,8,["onClick"]),d(" "+f(e.quantity)+" ",1),l(c,{color:"primary",variant:"text",icon:"mdi-plus",onClick:g=>b(e.product._id,1)},null,8,["onClick"])]),t("td",null,f(e.quantity*e.product.price),1),t("td",null,[l(c,{color:"red",variant:"text",icon:"mdi-delete",onClick:g=>b(e.product._id,e.quantity*-1)},null,8,["onClick"])])],2))),128)),t("tr",null,[n.value.length===0?(u(),k("td",Ve,"沒有商品")):m("",!0)])])]),_:1})]),_:1}),l($,{cols:"12",class:"text-center"},{default:s(()=>[t("p",null,"總金額:"+f(j.value),1),l(c,{onClick:a[0]||(a[0]=e=>v.value=!0),color:"secondary"},{default:s(()=>[d("結帳")]),_:1})]),_:1})]),_:1}),l(W,{modelValue:v.value,"onUpdate:modelValue":a[6]||(a[6]=e=>v.value=e),width:"400px",persistent:""},{default:s(()=>[l(ee,{class:"text-center"},{default:s(()=>[l(te,null,{default:s(()=>[d("結帳資訊")]),_:1}),l(ne,{disabled:r(L),onSubmit:ae(r(M),["prevent"])},{default:s(()=>[i.value?m("",!0):(u(),y(N,{key:0,items:F,label:"便利商店貨到付款",modelValue:r(V).value.value,"onUpdate:modelValue":a[1]||(a[1]=e=>r(V).value.value=e),"error-messages":r(V).errorMessage.value},null,8,["modelValue","error-messages"])),i.value?(u(),y(N,{key:1,label:"付款方式?",modelValue:r(h).value.value,"onUpdate:modelValue":a[2]||(a[2]=e=>r(h).value.value=e),"error-messages":r(h).errorMessage.value,items:X},null,8,["modelValue","error-messages"])):m("",!0),i.value?m("",!0):(u(),y(le,{key:2,label:"哪一家店?",modelValue:r(C).value.value,"onUpdate:modelValue":a[3]||(a[3]=e=>r(C).value.value=e),"error-messages":r(C).errorMessage.value},null,8,["modelValue","error-messages"])),i.value?m("",!0):(u(),y(c,{key:3,onClick:a[4]||(a[4]=e=>i.value=!0)},{default:s(()=>[d("上一步")]),_:1})),i.value?(u(),y(c,{key:4,onClick:Z},{default:s(()=>[d("下一步")]),_:1})):m("",!0),l(c,{color:"green",onClick:r(M),disabled:!Y.value},{default:s(()=>[d("結帳")]),_:1},8,["onClick","disabled"]),l(c,{onClick:a[5]||(a[5]=e=>(v.value=!1,r(U)()))},{default:s(()=>[d("取消")]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),l(ue)],64)}}};export{Ue as default};

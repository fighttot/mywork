import{aX as pe,b as fe,a as ve,r as I,O as me,H as N,T as W,f as $,h as L,y as n,i as s,w as i,aY as ge,X as f,am as ye,F,m as g,p as X,U as J,D as k,Y as K,Z as Q,V as O,v as M,k as R,B as he,an as we,l as Z,C as be,j as ee}from"./index-8c99a16c.js";import{c as te,a as xe,u as ae,b as le,e as ke,V as oe}from"./index.esm-91eb1513.js";import{d as Ce,g as ue,c as Ee,e as Se,S as se,P as $e,A as _e,a as re}from"./effect-init-64cfb32b.js";import{e as Ve}from"./effect-target-a541ae49.js";import{V as ne}from"./VContainer-f147e01a.js";import{V as qe}from"./VNavigationDrawer-318961fc.js";import{V as G,a as U}from"./VRow-c4cfcf46.js";/* empty css              */function Le(D){let{swiper:t,extendParams:B,on:h,emit:y}=D;B({navigation:{nextEl:null,prevEl:null,hideOnClick:!1,disabledClass:"swiper-button-disabled",hiddenClass:"swiper-button-hidden",lockClass:"swiper-button-lock",navigationDisabledClass:"swiper-navigation-disabled"}}),t.navigation={nextEl:null,prevEl:null};const v=a=>(Array.isArray(a)?a:[a]).filter(o=>!!o);function E(a){let o;return a&&typeof a=="string"&&t.isElement&&(o=t.el.querySelector(a),o)?o:(a&&(typeof a=="string"&&(o=[...document.querySelectorAll(a)]),t.params.uniqueNavElements&&typeof a=="string"&&o.length>1&&t.el.querySelectorAll(a).length===1&&(o=t.el.querySelector(a))),a&&!o?a:o)}function C(a,o){const c=t.params.navigation;a=v(a),a.forEach(r=>{r&&(r.classList[o?"add":"remove"](...c.disabledClass.split(" ")),r.tagName==="BUTTON"&&(r.disabled=o),t.params.watchOverflow&&t.enabled&&r.classList[t.isLocked?"add":"remove"](c.lockClass))})}function w(){const{nextEl:a,prevEl:o}=t.navigation;if(t.params.loop){C(o,!1),C(a,!1);return}C(o,t.isBeginning&&!t.params.rewind),C(a,t.isEnd&&!t.params.rewind)}function P(a){a.preventDefault(),!(t.isBeginning&&!t.params.loop&&!t.params.rewind)&&(t.slidePrev(),y("navigationPrev"))}function b(a){a.preventDefault(),!(t.isEnd&&!t.params.loop&&!t.params.rewind)&&(t.slideNext(),y("navigationNext"))}function x(){const a=t.params.navigation;if(t.params.navigation=Ce(t,t.originalParams.navigation,t.params.navigation,{nextEl:"swiper-button-next",prevEl:"swiper-button-prev"}),!(a.nextEl||a.prevEl))return;let o=E(a.nextEl),c=E(a.prevEl);Object.assign(t.navigation,{nextEl:o,prevEl:c}),o=v(o),c=v(c);const r=(d,V)=>{d&&d.addEventListener("click",V==="next"?b:P),!t.enabled&&d&&d.classList.add(...a.lockClass.split(" "))};o.forEach(d=>r(d,"next")),c.forEach(d=>r(d,"prev"))}function T(){let{nextEl:a,prevEl:o}=t.navigation;a=v(a),o=v(o);const c=(r,d)=>{r.removeEventListener("click",d==="next"?b:P),r.classList.remove(...t.params.navigation.disabledClass.split(" "))};a.forEach(r=>c(r,"next")),o.forEach(r=>c(r,"prev"))}h("init",()=>{t.params.navigation.enabled===!1?_():(x(),w())}),h("toEdge fromEdge lock unlock",()=>{w()}),h("destroy",()=>{T()}),h("enable disable",()=>{let{nextEl:a,prevEl:o}=t.navigation;a=v(a),o=v(o),[...a,...o].filter(c=>!!c).forEach(c=>c.classList[t.enabled?"remove":"add"](t.params.navigation.lockClass))}),h("click",(a,o)=>{let{nextEl:c,prevEl:r}=t.navigation;c=v(c),r=v(r);const d=o.target;if(t.params.navigation.hideOnClick&&!r.includes(d)&&!c.includes(d)){if(t.pagination&&t.params.pagination&&t.params.pagination.clickable&&(t.pagination.el===d||t.pagination.el.contains(d)))return;let V;c.length?V=c[0].classList.contains(t.params.navigation.hiddenClass):r.length&&(V=r[0].classList.contains(t.params.navigation.hiddenClass)),y(V===!0?"navigationShow":"navigationHide"),[...c,...r].filter(e=>!!e).forEach(e=>e.classList.toggle(t.params.navigation.hiddenClass))}});const Y=()=>{t.el.classList.remove(...t.params.navigation.navigationDisabledClass.split(" ")),x(),w()},_=()=>{t.el.classList.add(...t.params.navigation.navigationDisabledClass.split(" ")),T()};Object.assign(t.navigation,{enable:Y,disable:_,update:w,init:x,destroy:T})}function ie(D,t,B){const h=`swiper-slide-shadow${B?`-${B}`:""}${D?` swiper-slide-shadow-${D}`:""}`,y=ue(t);let v=y.querySelector(`.${h.split(" ").join(".")}`);return v||(v=Ee("div",h.split(" ")),y.append(v)),v}function Be(D){let{swiper:t,extendParams:B,on:h}=D;B({coverflowEffect:{rotate:50,stretch:0,depth:100,scale:1,modifier:1,slideShadows:!0}}),Se({effect:"coverflow",swiper:t,on:h,setTranslate:()=>{const{width:E,height:C,slides:w,slidesSizesGrid:P}=t,b=t.params.coverflowEffect,x=t.isHorizontal(),T=t.translate,Y=x?-T+E/2:-T+C/2,_=x?b.rotate:-b.rotate,a=b.depth;for(let o=0,c=w.length;o<c;o+=1){const r=w[o],d=P[o],V=r.swiperSlideOffset,e=(Y-V-d/2)/d,m=typeof b.modifier=="function"?b.modifier(e):e*b.modifier;let j=x?_*m:0,p=x?0:_*m,u=-a*Math.abs(m),l=b.stretch;typeof l=="string"&&l.indexOf("%")!==-1&&(l=parseFloat(b.stretch)/100*d);let S=x?0:l*m,A=x?l*m:0,q=1-(1-b.scale)*Math.abs(m);Math.abs(A)<.001&&(A=0),Math.abs(S)<.001&&(S=0),Math.abs(u)<.001&&(u=0),Math.abs(j)<.001&&(j=0),Math.abs(p)<.001&&(p=0),Math.abs(q)<.001&&(q=0);const ce=`translate3d(${A}px,${S}px,${u}px)  rotateX(${p}deg) rotateY(${j}deg) scale(${q})`,de=Ve(b,r);if(de.style.transform=ce,r.style.zIndex=-Math.abs(Math.round(m))+1,b.slideShadows){let z=x?r.querySelector(".swiper-slide-shadow-left"):r.querySelector(".swiper-slide-shadow-top"),H=x?r.querySelector(".swiper-slide-shadow-right"):r.querySelector(".swiper-slide-shadow-bottom");z||(z=ie("coverflow",r,x?"left":"top")),H||(H=ie("coverflow",r,x?"right":"bottom")),z&&(z.style.opacity=m>0?m:0),H&&(H.style.opacity=-m>0?-m:0)}}},setTransition:E=>{t.slides.map(w=>ue(w)).forEach(w=>{w.style.transitionDuration=`${E}ms`,w.querySelectorAll(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").forEach(P=>{P.style.transitionDuration=`${E}ms`})})},perspective:()=>!0,overwriteParams:()=>({watchSlidesProgress:!0})})}const Pe={id:"proviewpage"},Te=n("h1",{class:"text-red"}," 已下架 ",-1),Me={class:"gastlike"},je={__name:"ProductView",setup(D){const t=[Be,$e,_e,Le],B=pe(),h=fe(),y=ve(),v=I(!1),E=I(!1),C=I(!1),w=I([]);me(C,()=>{C.value?(document.documentElement.style.overflow="hidden",document.documentElement.style.height="100vh"):(document.documentElement.style.overflow="auto",document.documentElement.style.height="")});const P=async(p,u)=>{console.log(e.value._id);try{await N.patch(`products/${e.value._id}/review`,{id:u}),e.value.peopleSay[p].review=!e.value.peopleSay[p].review}catch(l){console.log(l),h({text:l.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}},b=te({text:xe().required("缺少評論").min(10,"最少10個字").max(150,"最多150")}),{isSubmitting:x,handleSubmit:T,handleReset:Y}=ae({validationSchema:b}),_=le("text"),a=T(async p=>{try{if(e.value.peopleSay.findIndex(l=>l.user.account===y.account)>-1){const{data:l}=await N.patch(`products/${e.value._id}/say`,{text:p.text});e.value.peopleSay=l.result}else{const{data:l}=await N.post(`products/${e.value._id}/say`,{text:p.text});e.value.peopleSay=l.result,E.value=!0}Y(),v.value=!1}catch(u){h({text:u.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}}),o=te({quantity:ke().typeError("缺少數量").required("缺少數量").min(1,"最少1")}),{isSubmitting:c,handleSubmit:r}=ae({validationSchema:o,initialValues:{quantity:0}}),d=le("quantity"),V=r(async p=>{try{const{data:u}=await N.post("users/cart",{product:e.value._id,quantity:p.quantity});y.cart=u.result,d.value.value=0}catch(u){h({text:u.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}}),e=I({_id:"",name:"",price:"",images:[],description:"",category:"",manufacturers:"",sell:!0,color:"",textColor:"",totle:"",peopleSay:[]}),m=I(!1),j=async()=>{try{const{data:p}=await N.post("users/like",{product:e.value._id});y.like=p.result.length,e.value.totle=p.result.totle,(await N.post("/products/red",{app:e.value._id})).data.result?m.value=!0:m.value=!1}catch(p){h({text:p.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}};return(async()=>{try{const{data:p}=await W.get("/products/"+B.params.id);e.value=p.result,e.value.peopleSay.findIndex(q=>q.user.account===y.account)>-1&&(E.value=!0),(await N.post("/products/red",{app:e.value._id})).data.result?m.value=!0:m.value=!1;const{data:S}=await W.get("/products");w.value=S.result.filter(q=>q.category===p.result.category);const A=S.result.findIndex(q=>q._id===e.value._id);w.value.splice(A,1),document.title="購物網 |"+e.value.name}catch(p){h({text:p.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}})(),(p,u)=>($(),L(F,null,[n("section",Pe,[s(ne,null,{default:i(()=>[s(G,null,{default:i(()=>[s(U,{cols:"12"},{default:i(()=>[s(g(se),{pagination:{type:"fraction"},navigation:!0,modules:t,loop:!0,speed:3e3,autoplay:{delay:5e3,disableOnInteraction:!1},class:"mySwiper"},{default:i(()=>[($(!0),L(F,null,X(e.value.images,(l,S)=>($(),ee(g(re),{key:S},{default:i(()=>[s(Z,{src:l,cover:"",style:{width:"100%",height:"100%"}},null,8,["src"])]),_:2},1024))),128))]),_:1})]),_:1}),s(U,{cols:"12"},{default:i(()=>[s(G,null,{default:i(()=>[s(U,{cols:"6"},{default:i(()=>[s(J,{style:f(`color:${e.value.color}`),class:"mainveiw"},{default:i(()=>[n("thead",null,[n("tr",null,[n("th",{style:f(`color: ${e.value.color};`)},"作品名",4),n("td",null,k(e.value.name),1)]),n("tr",null,[n("th",{style:f(`color: ${e.value.color};`)},"分類",4),n("td",null,k(e.value.category),1)]),n("tr",null,[n("th",{style:f(`color: ${e.value.color};`)},"製造商",4),n("td",null,k(e.value.manufacturers),1)]),n("tr",null,[n("th",{style:f(`color: ${e.value.color};`)},"價格",4),n("td",null,k(e.value.price),1)])])]),_:1},8,["style"])]),_:1}),s(U,{style:f(`color: ${e.value.color};`),class:"txt"},{default:i(()=>[s(G,{class:"d-flex align-center flex-column justify-center",style:{"text-align":"center",height:"100%"}},{default:i(()=>[s(U,null,{default:i(()=>[n("p",null,k(e.value.description),1)]),_:1}),s(U,null,{default:i(()=>[s(oe,{disabled:g(c),onSubmit:K(g(V),["prevent"]),style:f(`border-bottom: 15px solid ${e.value.color};`),class:"underline"},{default:i(()=>[s(Q,{modelValue:g(d).value.value,"onUpdate:modelValue":u[0]||(u[0]=l=>g(d).value.value=l),modelModifiers:{number:!0},type:"number",label:"數量",min:"0","error-messages":g(d).errorMessage.value},null,8,["modelValue","error-messages"]),s(O,{style:f(`background-color:${e.value.color};color: ${e.value.textColor};`),type:"submit"},{default:i(()=>[M("加入購物車 ")]),_:1},8,["style"]),s(O,{style:f(`background-color:${m.value?e.value.textColor:e.value.color}; color:${m.value?e.value.color:e.value.textColor}`),onClick:j},{default:i(()=>[M(k(m.value?"已加收藏":"加入收藏"),1)]),_:1},8,["style"]),s(O,{style:f(`background-color:${e.value.color};color: ${e.value.textColor};`),onClick:u[1]||(u[1]=l=>C.value=!C.value)},{default:i(()=>[M(" 查看評論 ")]),_:1},8,["style"])]),_:1},8,["disabled","onSubmit","style"])]),_:1})]),_:1})]),_:1},8,["style"])]),_:1})]),_:1})]),_:1})]),_:1}),s(ge,{"model-value":!e.value.sell,persistent:"",class:"align-center justify-center text-center"},{default:i(()=>[Te,s(O,{to:"/"},{default:i(()=>[M(" 回上頁")]),_:1})]),_:1},8,["model-value"]),s(qe,{modelValue:C.value,"onUpdate:modelValue":u[3]||(u[3]=l=>C.value=l),location:"right",temporary:"",width:"700",style:f(`background-color:${e.value.color};`)},{default:i(()=>[n("div",null,[s(J,{style:f(`color:${e.value.textColor}; background-color:${e.value.color};`)},{default:i(()=>[n("thead",null,[n("tr",null,[n("th",{style:f(`color:${e.value.textColor};`)},"使用者",4),n("th",{style:f(`color:${e.value.textColor};`)},"評論",4),n("th",{style:f(`color:${e.value.textColor};`)},"日期",4),g(y).role===1?($(),L("th",{key:0,style:f(`color:${e.value.textColor};`)},"審核",4)):R("",!0)])]),n("tbody",null,[g(y).role===0?($(!0),L(F,{key:0},X(e.value.peopleSay,(l,S)=>($(),L("tr",{key:S},[l.review?R("",!0):($(),L(F,{key:0},[n("td",null,k(l.user.name),1),n("td",null,k(l.text),1),n("td",null,k(new Date(l.date).toLocaleString()),1)],64))]))),128)):R("",!0),g(y).role===1?($(!0),L(F,{key:1},X(e.value.peopleSay,(l,S)=>($(),L("tr",{key:S},[n("td",null,[s(Z,{style:{display:"inline-block","vertical-align":"middle"},src:`https://source.boringavatars.com/beam/120/${l.user.account}?colors=0db2ac,f5dd7e,fc8d4d,fc694d,faba32`,width:"50px"},null,8,["src"]),M(" "+k(l.user.name),1)]),n("td",null,k(l.text),1),n("td",null,k(new Date(l.date).toLocaleString()),1),n("td",null,[s(O,{onClick:A=>P(S,l.user._id),style:f(`background-color:${l.review?e.value.textColor:e.value.color}; color:${l.review?e.value.color:e.value.textColor}`)},{default:i(()=>[M(k(l.review?"未通過":"已通過"),1)]),_:2},1032,["onClick","style"])])]))),128)):R("",!0)])]),_:1},8,["style"])]),s(O,{onClick:u[2]||(u[2]=l=>v.value=!0),style:f(`background-color:${E.value?e.value.textColor:e.value.color}; color:${E.value?e.value.color:e.value.textColor}`),class:"otherbtn"},{default:i(()=>[M(k(E.value?"編輯評論":"新增評論"),1)]),_:1},8,["style"])]),_:1},8,["modelValue","style"]),s(ye,{modelValue:v.value,"onUpdate:modelValue":u[5]||(u[5]=l=>v.value=l),width:"auto"},{default:i(()=>[s(oe,{disabled:g(x),onSubmit:K(g(a),["prevent"]),style:{width:"400px"}},{default:i(()=>[s(he,{style:f(`background-color:${e.value.color};color: ${e.value.textColor};`)},{default:i(()=>[s(we,null,{default:i(()=>[s(Z,{src:g(y).avatar,style:{width:"20%",display:"inline-block"}},null,8,["src"]),n("span",null,k(g(y).name),1)]),_:1}),s(be,null,{default:i(()=>[s(Q,{modelValue:g(_).value.value,"onUpdate:modelValue":u[4]||(u[4]=l=>g(_).value.value=l),label:"留言",counter:"",maxlength:"150","error-messages":g(_).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),s(O,{type:"submit",class:"otherbtn"},{default:i(()=>[M(" 確認")]),_:1})]),_:1},8,["style"])]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])]),s(ne,null,{default:i(()=>[n("section",Me,[n("div",{class:"link",style:f(`border-bottom: 5px solid ${e.value.color};`)},[n("span",{style:f(`background-color:${e.value.color};color: ${e.value.textColor};`)}," 關聯商品",4)],4),s(g(se),{effect:"coverflow",grabCursor:!0,centeredSlides:!0,slidesPerView:"auto",coverflowEffect:{rotate:50,stretch:0,depth:100,modifier:1,slideShadows:!0},speed:2e3,pagination:!0,modules:t,class:"mySwiper",initialSlide:2},{default:i(()=>[($(!0),L(F,null,X(w.value,l=>($(),ee(g(re),{key:l._id},{default:i(()=>[s(Z,{src:l.images[0],cover:""},null,8,["src"])]),_:2},1024))),128))]),_:1})])]),_:1})],64))}};export{je as default};

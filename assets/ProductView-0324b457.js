import{a_ as fe,b as ve,a as me,r as O,P as ge,I,U as ye,W as Q,X as he,e as we,o as E,f as B,i as a,j as r,l as i,a$ as be,a5 as d,$ as xe,F,h,E as g,p as X,_ as ee,a1 as te,a3 as ae,z as W,x as D,m as H,C as Ce,a0 as ke,V as J,D as _e,k as le}from"./index-351e7491.js";import{c as oe,a as Se,u as se,b as re,e as $e,V as ne}from"./index.esm-8721e903.js";import{g as G}from"./index-4db78ffb.js";import{f as Ee,g as pe,c as Ve,e as Pe,S as Te,a as ie,P as Be,A as Le,b as ue}from"./effect-init-dcb02909.js";import{e as qe}from"./effect-target-1b4fee32.js";import{V as ce}from"./VContainer-34e2f640.js";import{V as Me}from"./VNavigationDrawer-2685a0db.js";import{V as K,a as z}from"./VRow-f0a9df4a.js";/* empty css              */function De(A){let{swiper:t,extendParams:q,on:f,emit:v}=A;q({navigation:{nextEl:null,prevEl:null,hideOnClick:!1,disabledClass:"swiper-button-disabled",hiddenClass:"swiper-button-hidden",lockClass:"swiper-button-lock",navigationDisabledClass:"swiper-navigation-disabled"}}),t.navigation={nextEl:null,prevEl:null};const y=l=>(Array.isArray(l)?l:[l]).filter(o=>!!o);function _(l){let o;return l&&typeof l=="string"&&t.isElement&&(o=t.el.querySelector(l),o)?o:(l&&(typeof l=="string"&&(o=[...document.querySelectorAll(l)]),t.params.uniqueNavElements&&typeof l=="string"&&o.length>1&&t.el.querySelectorAll(l).length===1&&(o=t.el.querySelector(l))),l&&!o?l:o)}function S(l,o){const p=t.params.navigation;l=y(l),l.forEach(n=>{n&&(n.classList[o?"add":"remove"](...p.disabledClass.split(" ")),n.tagName==="BUTTON"&&(n.disabled=o),t.params.watchOverflow&&t.enabled&&n.classList[t.isLocked?"add":"remove"](p.lockClass))})}function b(){const{nextEl:l,prevEl:o}=t.navigation;if(t.params.loop){S(o,!1),S(l,!1);return}S(o,t.isBeginning&&!t.params.rewind),S(l,t.isEnd&&!t.params.rewind)}function T(l){l.preventDefault(),!(t.isBeginning&&!t.params.loop&&!t.params.rewind)&&(t.slidePrev(),v("navigationPrev"))}function x(l){l.preventDefault(),!(t.isEnd&&!t.params.loop&&!t.params.rewind)&&(t.slideNext(),v("navigationNext"))}function C(){const l=t.params.navigation;if(t.params.navigation=Ee(t,t.originalParams.navigation,t.params.navigation,{nextEl:"swiper-button-next",prevEl:"swiper-button-prev"}),!(l.nextEl||l.prevEl))return;let o=_(l.nextEl),p=_(l.prevEl);Object.assign(t.navigation,{nextEl:o,prevEl:p}),o=y(o),p=y(p);const n=(m,L)=>{m&&m.addEventListener("click",L==="next"?x:T),!t.enabled&&m&&m.classList.add(...l.lockClass.split(" "))};o.forEach(m=>n(m,"next")),p.forEach(m=>n(m,"prev"))}function M(){let{nextEl:l,prevEl:o}=t.navigation;l=y(l),o=y(o);const p=(n,m)=>{n.removeEventListener("click",m==="next"?x:T),n.classList.remove(...t.params.navigation.disabledClass.split(" "))};l.forEach(n=>p(n,"next")),o.forEach(n=>p(n,"prev"))}f("init",()=>{t.params.navigation.enabled===!1?N():(C(),b())}),f("toEdge fromEdge lock unlock",()=>{b()}),f("destroy",()=>{M()}),f("enable disable",()=>{let{nextEl:l,prevEl:o}=t.navigation;l=y(l),o=y(o),[...l,...o].filter(p=>!!p).forEach(p=>p.classList[t.enabled?"remove":"add"](t.params.navigation.lockClass))}),f("click",(l,o)=>{let{nextEl:p,prevEl:n}=t.navigation;p=y(p),n=y(n);const m=o.target;if(t.params.navigation.hideOnClick&&!n.includes(m)&&!p.includes(m)){if(t.pagination&&t.params.pagination&&t.params.pagination.clickable&&(t.pagination.el===m||t.pagination.el.contains(m)))return;let L;p.length?L=p[0].classList.contains(t.params.navigation.hiddenClass):n.length&&(L=n[0].classList.contains(t.params.navigation.hiddenClass)),v(L===!0?"navigationShow":"navigationHide"),[...p,...n].filter(V=>!!V).forEach(V=>V.classList.toggle(t.params.navigation.hiddenClass))}});const U=()=>{t.el.classList.remove(...t.params.navigation.navigationDisabledClass.split(" ")),C(),b()},N=()=>{t.el.classList.add(...t.params.navigation.navigationDisabledClass.split(" ")),M()};Object.assign(t.navigation,{enable:U,disable:N,update:b,init:C,destroy:M})}function de(A,t,q){const f=`swiper-slide-shadow${q?`-${q}`:""}${A?` swiper-slide-shadow-${A}`:""}`,v=pe(t);let y=v.querySelector(`.${f.split(" ").join(".")}`);return y||(y=Ve("div",f.split(" ")),v.append(y)),y}function Ae(A){let{swiper:t,extendParams:q,on:f}=A;q({coverflowEffect:{rotate:50,stretch:0,depth:100,scale:1,modifier:1,slideShadows:!0}}),Pe({effect:"coverflow",swiper:t,on:f,setTranslate:()=>{const{width:_,height:S,slides:b,slidesSizesGrid:T}=t,x=t.params.coverflowEffect,C=t.isHorizontal(),M=t.translate,U=C?-M+_/2:-M+S/2,N=C?x.rotate:-x.rotate,l=x.depth;for(let o=0,p=b.length;o<p;o+=1){const n=b[o],m=T[o],L=n.swiperSlideOffset,V=(U-L-m/2)/m,$=typeof x.modifier=="function"?x.modifier(V):V*x.modifier;let e=C?N*$:0,P=C?0:N*$,j=-l*Math.abs($),u=x.stretch;typeof u=="string"&&u.indexOf("%")!==-1&&(u=parseFloat(x.stretch)/100*m);let c=C?0:u*$,w=C?u*$:0,s=1-(1-x.scale)*Math.abs($);Math.abs(w)<.001&&(w=0),Math.abs(c)<.001&&(c=0),Math.abs(j)<.001&&(j=0),Math.abs(e)<.001&&(e=0),Math.abs(P)<.001&&(P=0),Math.abs(s)<.001&&(s=0);const k=`translate3d(${w}px,${c}px,${j}px)  rotateX(${P}deg) rotateY(${e}deg) scale(${s})`,Z=qe(x,n);if(Z.style.transform=k,n.style.zIndex=-Math.abs(Math.round($))+1,x.slideShadows){let R=C?n.querySelector(".swiper-slide-shadow-left"):n.querySelector(".swiper-slide-shadow-top"),Y=C?n.querySelector(".swiper-slide-shadow-right"):n.querySelector(".swiper-slide-shadow-bottom");R||(R=de("coverflow",n,C?"left":"top")),Y||(Y=de("coverflow",n,C?"right":"bottom")),R&&(R.style.opacity=$>0?$:0),Y&&(Y.style.opacity=-$>0?-$:0)}}},setTransition:_=>{t.slides.map(b=>pe(b)).forEach(b=>{b.style.transitionDuration=`${_}ms`,b.querySelectorAll(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").forEach(T=>{T.style.transitionDuration=`${_}ms`})})},perspective:()=>!0,overwriteParams:()=>({watchSlidesProgress:!0})})}const Ne={id:"proviewpage"},Oe=a("br",null,null,-1),Ie=a("br",null,null,-1),Fe=a("br",null,null,-1),We=a("br",null,null,-1),ze=a("h1",{class:"text-red"}," 已下架 ",-1),Ue=a("td",null,"管理員審核中",-1),je={class:"gastlike"},He=a("div",{style:{"text-align":"center",margin:"10px 0 20px 0",color:"#e2b749","text-shadow":"2px 2px 5px #000000"}}," Copyright © PFSK. All figure in here. ",-1),tt={__name:"ProductView",setup(A){const t=[Ae,Be,Le,De],q=fe(),f=ve(),v=me(),y=O(!1),_=O(!1),S=O(!1),b=O([]);ge(S,()=>{S.value?(document.documentElement.style.overflow="hidden",document.documentElement.style.height="100vh"):(document.documentElement.style.overflow="auto",document.documentElement.style.height="")});const T=O(0),x=()=>{S.value=!0;const u=window.innerWidth;u>1200?T.value=600:T.value=u/2},C=async(u,c)=>{try{await I.patch(`products/${e.value._id}/review`,{id:c}),e.value.peopleSay[u].review=!e.value.peopleSay[u].review}catch(w){console.log(w),f({text:w.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}},M=oe({text:Se().required("缺少評論").min(10,"最少10個字").max(150,"最多150")}),{isSubmitting:U,handleSubmit:N,handleReset:l}=se({validationSchema:M}),o=re("text"),p=N(async u=>{try{if(e.value.peopleSay.findIndex(w=>w.user.account===v.account)>-1){const{data:w}=await I.patch(`products/${e.value._id}/say`,{text:u.text});e.value.peopleSay=w.result}else{const{data:w}=await I.post(`products/${e.value._id}/say`,{text:u.text});e.value.peopleSay=w.result,_.value=!0}l(),y.value=!1,f({text:"成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom",rounded:"pill",variant:"tonal"}})}catch(c){c.response.data.message==="缺少JWT"?f({text:"請登入或加入會員",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom",rounded:"pill",variant:"tonal"}}):f({text:c.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom",rounded:"pill"}})}}),n=oe({quantity:$e().typeError("缺少數量").required("缺少數量").min(1,"最少1")}),{isSubmitting:m,handleSubmit:L}=se({validationSchema:n,initialValues:{quantity:0}}),V=re("quantity"),$=L(async u=>{try{const{data:c}=await I.post("users/cart",{product:e.value._id,quantity:u.quantity});v.cart=c.result,V.value.value=0,f({text:"加入成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom",rounded:"pill",variant:"tonal"}})}catch(c){c.response.data.message==="缺少JWT"?f({text:"請登入或加入會員",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom",rounded:"pill",variant:"tonal"}}):f({text:c.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom",rounded:"pill"}})}}),e=O({_id:"",name:"",price:"",images:[],description:"",category:"",manufacturers:"",sell:!0,color:"",textColor:"",totle:"",peopleSay:[]}),P=O(!1),j=async()=>{try{const{data:u}=await I.post("users/like",{product:e.value._id});v.like=u.result.length,e.value.totle=u.result.totle,(await I.post("/products/red",{app:e.value._id})).data.result?P.value=!0:P.value=!1,f({text:"操作成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom",rounded:"pill",variant:"tonal"}})}catch(u){u.response.data.message==="缺少JWT"?f({text:"請登入或加入會員",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom",rounded:"pill",variant:"tonal"}}):f({text:u.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom",rounded:"pill"}})}};return G.registerPlugin(Te),ye(async()=>{try{const{data:u}=await Q.get("/products/"+q.params.id);e.value=u.result,e.value.peopleSay.findIndex(k=>k.user.account===v.account)>-1&&(_.value=!0),v.isLogin&&((await I.post("/products/red",{app:e.value._id})).data.result?P.value=!0:P.value=!1);const{data:w}=await Q.get("/products");b.value=w.result.filter(k=>k.category===u.result.category);const s=w.result.findIndex(k=>k._id===e.value._id);b.value.splice(s,1),document.title="購物網 |"+e.value.name,v.loding=!1}catch(u){console.log(u),f({text:u.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}await he(),G.from(".animationtable",{scrollTrigger:{trigger:".animationtable",start:"top 60%",end:"bottom center"},x:100,opacity:0,duration:2,ease:"none"}),G.from(".animationfield",{scrollTrigger:{trigger:".animationfield",start:"top 60%",end:"bottom center"},opacity:0,duration:1,ease:"none"}),G.from(".gastlike",{scrollTrigger:{trigger:".gastlike",start:"top 70%",end:"bottom center"},y:-50,opacity:0,duration:3,ease:"none"})}),(u,c)=>{const w=we("RouterLink");return E(),B(F,null,[a("section",Ne,[r(ce,null,{default:i(()=>[r(K,null,{default:i(()=>[r(z,{cols:"12"},{default:i(()=>[r(h(ie),{pagination:{type:"fraction"},navigation:!0,modules:t,loop:!0,speed:3e3,autoplay:{delay:5e3,disableOnInteraction:!1},class:"mySwiper"},{default:i(()=>[a("section",{class:"trantext",style:d(`border-left: 1px solid ${e.value.textColor};`)},[a("span",{style:d(`color:${e.value.textColor}`)},g(e.value.name),5),Oe,a("span",{style:d(`color:${e.value.textColor}`)},g(e.value.category),5),Ie,Fe,a("span",{style:d(`color:${e.value.textColor}`)},"$"+g(e.value.price),5),We,a("span",{style:d(`color:${e.value.textColor}`)},g(e.value.manufacturers),5)],4),(E(!0),B(F,null,X(e.value.images,(s,k)=>(E(),le(h(ue),{key:k},{default:i(()=>[r(J,{src:s,cover:"",style:{width:"100%",height:"100%"}},null,8,["src"])]),_:2},1024))),128))]),_:1})]),_:1}),r(z,{cols:"12"},{default:i(()=>[r(K,null,{default:i(()=>[r(z,{cols:"6",class:"animationtable"},{default:i(()=>[r(ee,{style:d(`color:${e.value.color}`),class:"mainveiw"},{default:i(()=>[a("thead",null,[a("tr",null,[a("th",{style:d(`color: ${e.value.color};`)},"作品名",4),a("td",null,g(e.value.name),1)]),a("tr",null,[a("th",{style:d(`color: ${e.value.color};`)},"分類",4),a("td",null,g(e.value.category),1)]),a("tr",null,[a("th",{style:d(`color: ${e.value.color};`)},"製造商",4),a("td",null,g(e.value.manufacturers),1)]),a("tr",null,[a("th",{style:d(`color: ${e.value.color};`)},"價格",4),a("td",null,g(e.value.price),1)])])]),_:1},8,["style"])]),_:1}),r(z,{style:d(`color: ${e.value.color};`),class:"txt"},{default:i(()=>[r(K,{class:"d-flex align-center flex-column justify-center animationfield",style:{"text-align":"center",height:"100%"}},{default:i(()=>[r(z,null,{default:i(()=>[a("p",null,g(e.value.description),1)]),_:1}),r(z,null,{default:i(()=>[r(ne,{disabled:h(m),onSubmit:te(h($),["prevent"]),style:d(`border-bottom: 15px solid ${e.value.color};`),class:"underline"},{default:i(()=>[r(ae,{modelValue:h(V).value.value,"onUpdate:modelValue":c[0]||(c[0]=s=>h(V).value.value=s),modelModifiers:{number:!0},type:"number",label:"數量",min:"0","error-messages":h(V).errorMessage.value},null,8,["modelValue","error-messages"]),r(W,{style:d(`background-color:${e.value.color};color: ${e.value.textColor};`),type:"submit"},{default:i(()=>[D("加購物車 ")]),_:1},8,["style"]),r(W,{style:d(`background-color:${P.value?e.value.textColor:e.value.color}; color:${P.value?e.value.color:e.value.textColor}`),onClick:j},{default:i(()=>[D(g(P.value?"已加收藏":"加入收藏"),1)]),_:1},8,["style"]),r(W,{style:d(`background-color:${e.value.color};color: ${e.value.textColor};`),onClick:x},{default:i(()=>[D(" 查看評論 ")]),_:1},8,["style"])]),_:1},8,["disabled","onSubmit","style"])]),_:1})]),_:1})]),_:1},8,["style"])]),_:1})]),_:1})]),_:1})]),_:1}),r(be,{"model-value":!e.value.sell,persistent:"",class:"align-center justify-center text-center"},{default:i(()=>[ze,r(W,{to:"/"},{default:i(()=>[D(" 回上頁")]),_:1})]),_:1},8,["model-value"]),r(Me,{modelValue:S.value,"onUpdate:modelValue":c[2]||(c[2]=s=>S.value=s),location:"right",temporary:"",width:T.value,style:d(`background-color:${e.value.color};`)},{default:i(()=>[a("div",null,[r(ee,{style:d(`color:${e.value.textColor}; background-color:${e.value.color};`)},{default:i(()=>[a("thead",null,[a("tr",null,[a("th",{style:d(`color:${e.value.textColor};`)},"使用者",4),a("th",{style:d(`color:${e.value.textColor};`)},"評論",4),a("th",{style:d(`color:${e.value.textColor};`)},"日期",4),h(v).role===1?(E(),B("th",{key:0,style:d(`color:${e.value.textColor};`)},"審核",4)):H("",!0)])]),a("tbody",null,[h(v).role===0?(E(!0),B(F,{key:0},X(e.value.peopleSay,(s,k)=>(E(),B("tr",{key:k},[s.review?H("",!0):(E(),B(F,{key:0},[a("td",null,g(s.user.name),1),a("td",null,g(s.text),1),a("td",null,g(new Date(s.date).toLocaleString()),1)],64)),s.review?(E(),B(F,{key:1},[a("td",null,g(s.user.name),1),Ue,a("td",null,g(new Date(s.date).toLocaleString()),1)],64)):H("",!0)]))),128)):H("",!0),h(v).role===1?(E(!0),B(F,{key:1},X(e.value.peopleSay,(s,k)=>(E(),B("tr",{key:k},[a("td",null,[r(J,{style:{display:"inline-block","vertical-align":"middle","border-radius":"50%"},src:h(v).image?s.user.image:`https://source.boringavatars.com/beam/120/${s.user.account}?colors=0db2ac,f5dd7e,fc8d4d,fc694d,faba32`,width:"50px",cover:""},null,8,["src"]),D(" "+g(s.user.name),1)]),a("td",null,g(s.text),1),a("td",null,g(new Date(s.date).toLocaleString()),1),a("td",null,[r(W,{onClick:Z=>C(k,s.user._id),style:d(`background-color:${s.review?e.value.textColor:e.value.color}; color:${s.review?e.value.color:e.value.textColor}`)},{default:i(()=>[D(g(s.review?"未通過":"已通過"),1)]),_:2},1032,["onClick","style"])])]))),128)):H("",!0)])]),_:1},8,["style"])]),r(W,{onClick:c[1]||(c[1]=s=>y.value=!0),style:d(`background-color:${_.value?e.value.textColor:e.value.color}; color:${_.value?e.value.color:e.value.textColor}`),class:"otherbtn"},{default:i(()=>[D(g(_.value?"編輯評論":"新增評論"),1)]),_:1},8,["style"])]),_:1},8,["modelValue","width","style"]),r(xe,{modelValue:y.value,"onUpdate:modelValue":c[4]||(c[4]=s=>y.value=s),width:"auto"},{default:i(()=>[r(ne,{disabled:h(U),onSubmit:te(h(p),["prevent"]),style:{width:"400px"}},{default:i(()=>[r(Ce,{style:d(`background-color:${e.value.color};color: ${e.value.textColor};`)},{default:i(()=>[r(ke,null,{default:i(()=>[r(J,{src:h(v).avatar,style:{width:"20%",display:"inline-block"}},null,8,["src"]),a("span",null,g(h(v).name),1)]),_:1}),r(_e,null,{default:i(()=>[r(ae,{modelValue:h(o).value.value,"onUpdate:modelValue":c[3]||(c[3]=s=>h(o).value.value=s),label:"留言",counter:"",maxlength:"150","error-messages":h(o).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),r(W,{type:"submit",class:"otherbtn",style:d(`background-color:${e.value.textColor};color: ${e.value.color};`)},{default:i(()=>[D(" 確認")]),_:1},8,["style"])]),_:1},8,["style"])]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])]),r(ce,null,{default:i(()=>[a("section",je,[a("div",{class:"link",style:d(`border-bottom: 5px solid ${e.value.color};`)},[a("span",{style:d(`background-color:${e.value.color};color: ${e.value.textColor};`)}," 關聯商品",4)],4),r(h(ie),{effect:"coverflow",grabCursor:!0,centeredSlides:!0,slidesPerView:"auto",coverflowEffect:{rotate:50,stretch:0,depth:100,modifier:1,slideShadows:!0},speed:2e3,pagination:!0,modules:t,class:"mySwiper",initialSlide:2},{default:i(()=>[(E(!0),B(F,null,X(b.value,s=>(E(),le(h(ue),{key:s._id},{default:i(()=>[r(w,{to:/proHome/+s._id},{default:i(()=>[r(J,{src:s.images[0],cover:""},null,8,["src"])]),_:2},1032,["to"])]),_:2},1024))),128))]),_:1})])]),_:1}),He],64)}}};export{tt as default};

import{b5 as R,b as z,a as A,r as x,b6 as H,H as v,T as O,f as d,h as p,i as a,w as r,b7 as X,U as Y,am as Z,V as y,F as g,X as $,y as s,D as u,p as C,m as n,Y as q,Z as D,v as m,k,B as G,an as J,l as B,C as K,j as Q}from"./index-31ac7712.js";import{c as W,e as ee,u as te,b as ae,V as T}from"./index.esm-e8240ee2.js";import{V as le}from"./VContainer-d6a65531.js";import{V as oe,a as F}from"./VRow-f96e4da1.js";/* empty css              */const se=s("h1",{class:"text-red"}," 已下架 ",-1),re=s("th",null,"使用者",-1),ue=s("th",null,"評論",-1),ne=s("th",null,"日期",-1),ce={key:0},be={__name:"ProductView",setup(de){const E=R(),b=z(),c=A(),h=x(!1),w=x(!1);x(""),app.value=12;const _=H({text:""}),P=async(l,o)=>{console.log(t.value._id);try{await v.patch(`products/${t.value._id}/review`,{id:o}),t.value.peopleSay[l].review=!t.value.peopleSay[l].review}catch(e){console.log(e),b({text:e.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}},S={required:l=>!!l||"欄位必填",min:l=>l.length>=10||"長度必須大於 10 個字",max:l=>l.length<=150||"長度必須小於 150 個字"},L=async l=>{try{if(t.value.peopleSay.findIndex(e=>e.user.account===c.account)>-1){const{data:e}=await v.patch(`products/${t.value._id}/say`,{text:_.text});t.value.peopleSay=e.result}else{const{data:e}=await v.post(`products/${t.value._id}/say`,{text:_.text});t.value.peopleSay=e.result,w.value=!0}_.text="",h.value=!1}catch(o){b({text:o.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}},U=W({quantity:ee().typeError("缺少數量").required("缺少數量").min(1,"最少1")}),{isSubmitting:N,handleSubmit:I}=te({validationSchema:U,initialValues:{quantity:0}}),V=ae("quantity"),M=I(async l=>{try{const{data:o}=await v.post("users/cart",{product:t.value._id,quantity:l.quantity});c.cart=o.result,V.value.value=0}catch(o){b({text:o.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}}),t=x({_id:"",name:"",price:"",images:[],description:"",category:"",manufacturers:"",sell:!0,color:"",textColor:"",totle:"",peopleSay:[]}),f=x("#F2E1D9"),j=async()=>{try{const{data:l}=await v.post("users/like",{product:t.value._id});c.like=l.result.length,t.value.totle=l.result.totle,(await v.post("/products/red",{app:t.value._id})).data.result?f.value="red":f.value="#F2E1D9"}catch(l){b({text:l.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}};return(async()=>{try{const{data:l}=await O.get("/products/"+E.params.id);t.value=l.result;const o=t.value.peopleSay.findIndex(i=>i.user.account===c.account);console.log(o),o>-1&&(w.value=!0),(await v.post("/products/red",{app:t.value._id})).data.result?f.value="red":f.value="#F2E1D9",document.title="購物網 |"+t.value.name}catch(l){b({text:l.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}})(),(l,o)=>(d(),p(g,null,[a(le,null,{default:r(()=>[a(oe,{style:$(`background-color: ${t.value.color};`)},{default:r(()=>[a(F,{cols:"12"},{default:r(()=>[s("h1",{style:$(`color: ${t.value.textColor};`)},u(t.value.name),5)]),_:1}),a(F,{cols:"12"},{default:r(()=>[(d(!0),p(g,null,C(t.value.images,(e,i)=>(d(),Q(B,{src:e,key:i},null,8,["src"]))),128))]),_:1}),a(F,{cols:"12"},{default:r(()=>[s("h1",null,u(t.value.price),1),s("pre",null,"有"+u(t.value.totle)+"人喜歡",1),s("pre",null,u(t.value.description),1),s("pre",null,u(t.value.category),1),s("pre",null,u(t.value.manufacturers),1),a(T,{disabled:n(N),onSubmit:q(n(M),["prevent"])},{default:r(()=>[a(D,{modelValue:n(V).value.value,"onUpdate:modelValue":o[0]||(o[0]=e=>n(V).value.value=e),modelModifiers:{number:!0},type:"number",label:"數量",min:"0","error-messages":n(V).errorMessage.value},null,8,["modelValue","error-messages"]),a(y,{type:"submit",color:"green"},{default:r(()=>[m("加入購物車")]),_:1}),a(y,{color:f.value,onClick:j},{default:r(()=>[m(u(f.value==="#F2E1D9"?"加入收藏":"已加收藏"),1)]),_:1},8,["color"])]),_:1},8,["disabled","onSubmit"])]),_:1})]),_:1},8,["style"])]),_:1}),a(X,{"model-value":!t.value.sell,persistent:"",class:"align-center justify-center text-center"},{default:r(()=>[se,a(y,{to:"/"},{default:r(()=>[m(" 回上頁")]),_:1})]),_:1},8,["model-value"]),a(Y,null,{default:r(()=>[s("thead",null,[s("tr",null,[re,ue,ne,n(c).role===1?(d(),p("th",ce,"審核")):k("",!0)])]),s("tbody",null,[n(c).role===0?(d(!0),p(g,{key:0},C(t.value.peopleSay,(e,i)=>(d(),p("tr",{key:i},[e.review?k("",!0):(d(),p(g,{key:0},[s("td",null,u(e.user.name),1),s("td",null,u(e.text),1),s("td",null,u(new Date(e.date).toLocaleString()),1)],64))]))),128)):k("",!0),n(c).role===1?(d(!0),p(g,{key:1},C(t.value.peopleSay,(e,i)=>(d(),p("tr",{key:i},[s("td",null,[a(B,{style:{display:"inline-block","vertical-align":"middle"},src:`https://source.boringavatars.com/beam/120/${e.user.account}?colors=0db2ac,f5dd7e,fc8d4d,fc694d,faba32`,width:"50px"},null,8,["src"]),m(" "+u(e.user.name),1)]),s("td",null,u(e.text),1),s("td",null,u(new Date(e.date).toLocaleString()),1),s("td",null,[a(y,{onClick:ie=>P(i,e.user._id)},{default:r(()=>[m(u(e.review?"未通過":"已通過"),1)]),_:2},1032,["onClick"])])]))),128)):k("",!0)])]),_:1}),a(Z,{modelValue:h.value,"onUpdate:modelValue":o[2]||(o[2]=e=>h.value=e),width:"auto"},{default:r(()=>[a(T,{onSubmit:q(L,["prevent"])},{default:r(()=>[a(G,null,{default:r(()=>[a(J,null,{default:r(()=>[a(B,{src:n(c).avatar},null,8,["src"]),m(u(n(c).name),1)]),_:1}),a(K,null,{default:r(()=>[a(D,{modelValue:_.text,"onUpdate:modelValue":o[1]||(o[1]=e=>_.text=e),label:"留言",counter:"",maxlength:"150",rules:[S.required,S.min,S.max]},null,8,["modelValue","rules"])]),_:1})]),_:1}),a(y,{type:"submit",color:"green"},{default:r(()=>[m("確認")]),_:1})]),_:1},8,["onSubmit"])]),_:1},8,["modelValue"]),a(y,{onClick:o[3]||(o[3]=e=>h.value=!0)},{default:r(()=>[m(u(w.value?"編輯評論":"新增評論"),1)]),_:1})],64))}};export{be as default};

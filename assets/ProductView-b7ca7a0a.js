import{a_ as fe,b as ve,a as me,r as O,O as ge,H as F,T as Q,o as ye,e as he,f as E,h as T,x as a,i as r,w as i,a$ as we,a3 as d,Z as be,F as I,l as h,D as m,n as J,Y as ee,$ as te,a1 as ae,y as H,t as D,k as U,B as xe,_ as Ce,m as X,C as ke,j as le}from"./index-3263188b.js";import{c as oe,a as _e,u as se,b as re,e as Se,V as ne}from"./index.esm-b8d713c1.js";import{g as Z}from"./index-4db78ffb.js";import{S as $e}from"./ScrollTrigger-c3252e56.js";import{d as Ee,g as pe,c as Ve,e as Be,S as ie,P as Pe,A as Te,a as ue}from"./effect-init-7dbc6119.js";import{e as Le}from"./effect-target-f4f9c74b.js";import{V as ce}from"./VContainer-2369b5fb.js";import{V as qe}from"./VNavigationDrawer-d7651aef.js";import{V as G,a as W}from"./VRow-dbeb81d2.js";/* empty css              */function Me(A){let{swiper:t,extendParams:q,on:f,emit:g}=A;q({navigation:{nextEl:null,prevEl:null,hideOnClick:!1,disabledClass:"swiper-button-disabled",hiddenClass:"swiper-button-hidden",lockClass:"swiper-button-lock",navigationDisabledClass:"swiper-navigation-disabled"}}),t.navigation={nextEl:null,prevEl:null};const y=l=>(Array.isArray(l)?l:[l]).filter(o=>!!o);function _(l){let o;return l&&typeof l=="string"&&t.isElement&&(o=t.el.querySelector(l),o)?o:(l&&(typeof l=="string"&&(o=[...document.querySelectorAll(l)]),t.params.uniqueNavElements&&typeof l=="string"&&o.length>1&&t.el.querySelectorAll(l).length===1&&(o=t.el.querySelector(l))),l&&!o?l:o)}function S(l,o){const p=t.params.navigation;l=y(l),l.forEach(n=>{n&&(n.classList[o?"add":"remove"](...p.disabledClass.split(" ")),n.tagName==="BUTTON"&&(n.disabled=o),t.params.watchOverflow&&t.enabled&&n.classList[t.isLocked?"add":"remove"](p.lockClass))})}function b(){const{nextEl:l,prevEl:o}=t.navigation;if(t.params.loop){S(o,!1),S(l,!1);return}S(o,t.isBeginning&&!t.params.rewind),S(l,t.isEnd&&!t.params.rewind)}function P(l){l.preventDefault(),!(t.isBeginning&&!t.params.loop&&!t.params.rewind)&&(t.slidePrev(),g("navigationPrev"))}function x(l){l.preventDefault(),!(t.isEnd&&!t.params.loop&&!t.params.rewind)&&(t.slideNext(),g("navigationNext"))}function C(){const l=t.params.navigation;if(t.params.navigation=Ee(t,t.originalParams.navigation,t.params.navigation,{nextEl:"swiper-button-next",prevEl:"swiper-button-prev"}),!(l.nextEl||l.prevEl))return;let o=_(l.nextEl),p=_(l.prevEl);Object.assign(t.navigation,{nextEl:o,prevEl:p}),o=y(o),p=y(p);const n=(v,L)=>{v&&v.addEventListener("click",L==="next"?x:P),!t.enabled&&v&&v.classList.add(...l.lockClass.split(" "))};o.forEach(v=>n(v,"next")),p.forEach(v=>n(v,"prev"))}function M(){let{nextEl:l,prevEl:o}=t.navigation;l=y(l),o=y(o);const p=(n,v)=>{n.removeEventListener("click",v==="next"?x:P),n.classList.remove(...t.params.navigation.disabledClass.split(" "))};l.forEach(n=>p(n,"next")),o.forEach(n=>p(n,"prev"))}f("init",()=>{t.params.navigation.enabled===!1?N():(C(),b())}),f("toEdge fromEdge lock unlock",()=>{b()}),f("destroy",()=>{M()}),f("enable disable",()=>{let{nextEl:l,prevEl:o}=t.navigation;l=y(l),o=y(o),[...l,...o].filter(p=>!!p).forEach(p=>p.classList[t.enabled?"remove":"add"](t.params.navigation.lockClass))}),f("click",(l,o)=>{let{nextEl:p,prevEl:n}=t.navigation;p=y(p),n=y(n);const v=o.target;if(t.params.navigation.hideOnClick&&!n.includes(v)&&!p.includes(v)){if(t.pagination&&t.params.pagination&&t.params.pagination.clickable&&(t.pagination.el===v||t.pagination.el.contains(v)))return;let L;p.length?L=p[0].classList.contains(t.params.navigation.hiddenClass):n.length&&(L=n[0].classList.contains(t.params.navigation.hiddenClass)),g(L===!0?"navigationShow":"navigationHide"),[...p,...n].filter(V=>!!V).forEach(V=>V.classList.toggle(t.params.navigation.hiddenClass))}});const j=()=>{t.el.classList.remove(...t.params.navigation.navigationDisabledClass.split(" ")),C(),b()},N=()=>{t.el.classList.add(...t.params.navigation.navigationDisabledClass.split(" ")),M()};Object.assign(t.navigation,{enable:j,disable:N,update:b,init:C,destroy:M})}function de(A,t,q){const f=`swiper-slide-shadow${q?`-${q}`:""}${A?` swiper-slide-shadow-${A}`:""}`,g=pe(t);let y=g.querySelector(`.${f.split(" ").join(".")}`);return y||(y=Ve("div",f.split(" ")),g.append(y)),y}function De(A){let{swiper:t,extendParams:q,on:f}=A;q({coverflowEffect:{rotate:50,stretch:0,depth:100,scale:1,modifier:1,slideShadows:!0}}),Be({effect:"coverflow",swiper:t,on:f,setTranslate:()=>{const{width:_,height:S,slides:b,slidesSizesGrid:P}=t,x=t.params.coverflowEffect,C=t.isHorizontal(),M=t.translate,j=C?-M+_/2:-M+S/2,N=C?x.rotate:-x.rotate,l=x.depth;for(let o=0,p=b.length;o<p;o+=1){const n=b[o],v=P[o],L=n.swiperSlideOffset,V=(j-L-v/2)/v,$=typeof x.modifier=="function"?x.modifier(V):V*x.modifier;let e=C?N*$:0,B=C?0:N*$,z=-l*Math.abs($),u=x.stretch;typeof u=="string"&&u.indexOf("%")!==-1&&(u=parseFloat(x.stretch)/100*v);let c=C?0:u*$,w=C?u*$:0,s=1-(1-x.scale)*Math.abs($);Math.abs(w)<.001&&(w=0),Math.abs(c)<.001&&(c=0),Math.abs(z)<.001&&(z=0),Math.abs(e)<.001&&(e=0),Math.abs(B)<.001&&(B=0),Math.abs(s)<.001&&(s=0);const k=`translate3d(${w}px,${c}px,${z}px)  rotateX(${B}deg) rotateY(${e}deg) scale(${s})`,K=Le(x,n);if(K.style.transform=k,n.style.zIndex=-Math.abs(Math.round($))+1,x.slideShadows){let Y=C?n.querySelector(".swiper-slide-shadow-left"):n.querySelector(".swiper-slide-shadow-top"),R=C?n.querySelector(".swiper-slide-shadow-right"):n.querySelector(".swiper-slide-shadow-bottom");Y||(Y=de("coverflow",n,C?"left":"top")),R||(R=de("coverflow",n,C?"right":"bottom")),Y&&(Y.style.opacity=$>0?$:0),R&&(R.style.opacity=-$>0?-$:0)}}},setTransition:_=>{t.slides.map(b=>pe(b)).forEach(b=>{b.style.transitionDuration=`${_}ms`,b.querySelectorAll(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").forEach(P=>{P.style.transitionDuration=`${_}ms`})})},perspective:()=>!0,overwriteParams:()=>({watchSlidesProgress:!0})})}const Ae={id:"proviewpage"},Ne=a("br",null,null,-1),Oe=a("br",null,null,-1),Fe=a("br",null,null,-1),Ie=a("br",null,null,-1),He=a("h1",{class:"text-red"}," 已下架 ",-1),We=a("td",null,"管理員審核中",-1),je={class:"gastlike"},ze=a("div",{style:{"text-align":"center",margin:"10px 0 20px 0",color:"#B8860B","text-shadow":"0px 0px 10px #000000"}}," Copyright © PFSK. All figure in here. ",-1),tt={__name:"ProductView",setup(A){const t=[De,Pe,Te,Me],q=fe(),f=ve(),g=me(),y=O(!1),_=O(!1),S=O(!1),b=O([]);ge(S,()=>{S.value?(document.documentElement.style.overflow="hidden",document.documentElement.style.height="100vh"):(document.documentElement.style.overflow="auto",document.documentElement.style.height="")});const P=O(0),x=()=>{S.value=!0;const u=window.innerWidth;u>1200?P.value=600:P.value=u/2},C=async(u,c)=>{console.log(e.value._id);try{await F.patch(`products/${e.value._id}/review`,{id:c}),e.value.peopleSay[u].review=!e.value.peopleSay[u].review}catch(w){console.log(w),f({text:w.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}},M=oe({text:_e().required("缺少評論").min(10,"最少10個字").max(150,"最多150")}),{isSubmitting:j,handleSubmit:N,handleReset:l}=se({validationSchema:M}),o=re("text"),p=N(async u=>{try{if(e.value.peopleSay.findIndex(w=>w.user.account===g.account)>-1){const{data:w}=await F.patch(`products/${e.value._id}/say`,{text:u.text});e.value.peopleSay=w.result}else{const{data:w}=await F.post(`products/${e.value._id}/say`,{text:u.text});e.value.peopleSay=w.result,_.value=!0}l(),y.value=!1,f({text:"成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom",rounded:"pill",variant:"tonal"}})}catch(c){c.response.data.message==="缺少JWT"?f({text:"請登入或加入會員",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom",rounded:"pill",variant:"tonal"}}):f({text:c.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom",rounded:"pill"}})}}),n=oe({quantity:Se().typeError("缺少數量").required("缺少數量").min(1,"最少1")}),{isSubmitting:v,handleSubmit:L}=se({validationSchema:n,initialValues:{quantity:0}}),V=re("quantity"),$=L(async u=>{try{const{data:c}=await F.post("users/cart",{product:e.value._id,quantity:u.quantity});g.cart=c.result,V.value.value=0,f({text:"加入成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom",rounded:"pill",variant:"tonal"}})}catch(c){c.response.data.message==="缺少JWT"?f({text:"請登入或加入會員",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom",rounded:"pill",variant:"tonal"}}):f({text:c.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom",rounded:"pill"}})}}),e=O({_id:"",name:"",price:"",images:[],description:"",category:"",manufacturers:"",sell:!0,color:"",textColor:"",totle:"",peopleSay:[]}),B=O(!1),z=async()=>{try{const{data:u}=await F.post("users/like",{product:e.value._id});g.like=u.result.length,e.value.totle=u.result.totle,(await F.post("/products/red",{app:e.value._id})).data.result?B.value=!0:B.value=!1,f({text:"操作成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom",rounded:"pill",variant:"tonal"}})}catch(u){u.response.data.message==="缺少JWT"?f({text:"請登入或加入會員",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom",rounded:"pill",variant:"tonal"}}):f({text:u.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom",rounded:"pill"}})}};return(async()=>{try{const{data:u}=await Q.get("/products/"+q.params.id);e.value=u.result,e.value.peopleSay.findIndex(k=>k.user.account===g.account)>-1&&(_.value=!0),g.isLogin&&((await F.post("/products/red",{app:e.value._id})).data.result?B.value=!0:B.value=!1);const{data:w}=await Q.get("/products");b.value=w.result.filter(k=>k.category===u.result.category);const s=w.result.findIndex(k=>k._id===e.value._id);b.value.splice(s,1),document.title="購物網 |"+e.value.name,g.loding=!1}catch(u){console.log(u),f({text:u.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}})(),Z.registerPlugin($e),ye(()=>{Z.from(".animationtable",{scrollTrigger:{trigger:".animationtable",start:"top 60%",end:"bottom center"},x:100,opacity:0,duration:2,ease:"none"}),Z.from(".animationfield",{scrollTrigger:{trigger:".animationfield",start:"top 60%",end:"bottom center"},opacity:0,duration:1,ease:"none"}),Z.from(".gastlike",{scrollTrigger:{trigger:".gastlike",start:"top 70%",end:"bottom center"},y:-50,opacity:0,duration:3,ease:"none"})}),(u,c)=>{const w=he("RouterLink");return E(),T(I,null,[a("section",Ae,[r(ce,null,{default:i(()=>[r(G,null,{default:i(()=>[r(W,{cols:"12"},{default:i(()=>[r(h(ie),{pagination:{type:"fraction"},navigation:!0,modules:t,loop:!0,speed:3e3,autoplay:{delay:5e3,disableOnInteraction:!1},class:"mySwiper"},{default:i(()=>[a("section",{class:"trantext",style:d(`border-left: 1px solid ${e.value.textColor};`)},[a("span",{style:d(`color:${e.value.textColor}`)},m(e.value.name),5),Ne,a("span",{style:d(`color:${e.value.textColor}`)},m(e.value.category),5),Oe,Fe,a("span",{style:d(`color:${e.value.textColor}`)},"$"+m(e.value.price),5),Ie,a("span",{style:d(`color:${e.value.textColor}`)},m(e.value.manufacturers),5)],4),(E(!0),T(I,null,J(e.value.images,(s,k)=>(E(),le(h(ue),{key:k},{default:i(()=>[r(X,{src:s,cover:"",style:{width:"100%",height:"100%"}},null,8,["src"])]),_:2},1024))),128))]),_:1})]),_:1}),r(W,{cols:"12"},{default:i(()=>[r(G,null,{default:i(()=>[r(W,{cols:"6",class:"animationtable"},{default:i(()=>[r(ee,{style:d(`color:${e.value.color}`),class:"mainveiw"},{default:i(()=>[a("thead",null,[a("tr",null,[a("th",{style:d(`color: ${e.value.color};`)},"作品名",4),a("td",null,m(e.value.name),1)]),a("tr",null,[a("th",{style:d(`color: ${e.value.color};`)},"分類",4),a("td",null,m(e.value.category),1)]),a("tr",null,[a("th",{style:d(`color: ${e.value.color};`)},"製造商",4),a("td",null,m(e.value.manufacturers),1)]),a("tr",null,[a("th",{style:d(`color: ${e.value.color};`)},"價格",4),a("td",null,m(e.value.price),1)])])]),_:1},8,["style"])]),_:1}),r(W,{style:d(`color: ${e.value.color};`),class:"txt"},{default:i(()=>[r(G,{class:"d-flex align-center flex-column justify-center animationfield",style:{"text-align":"center",height:"100%"}},{default:i(()=>[r(W,null,{default:i(()=>[a("p",null,m(e.value.description),1)]),_:1}),r(W,null,{default:i(()=>[r(ne,{disabled:h(v),onSubmit:te(h($),["prevent"]),style:d(`border-bottom: 15px solid ${e.value.color};`),class:"underline"},{default:i(()=>[r(ae,{modelValue:h(V).value.value,"onUpdate:modelValue":c[0]||(c[0]=s=>h(V).value.value=s),modelModifiers:{number:!0},type:"number",label:"數量",min:"0","error-messages":h(V).errorMessage.value},null,8,["modelValue","error-messages"]),r(H,{style:d(`background-color:${e.value.color};color: ${e.value.textColor};`),type:"submit"},{default:i(()=>[D("加購物車 ")]),_:1},8,["style"]),r(H,{style:d(`background-color:${B.value?e.value.textColor:e.value.color}; color:${B.value?e.value.color:e.value.textColor}`),onClick:z},{default:i(()=>[D(m(B.value?"已加收藏":"加入收藏"),1)]),_:1},8,["style"]),r(H,{style:d(`background-color:${e.value.color};color: ${e.value.textColor};`),onClick:x},{default:i(()=>[D(" 查看評論 ")]),_:1},8,["style"])]),_:1},8,["disabled","onSubmit","style"])]),_:1})]),_:1})]),_:1},8,["style"])]),_:1})]),_:1})]),_:1})]),_:1}),r(we,{"model-value":!e.value.sell,persistent:"",class:"align-center justify-center text-center"},{default:i(()=>[He,r(H,{to:"/"},{default:i(()=>[D(" 回上頁")]),_:1})]),_:1},8,["model-value"]),r(qe,{modelValue:S.value,"onUpdate:modelValue":c[2]||(c[2]=s=>S.value=s),location:"right",temporary:"",width:P.value,style:d(`background-color:${e.value.color};`)},{default:i(()=>[a("div",null,[r(ee,{style:d(`color:${e.value.textColor}; background-color:${e.value.color};`)},{default:i(()=>[a("thead",null,[a("tr",null,[a("th",{style:d(`color:${e.value.textColor};`)},"使用者",4),a("th",{style:d(`color:${e.value.textColor};`)},"評論",4),a("th",{style:d(`color:${e.value.textColor};`)},"日期",4),h(g).role===1?(E(),T("th",{key:0,style:d(`color:${e.value.textColor};`)},"審核",4)):U("",!0)])]),a("tbody",null,[h(g).role===0?(E(!0),T(I,{key:0},J(e.value.peopleSay,(s,k)=>(E(),T("tr",{key:k},[s.review?U("",!0):(E(),T(I,{key:0},[a("td",null,m(s.user.name),1),a("td",null,m(s.text),1),a("td",null,m(new Date(s.date).toLocaleString()),1)],64)),s.review?(E(),T(I,{key:1},[a("td",null,m(s.user.name),1),We,a("td",null,m(new Date(s.date).toLocaleString()),1)],64)):U("",!0)]))),128)):U("",!0),h(g).role===1?(E(!0),T(I,{key:1},J(e.value.peopleSay,(s,k)=>(E(),T("tr",{key:k},[a("td",null,[r(X,{style:{display:"inline-block","vertical-align":"middle"},src:`https://source.boringavatars.com/beam/120/${s.user.account}?colors=0db2ac,f5dd7e,fc8d4d,fc694d,faba32`,width:"50px"},null,8,["src"]),D(" "+m(s.user.name),1)]),a("td",null,m(s.text),1),a("td",null,m(new Date(s.date).toLocaleString()),1),a("td",null,[r(H,{onClick:K=>C(k,s.user._id),style:d(`background-color:${s.review?e.value.textColor:e.value.color}; color:${s.review?e.value.color:e.value.textColor}`)},{default:i(()=>[D(m(s.review?"未通過":"已通過"),1)]),_:2},1032,["onClick","style"])])]))),128)):U("",!0)])]),_:1},8,["style"])]),r(H,{onClick:c[1]||(c[1]=s=>y.value=!0),style:d(`background-color:${_.value?e.value.textColor:e.value.color}; color:${_.value?e.value.color:e.value.textColor}`),class:"otherbtn"},{default:i(()=>[D(m(_.value?"編輯評論":"新增評論"),1)]),_:1},8,["style"])]),_:1},8,["modelValue","width","style"]),r(be,{modelValue:y.value,"onUpdate:modelValue":c[4]||(c[4]=s=>y.value=s),width:"auto"},{default:i(()=>[r(ne,{disabled:h(j),onSubmit:te(h(p),["prevent"]),style:{width:"400px"}},{default:i(()=>[r(xe,{style:d(`background-color:${e.value.color};color: ${e.value.textColor};`)},{default:i(()=>[r(Ce,null,{default:i(()=>[r(X,{src:h(g).avatar,style:{width:"20%",display:"inline-block"}},null,8,["src"]),a("span",null,m(h(g).name),1)]),_:1}),r(ke,null,{default:i(()=>[r(ae,{modelValue:h(o).value.value,"onUpdate:modelValue":c[3]||(c[3]=s=>h(o).value.value=s),label:"留言",counter:"",maxlength:"150","error-messages":h(o).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),r(H,{type:"submit",class:"otherbtn",style:d(`background-color:${e.value.textColor};color: ${e.value.color};`)},{default:i(()=>[D(" 確認")]),_:1},8,["style"])]),_:1},8,["style"])]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])]),r(ce,null,{default:i(()=>[a("section",je,[a("div",{class:"link",style:d(`border-bottom: 5px solid ${e.value.color};`)},[a("span",{style:d(`background-color:${e.value.color};color: ${e.value.textColor};`)}," 關聯商品",4)],4),r(h(ie),{effect:"coverflow",grabCursor:!0,centeredSlides:!0,slidesPerView:"auto",coverflowEffect:{rotate:50,stretch:0,depth:100,modifier:1,slideShadows:!0},speed:2e3,pagination:!0,modules:t,class:"mySwiper",initialSlide:2},{default:i(()=>[(E(!0),T(I,null,J(b.value,s=>(E(),le(h(ue),{key:s._id},{default:i(()=>[r(w,{to:/proHome/+s._id},{default:i(()=>[r(X,{src:s.images[0],cover:""},null,8,["src"])]),_:2},1032,["to"])]),_:2},1024))),128))]),_:1})])]),_:1}),ze],64)}}};export{tt as default};

import{b as j,d as z,a as N,I as B,r as f,e as $,o as D,f as I,i as d,j as o,l as r,V as F,G as T,h as a,z as w,x as h,a1 as G,a3 as u}from"./index-3d872047.js";import{_ as O}from"./71b8e0fl_cL._AC_SL1500-811e8b6d.js";import{v as H}from"./index-8af97a6e.js";import{c as J,a as i,d as K,u as L,b as m,V as Q}from"./index.esm-abfa5011.js";import{V as W}from"./VContainer-d80bc377.js";import{V as M,a as _}from"./VRow-44ee2d34.js";/* empty css              */const X={class:"editpass"},Y={class:"othertitle"},Z={class:"bgbox"},ee=d("div",{class:"bgbox2"},null,-1),ae=d("h1",null,"修改會員資料",-1),oe={class:"text-center"},de={__name:"EditPass",setup(le){const n=j(),S=z(),t=N(),U=J({account:i().required("帳號必填").min(4,"最少四個字").max(20,"最多20"),email:i().required("信箱必填").test("isEmail","信箱格式錯誤",l=>H.isEmail(l)),password:i().required("密碼必填").min(4,"最少四個字").max(20,"最多20"),passwordConfirm:i().required("密碼必填").min(4,"最少四個字").max(20,"最多20").oneOf([K("password")],"密碼不一致"),name:i().required("暱稱必填").max(10,"最多10")}),{handleSubmit:P,isSubmitting:q,handleReset:C}=L({validationSchema:U}),c=m("account"),p=m("email"),V=m("password"),b=m("passwordConfirm"),v=m("name"),A=P(async l=>{try{const{data:e}=await B.patch("/users/edit",{account:l.account,email:l.email,name:l.name,password:l.password});t.account=e.result.account,t.email=e.result.email,t.name=e.result.name,n({text:"修改成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom",rounded:"pill",variant:"tonal"}}),C(),S.push("/")}catch(e){n({text:e.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom",rounded:"pill",variant:"tonal"}})}}),g=f([]),k=f([]),y=f(null),x=f(!1),E=async()=>{x.value=!0;try{const l=new FormData;g.value.length>0&&l.append("image",g.value[0].file);const{data:e}=await B.post("/users/upimg",l);console.log(e.result),t.image=e.result,y.value.deleteFileRecord(),n({text:"大頭貼搞定",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom",rounded:"pill",variant:"tonal"}})}catch(l){n({text:l.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom",rounded:"pill",variant:"tonal"}})}x.value=!1};return(async()=>{try{c.value.value=t.account,p.value.value=t.email,v.value.value=t.name,t.loding=!1}catch(l){n({text:l.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom",rounded:"pill",variant:"tonal"}})}})(),(l,e)=>{const R=$("VueFileAgent");return D(),I("section",X,[d("section",Y,[d("div",Z,[o(F,{class:"mainimg",src:O,cover:""})]),ee]),o(W,null,{default:r(()=>[o(M,null,{default:r(()=>[o(_,{cols:"12",class:"text-center"},{default:r(()=>[ae]),_:1}),o(T),o(M,null,{default:r(()=>[o(_,{cols:"6",class:"ppopp"},{default:r(()=>[o(F,{src:a(t).image?a(t).image:a(t).avatar,style:{height:"200px",width:"200px","border-radius":"50%"},cover:""},null,8,["src"]),o(R,{modelValue:g.value,"onUpdate:modelValue":e[0]||(e[0]=s=>g.value=s),"raw-model-value":k.value,"onUpdate:rawModelValue":e[1]||(e[1]=s=>k.value=s),"max-files":1,"max-size":"1MB",accept:"image/jpg,image/jpeg,image/png",multiple:!1,"error-text":{type:"檔案格式錯誤",size:"檔案太大"},"help-text":"選擇檔案或拖放到這裡",deletable:"",ref_key:"fileAgent",ref:y},null,8,["modelValue","raw-model-value"]),o(w,{onClick:E,loading:x.value},{default:r(()=>[h("送出大頭貼")]),_:1},8,["loading"])]),_:1}),o(_,{cols:"6"},{default:r(()=>[o(Q,{disabled:a(q),onSubmit:G(a(A),["prevent"])},{default:r(()=>[o(u,{modelValue:a(c).value.value,"onUpdate:modelValue":e[2]||(e[2]=s=>a(c).value.value=s),label:"帳號:",counter:"","max-length":"20","error-messages":a(c).errorMessage.value},null,8,["modelValue","error-messages"]),o(u,{modelValue:a(V).value.value,"onUpdate:modelValue":e[3]||(e[3]=s=>a(V).value.value=s),label:"密碼:",counter:"","max-length":"20",type:"password","error-messages":a(V).errorMessage.value},null,8,["modelValue","error-messages"]),o(u,{modelValue:a(b).value.value,"onUpdate:modelValue":e[4]||(e[4]=s=>a(b).value.value=s),label:"確認密碼:",counter:"","max-length":"20",type:"password","error-messages":a(b).errorMessage.value},null,8,["modelValue","error-messages"]),o(u,{modelValue:a(p).value.value,"onUpdate:modelValue":e[5]||(e[5]=s=>a(p).value.value=s),label:"信箱(不得重複):",type:"email","error-messages":a(p).errorMessage.value},null,8,["modelValue","error-messages"]),o(u,{modelValue:a(v).value.value,"onUpdate:modelValue":e[6]||(e[6]=s=>a(v).value.value=s),label:"暱稱(不得重複):",counter:"","max-length":"10","error-messages":a(v).errorMessage.value},null,8,["modelValue","error-messages"]),d("div",oe,[o(w,{type:"submit"},{default:r(()=>[h("修改會員資料")]),_:1}),o(w,{onClick:a(C)},{default:r(()=>[h("重製")]),_:1},8,["onClick"])])]),_:1},8,["disabled","onSubmit"])]),_:1})]),_:1})]),_:1})]),_:1})])}}};export{de as default};

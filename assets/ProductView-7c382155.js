import{a_ as fe,b as ve,a as me,r as O,P as ge,I,U as he,W as Q,X as ye,e as be,o as E,f as B,i as a,j as r,l as i,a$ as we,a5 as d,$ as xe,F,h as y,E as m,p as J,_ as ee,a1 as te,a3 as ae,z as W,x as L,m as R,C as _e,a0 as Ce,V as z,D as ke,k as oe}from"./index-71abbe5b.js";import{c as le,a as $e,u as se,b as re,e as Se,V as ne}from"./index.esm-81bb53e6.js";import{g as G}from"./index-4db78ffb.js";import{f as Ee,g as pe,c as Ve,e as Pe,S as Te,a as ie,P as Be,A as Le,b as ue}from"./effect-init-f6af5025.js";import{e as qe}from"./effect-target-6affadea.js";import{V as ce}from"./VContainer-818074d2.js";import{V as De}from"./VNavigationDrawer-90da6b61.js";import{V as K,a as U}from"./VRow-79a0383e.js";/* empty css              */function Me(A){let{swiper:t,extendParams:D,on:f,emit:g}=A;D({navigation:{nextEl:null,prevEl:null,hideOnClick:!1,disabledClass:"swiper-button-disabled",hiddenClass:"swiper-button-hidden",lockClass:"swiper-button-lock",navigationDisabledClass:"swiper-navigation-disabled"}}),t.navigation={nextEl:null,prevEl:null};const h=o=>(Array.isArray(o)?o:[o]).filter(s=>!!s);function k(o){let s;return o&&typeof o=="string"&&t.isElement&&(s=t.el.querySelector(o),s)?s:(o&&(typeof o=="string"&&(s=[...document.querySelectorAll(o)]),t.params.uniqueNavElements&&typeof o=="string"&&s.length>1&&t.el.querySelectorAll(o).length===1&&(s=t.el.querySelector(o))),o&&!s?o:s)}function $(o,s){const p=t.params.navigation;o=h(o),o.forEach(n=>{n&&(n.classList[s?"add":"remove"](...p.disabledClass.split(" ")),n.tagName==="BUTTON"&&(n.disabled=s),t.params.watchOverflow&&t.enabled&&n.classList[t.isLocked?"add":"remove"](p.lockClass))})}function w(){const{nextEl:o,prevEl:s}=t.navigation;if(t.params.loop){$(s,!1),$(o,!1);return}$(s,t.isBeginning&&!t.params.rewind),$(o,t.isEnd&&!t.params.rewind)}function T(o){o.preventDefault(),!(t.isBeginning&&!t.params.loop&&!t.params.rewind)&&(t.slidePrev(),g("navigationPrev"))}function x(o){o.preventDefault(),!(t.isEnd&&!t.params.loop&&!t.params.rewind)&&(t.slideNext(),g("navigationNext"))}function _(){const o=t.params.navigation;if(t.params.navigation=Ee(t,t.originalParams.navigation,t.params.navigation,{nextEl:"swiper-button-next",prevEl:"swiper-button-prev"}),!(o.nextEl||o.prevEl))return;let s=k(o.nextEl),p=k(o.prevEl);Object.assign(t.navigation,{nextEl:s,prevEl:p}),s=h(s),p=h(p);const n=(v,q)=>{v&&v.addEventListener("click",q==="next"?x:T),!t.enabled&&v&&v.classList.add(...o.lockClass.split(" "))};s.forEach(v=>n(v,"next")),p.forEach(v=>n(v,"prev"))}function M(){let{nextEl:o,prevEl:s}=t.navigation;o=h(o),s=h(s);const p=(n,v)=>{n.removeEventListener("click",v==="next"?x:T),n.classList.remove(...t.params.navigation.disabledClass.split(" "))};o.forEach(n=>p(n,"next")),s.forEach(n=>p(n,"prev"))}f("init",()=>{t.params.navigation.enabled===!1?N():(_(),w())}),f("toEdge fromEdge lock unlock",()=>{w()}),f("destroy",()=>{M()}),f("enable disable",()=>{let{nextEl:o,prevEl:s}=t.navigation;o=h(o),s=h(s),[...o,...s].filter(p=>!!p).forEach(p=>p.classList[t.enabled?"remove":"add"](t.params.navigation.lockClass))}),f("click",(o,s)=>{let{nextEl:p,prevEl:n}=t.navigation;p=h(p),n=h(n);const v=s.target;if(t.params.navigation.hideOnClick&&!n.includes(v)&&!p.includes(v)){if(t.pagination&&t.params.pagination&&t.params.pagination.clickable&&(t.pagination.el===v||t.pagination.el.contains(v)))return;let q;p.length?q=p[0].classList.contains(t.params.navigation.hiddenClass):n.length&&(q=n[0].classList.contains(t.params.navigation.hiddenClass)),g(q===!0?"navigationShow":"navigationHide"),[...p,...n].filter(V=>!!V).forEach(V=>V.classList.toggle(t.params.navigation.hiddenClass))}});const j=()=>{t.el.classList.remove(...t.params.navigation.navigationDisabledClass.split(" ")),_(),w()},N=()=>{t.el.classList.add(...t.params.navigation.navigationDisabledClass.split(" ")),M()};Object.assign(t.navigation,{enable:j,disable:N,update:w,init:_,destroy:M})}function de(A,t,D){const f=`swiper-slide-shadow${D?`-${D}`:""}${A?` swiper-slide-shadow-${A}`:""}`,g=pe(t);let h=g.querySelector(`.${f.split(" ").join(".")}`);return h||(h=Ve("div",f.split(" ")),g.append(h)),h}function Ae(A){let{swiper:t,extendParams:D,on:f}=A;D({coverflowEffect:{rotate:50,stretch:0,depth:100,scale:1,modifier:1,slideShadows:!0}}),Pe({effect:"coverflow",swiper:t,on:f,setTranslate:()=>{const{width:k,height:$,slides:w,slidesSizesGrid:T}=t,x=t.params.coverflowEffect,_=t.isHorizontal(),M=t.translate,j=_?-M+k/2:-M+$/2,N=_?x.rotate:-x.rotate,o=x.depth;for(let s=0,p=w.length;s<p;s+=1){const n=w[s],v=T[s],q=n.swiperSlideOffset,V=(j-q-v/2)/v,S=typeof x.modifier=="function"?x.modifier(V):V*x.modifier;let e=_?N*S:0,P=_?0:N*S,H=-o*Math.abs(S),u=x.stretch;typeof u=="string"&&u.indexOf("%")!==-1&&(u=parseFloat(x.stretch)/100*v);let c=_?0:u*S,b=_?u*S:0,l=1-(1-x.scale)*Math.abs(S);Math.abs(b)<.001&&(b=0),Math.abs(c)<.001&&(c=0),Math.abs(H)<.001&&(H=0),Math.abs(e)<.001&&(e=0),Math.abs(P)<.001&&(P=0),Math.abs(l)<.001&&(l=0);const C=`translate3d(${b}px,${c}px,${H}px)  rotateX(${P}deg) rotateY(${e}deg) scale(${l})`,Z=qe(x,n);if(Z.style.transform=C,n.style.zIndex=-Math.abs(Math.round(S))+1,x.slideShadows){let Y=_?n.querySelector(".swiper-slide-shadow-left"):n.querySelector(".swiper-slide-shadow-top"),X=_?n.querySelector(".swiper-slide-shadow-right"):n.querySelector(".swiper-slide-shadow-bottom");Y||(Y=de("coverflow",n,_?"left":"top")),X||(X=de("coverflow",n,_?"right":"bottom")),Y&&(Y.style.opacity=S>0?S:0),X&&(X.style.opacity=-S>0?-S:0)}}},setTransition:k=>{t.slides.map(w=>pe(w)).forEach(w=>{w.style.transitionDuration=`${k}ms`,w.querySelectorAll(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").forEach(T=>{T.style.transitionDuration=`${k}ms`})})},perspective:()=>!0,overwriteParams:()=>({watchSlidesProgress:!0})})}const Ne={id:"proviewpage"},Oe=a("br",null,null,-1),Ie=a("br",null,null,-1),Fe=a("br",null,null,-1),We=a("br",null,null,-1),ze=a("h1",{class:"text-red"}," 已下架 ",-1),Ue={class:"userimgTD"},je=a("br",null,null,-1),He={class:"userimgTD"},Re=a("br",null,null,-1),Ye=a("td",null,"管理員審核中",-1),Xe={class:"userimgTD"},Je=a("br",null,null,-1),Ge={class:"gastlike"},Ke=a("div",{style:{"text-align":"center",margin:"10px 0 20px 0",color:"#e2b749","text-shadow":"2px 2px 5px #000000"}}," Copyright © PFSK. All figure in here. ",-1),nt={__name:"ProductView",setup(A){const t=[Ae,Be,Le,Me],D=fe(),f=ve(),g=me(),h=O(!1),k=O(!1),$=O(!1),w=O([]);ge($,()=>{$.value?(document.documentElement.style.overflow="hidden",document.documentElement.style.height="100vh"):(document.documentElement.style.overflow="auto",document.documentElement.style.height="")});const T=O(0),x=()=>{$.value=!0;const u=window.innerWidth;u>1200?T.value=600:T.value=u/2},_=async(u,c)=>{try{await I.patch(`products/${e.value._id}/review`,{id:c}),e.value.peopleSay[u].review=!e.value.peopleSay[u].review}catch(b){console.log(b),f({text:b.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}},M=le({text:$e().required("缺少評論").min(10,"最少10個字").max(150,"最多150")}),{isSubmitting:j,handleSubmit:N,handleReset:o}=se({validationSchema:M}),s=re("text"),p=N(async u=>{try{if(e.value.peopleSay.findIndex(b=>b.user.account===g.account)>-1){const{data:b}=await I.patch(`products/${e.value._id}/say`,{text:u.text});e.value.peopleSay=b.result}else{const{data:b}=await I.post(`products/${e.value._id}/say`,{text:u.text});e.value.peopleSay=b.result,k.value=!0}o(),h.value=!1,f({text:"成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom",rounded:"pill",variant:"tonal"}})}catch(c){c.response.data.message==="缺少JWT"?f({text:"請登入或加入會員",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom",rounded:"pill",variant:"tonal"}}):f({text:c.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom",rounded:"pill"}})}}),n=le({quantity:Se().typeError("缺少數量").required("缺少數量").min(1,"最少1")}),{isSubmitting:v,handleSubmit:q}=se({validationSchema:n,initialValues:{quantity:0}}),V=re("quantity"),S=q(async u=>{try{const{data:c}=await I.post("users/cart",{product:e.value._id,quantity:u.quantity});g.cart=c.result,V.value.value=0,f({text:"加入成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom",rounded:"pill",variant:"tonal"}})}catch(c){c.response.data.message==="缺少JWT"?f({text:"請登入或加入會員",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom",rounded:"pill",variant:"tonal"}}):f({text:c.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom",rounded:"pill"}})}}),e=O({_id:"",name:"",price:"",images:[],description:"",category:"",manufacturers:"",sell:!0,color:"",textColor:"",totle:"",peopleSay:[]}),P=O(!1),H=async()=>{try{const{data:u}=await I.post("users/like",{product:e.value._id});g.like=u.result.length,e.value.totle=u.result.totle,(await I.post("/products/red",{app:e.value._id})).data.result?P.value=!0:P.value=!1,f({text:"操作成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom",rounded:"pill",variant:"tonal"}})}catch(u){u.response.data.message==="缺少JWT"?f({text:"請登入或加入會員",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom",rounded:"pill",variant:"tonal"}}):f({text:u.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom",rounded:"pill"}})}};return G.registerPlugin(Te),he(async()=>{try{const{data:u}=await Q.get("/products/"+D.params.id);e.value=u.result,e.value.peopleSay.findIndex(C=>C.user.account===g.account)>-1&&(k.value=!0),g.isLogin&&((await I.post("/products/red",{app:e.value._id})).data.result?P.value=!0:P.value=!1);const{data:b}=await Q.get("/products");w.value=b.result.filter(C=>C.category===u.result.category);const l=b.result.findIndex(C=>C._id===e.value._id);w.value.splice(l,1),document.title="購物網 |"+e.value.name,g.loding=!1}catch(u){console.log(u),f({text:u.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}await ye(),G.from(".animationtable",{scrollTrigger:{trigger:".animationtable",start:"top 60%",end:"bottom center"},x:100,opacity:0,duration:2,ease:"none"}),G.from(".animationfield",{scrollTrigger:{trigger:".animationfield",start:"top 60%",end:"bottom center"},opacity:0,duration:1,ease:"none"}),G.from(".gastlike",{scrollTrigger:{trigger:".gastlike",start:"top 70%",end:"bottom center"},y:-50,opacity:0,duration:3,ease:"none"})}),(u,c)=>{const b=be("RouterLink");return E(),B(F,null,[a("section",Ne,[r(ce,null,{default:i(()=>[r(K,null,{default:i(()=>[r(U,{cols:"12"},{default:i(()=>[r(y(ie),{pagination:{type:"fraction"},navigation:!0,modules:t,loop:!0,speed:3e3,autoplay:{delay:5e3,disableOnInteraction:!1},class:"mySwiper"},{default:i(()=>[a("section",{class:"trantext",style:d(`border-left: 1px solid ${e.value.textColor};`)},[a("span",{style:d(`color:${e.value.textColor}`)},m(e.value.name),5),Oe,a("span",{style:d(`color:${e.value.textColor}`)},m(e.value.category),5),Ie,Fe,a("span",{style:d(`color:${e.value.textColor}`)},"$"+m(e.value.price),5),We,a("span",{style:d(`color:${e.value.textColor}`)},m(e.value.manufacturers),5)],4),(E(!0),B(F,null,J(e.value.images,(l,C)=>(E(),oe(y(ue),{key:C},{default:i(()=>[r(z,{src:l,cover:"",style:{width:"100%",height:"100%"}},null,8,["src"])]),_:2},1024))),128))]),_:1})]),_:1}),r(U,{cols:"12"},{default:i(()=>[r(K,null,{default:i(()=>[r(U,{cols:"6",class:"animationtable"},{default:i(()=>[r(ee,{style:d(`color:${e.value.color}`),class:"mainveiw"},{default:i(()=>[a("thead",null,[a("tr",null,[a("th",{style:d(`color: ${e.value.color};`)},"作品名",4),a("td",null,m(e.value.name),1)]),a("tr",null,[a("th",{style:d(`color: ${e.value.color};`)},"分類",4),a("td",null,m(e.value.category),1)]),a("tr",null,[a("th",{style:d(`color: ${e.value.color};`)},"製造商",4),a("td",null,m(e.value.manufacturers),1)]),a("tr",null,[a("th",{style:d(`color: ${e.value.color};`)},"價格",4),a("td",null,m(e.value.price),1)])])]),_:1},8,["style"])]),_:1}),r(U,{style:d(`color: ${e.value.color};`),class:"txt"},{default:i(()=>[r(K,{class:"d-flex align-center flex-column justify-center animationfield",style:{"text-align":"center",height:"100%"}},{default:i(()=>[r(U,null,{default:i(()=>[a("p",null,m(e.value.description),1)]),_:1}),r(U,null,{default:i(()=>[r(ne,{disabled:y(v),onSubmit:te(y(S),["prevent"]),style:d(`border-bottom: 15px solid ${e.value.color};`),class:"underline"},{default:i(()=>[r(ae,{modelValue:y(V).value.value,"onUpdate:modelValue":c[0]||(c[0]=l=>y(V).value.value=l),modelModifiers:{number:!0},type:"number",label:"數量",min:"0","error-messages":y(V).errorMessage.value},null,8,["modelValue","error-messages"]),r(W,{style:d(`background-color:${e.value.color};color: ${e.value.textColor};`),type:"submit"},{default:i(()=>[L("加購物車 ")]),_:1},8,["style"]),r(W,{style:d(`background-color:${P.value?e.value.textColor:e.value.color}; color:${P.value?e.value.color:e.value.textColor}`),onClick:H},{default:i(()=>[L(m(P.value?"已加收藏":"加入收藏"),1)]),_:1},8,["style"]),r(W,{style:d(`background-color:${e.value.color};color: ${e.value.textColor};`),onClick:x},{default:i(()=>[L(" 查看評論 ")]),_:1},8,["style"])]),_:1},8,["disabled","onSubmit","style"])]),_:1})]),_:1})]),_:1},8,["style"])]),_:1})]),_:1})]),_:1})]),_:1}),r(we,{"model-value":!e.value.sell,persistent:"",class:"align-center justify-center text-center"},{default:i(()=>[ze,r(W,{to:"/"},{default:i(()=>[L(" 回上頁")]),_:1})]),_:1},8,["model-value"]),r(De,{modelValue:$.value,"onUpdate:modelValue":c[2]||(c[2]=l=>$.value=l),location:"right",temporary:"",width:T.value,style:d(`background-color:${e.value.color};`)},{default:i(()=>[a("div",null,[r(ee,{style:d(`color:${e.value.textColor}; background-color:${e.value.color};`)},{default:i(()=>[a("thead",null,[a("tr",null,[a("th",{style:d(`color:${e.value.textColor};`)},"使用者",4),a("th",{style:d(`color:${e.value.textColor};`)},"評論",4),a("th",{style:d(`color:${e.value.textColor};`)},"日期",4),y(g).role===1?(E(),B("th",{key:0,style:d(`color:${e.value.textColor};`)},"審核",4)):R("",!0)])]),a("tbody",null,[y(g).role===0?(E(!0),B(F,{key:0},J(e.value.peopleSay,(l,C)=>(E(),B("tr",{key:C},[l.review?R("",!0):(E(),B(F,{key:0},[a("td",Ue,[r(z,{class:"userimgavter",width:"50px",height:"50px",cover:"",src:l.user.image?l.user.image:`https://source.boringavatars.com/beam/120/${l.user.account}?colors=0db2ac,f5dd7e,fc8d4d,fc694d,faba32`},null,8,["src"]),je,L(" "+m(l.user.name),1)]),a("td",null,m(l.text),1),a("td",null,m(new Date(l.date).toLocaleString()),1)],64)),l.review?(E(),B(F,{key:1},[a("td",He,[r(z,{class:"userimgavter",width:"50px",height:"50px",cover:"",src:l.user.image?l.user.image:`https://source.boringavatars.com/beam/120/${l.user.account}?colors=0db2ac,f5dd7e,fc8d4d,fc694d,faba32`},null,8,["src"]),Re,L(" "+m(l.user.name),1)]),Ye,a("td",null,m(new Date(l.date).toLocaleString()),1)],64)):R("",!0)]))),128)):R("",!0),y(g).role===1?(E(!0),B(F,{key:1},J(e.value.peopleSay,(l,C)=>(E(),B("tr",{key:C},[a("td",Xe,[r(z,{class:"userimgavter",width:"50px",height:"50px",cover:"",src:l.user.image?l.user.image:`https://source.boringavatars.com/beam/120/${l.user.account}?colors=0db2ac,f5dd7e,fc8d4d,fc694d,faba32`},null,8,["src"]),Je,L(" "+m(l.user.name),1)]),a("td",null,m(l.text),1),a("td",null,m(new Date(l.date).toLocaleString()),1),a("td",null,[r(W,{onClick:Z=>_(C,l.user._id),style:d(`background-color:${l.review?e.value.textColor:e.value.color}; color:${l.review?e.value.color:e.value.textColor}`)},{default:i(()=>[L(m(l.review?"未通過":"已通過"),1)]),_:2},1032,["onClick","style"])])]))),128)):R("",!0)])]),_:1},8,["style"])]),r(W,{onClick:c[1]||(c[1]=l=>h.value=!0),style:d(`background-color:${k.value?e.value.textColor:e.value.color}; color:${k.value?e.value.color:e.value.textColor}`),class:"otherbtn"},{default:i(()=>[L(m(k.value?"編輯評論":"新增評論"),1)]),_:1},8,["style"])]),_:1},8,["modelValue","width","style"]),r(xe,{modelValue:h.value,"onUpdate:modelValue":c[4]||(c[4]=l=>h.value=l),width:"auto"},{default:i(()=>[r(ne,{disabled:y(j),onSubmit:te(y(p),["prevent"]),style:{width:"400px"}},{default:i(()=>[r(_e,{style:d(`background-color:${e.value.color};color: ${e.value.textColor};`)},{default:i(()=>[r(Ce,null,{default:i(()=>[r(z,{src:y(g).avatar,style:{width:"20%",display:"inline-block"}},null,8,["src"]),a("span",null,m(y(g).name),1)]),_:1}),r(ke,null,{default:i(()=>[r(ae,{modelValue:y(s).value.value,"onUpdate:modelValue":c[3]||(c[3]=l=>y(s).value.value=l),label:"留言",counter:"",maxlength:"150","error-messages":y(s).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),r(W,{type:"submit",class:"otherbtn",style:d(`background-color:${e.value.textColor};color: ${e.value.color};`)},{default:i(()=>[L(" 確認")]),_:1},8,["style"])]),_:1},8,["style"])]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])]),r(ce,null,{default:i(()=>[a("section",Ge,[a("div",{class:"link",style:d(`border-bottom: 5px solid ${e.value.color};`)},[a("span",{style:d(`background-color:${e.value.color};color: ${e.value.textColor};`)}," 關聯商品",4)],4),r(y(ie),{effect:"coverflow",grabCursor:!0,centeredSlides:!0,slidesPerView:"auto",coverflowEffect:{rotate:50,stretch:0,depth:100,modifier:1,slideShadows:!0},speed:2e3,pagination:!0,modules:t,class:"mySwiper",initialSlide:2},{default:i(()=>[(E(!0),B(F,null,J(w.value,l=>(E(),oe(y(ue),{key:l._id},{default:i(()=>[r(b,{to:/proHome/+l._id},{default:i(()=>[r(z,{src:l.images[0],cover:""},null,8,["src"])]),_:2},1032,["to"])]),_:2},1024))),128))]),_:1})])]),_:1}),Ke],64)}}};export{nt as default};

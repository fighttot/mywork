import{_ as q}from"./71b8e0fl_cL._AC_SL1500-811e8b6d.js";import{b as S,d as $,a as N,r as P,c as y,H as h,f as u,h as d,x as e,i as a,w as r,F as b,V as f,W as z,n as D,k as F,D as c,y as i,t as k,X as I,Y as C}from"./index-4e24dfd9.js";import{V as R}from"./VContainer-95f77cfa.js";import{V as T,a as m}from"./VRow-e0d2e2b2.js";/* empty css              */const A={class:"othertitle"},E={class:"bgbox"},H=e("div",{class:"bgbox2"},null,-1),L=e("h1",null,"購物車",-1),U=e("thead",null,[e("tr",null,[e("th",null,"圖片"),e("th",null,"名稱"),e("th",null,"單價"),e("th",null,"數量"),e("th",null,"小記"),e("th",null,"操作")])],-1),W={key:0,colspan:"6",class:"text-center"},M={__name:"CartView",setup(X){const p=S(),g=$(),v=N(),s=P([]),_=async(o,l)=>{try{const{data:t}=await h.post("users/cart",{product:o,quantity:l}),n=s.value.findIndex(B=>B.product._id===o);s.value[n].quantity+=l,s.value[n].quantity<=0&&s.value.splice(n,1),v.cart=t.result}catch(t){console.log(t),p({text:t.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}},x=y(()=>s.value.length>0&&!s.value.some(o=>!o.product.sell)),V=y(()=>s.value.reduce((o,l)=>o+l.quantity*l.product.price,0));(async()=>{try{const{data:o}=await h.get("/users/cart");s.value.push(...o.result)}catch(o){p({text:o.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}})();const w=async(o,l)=>{try{await h.post("/orders"),v.cart=0,g.push("/orders")}catch(t){p({text:t.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}};return(o,l)=>(u(),d(b,null,[e("section",A,[e("div",E,[a(f,{class:"mainimg",src:q,cover:""})]),H]),a(R,null,{default:r(()=>[a(T,null,{default:r(()=>[a(m,{cols:"12"},{default:r(()=>[L]),_:1}),a(m,{cols:"12"},{default:r(()=>[a(z,null,{default:r(()=>[U,e("tbody",null,[(u(!0),d(b,null,D(s.value,t=>(u(),d("tr",{key:t._id,class:I({"bg-red-lighten-5":!t.product.sell})},[e("td",null,[a(f,{src:t.product.images[0],cover:"","aspect-ratio":"1"},null,8,["src"])]),e("td",{style:C(`color: ${t.product.textColor};`)},c(t.product.name),5),e("td",{style:C(`background-color: ${t.product.color};`)},c(t.product.price),5),e("td",null,[a(i,{color:"primary",variant:"text",icon:"mdi-minus",onClick:n=>_(t.product._id,-1)},null,8,["onClick"]),k(" "+c(t.quantity)+" ",1),a(i,{color:"primary",variant:"text",icon:"mdi-plus",onClick:n=>_(t.product._id,1)},null,8,["onClick"])]),e("td",null,c(t.quantity*t.product.price),1),e("td",null,[a(i,{color:"red",variant:"text",icon:"mdi-delete",onClick:n=>_(t.product._id,t.quantity*-1)},null,8,["onClick"])])],2))),128)),e("tr",null,[s.value.length===0?(u(),d("td",W,"沒有商品")):F("",!0)])])]),_:1})]),_:1}),a(m,{cols:"12",class:"text-center"},{default:r(()=>[e("p",null,"總金額:"+c(V.value),1),a(i,{color:"green",onClick:w,disabled:!x.value},{default:r(()=>[k("結帳")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})],64))}};export{M as default};

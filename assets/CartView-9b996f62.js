import{b as Z,d as z,a as A,r as C,c as M,H as w,o as G,e as J,f as i,h as g,x as a,i as l,w as s,m as P,F as T,X as K,Y as O,n as Q,k as m,D as f,y as d,t as p,Z as W,B as ee,_ as te,l as r,$ as ae,j as y,a0 as L,a1 as le,a2 as oe}from"./index-3263188b.js";import{c as se,a as S,u as re,b as q,V as ne}from"./index.esm-b8d713c1.js";import{F as ue}from"./FooTer-376ed45d.js";import{p as ie}from"./parallax-8993438f.js";import{V as ce}from"./VContainer-2369b5fb.js";import{V as de,a as B}from"./VRow-dbeb81d2.js";/* empty css              */const pe=""+new URL("Zuikaku3-d1cccb77.jpg",import.meta.url).href,me={class:"cardview"},ve={class:"othertitle"},fe={class:"bgbox"},ye={class:"scene"},_e={class:"imgbox","data-depth":"-0.5"},he={class:"d-flex align-center justify-center fill-height"},be=a("div",{class:"bgbox2"},null,-1),ge=a("h1",null,"購物車",-1),ke=a("thead",null,[a("tr",null,[a("th",null,"圖片"),a("th",null,"名稱"),a("th",null,"單價"),a("th",null,"數量"),a("th",null,"小記"),a("th",null,"操作")])],-1),Ve={key:0,colspan:"6",class:"text-center"},Ue={__name:"CartView",setup(xe){const _=Z(),N=z(),$=A(),n=C([]),v=C(!1),c=C(!0),F=["萊爾富","7-11","全家"],R=["貨到付款現金","貨到付款刷卡"],k=async(o,t)=>{try{const{data:u}=await w.post("users/cart",{product:o,quantity:t}),e=n.value.findIndex(b=>b.product._id===o);n.value[e].quantity+=t,n.value[e].quantity<=0&&n.value.splice(e,1),$.cart=u.result}catch(u){console.log(u),_({text:u.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom",rounded:"pill",variant:"tonal"}})}},X=M(()=>n.value.length>0&&!n.value.some(o=>!o.product.sell)),Y=M(()=>n.value.reduce((o,t)=>o+t.quantity*t.product.price,0));(async()=>{try{const{data:o}=await w.get("/users/cart");n.value.push(...o.result)}catch(o){_({text:o.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom",rounded:"pill",variant:"tonal"}})}})();const j=se({seventhome:S().required("缺少製造商").test("地址錯誤",o=>F.includes(o)),paypoint:S().required("缺少店址"),payway:S().required("缺少付款方式")}),{handleSubmit:D,isSubmitting:E,handleReset:U}=re({validationSchema:j}),V=q("seventhome"),x=q("paypoint"),h=q("payway"),H=()=>{h.value.value?c.value=!1:_({text:"請填寫付款方式",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom",rounded:"pill",variant:"tonal"}})},I=D(async o=>{try{await w.post("/orders",{seventhome:o.seventhome+o.paypoint,paywat:o.payway}),$.cart=0,N.push("/orders"),v.value=!1,c.value=!0,U()}catch(t){_({text:t.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom",rounded:"pill",variant:"tonal"}})}});return G(()=>{const o=document.querySelector(".scene"),t=document.querySelector(".bgbox"),u=new ie(o,{scalarX:10,scalarY:10,frictionX:.1,frictionY:.1,limitX:100,limitY:100});u.disable(),t.addEventListener("mouseover",e=>{u.enable()}),t.addEventListener("mouseout",e=>{u.disable()})}),(o,t)=>{const u=J("router-link");return i(),g(T,null,[a("section",me,[a("section",ve,[a("div",fe,[a("div",ye,[a("div",_e,[l(P,{class:"mainimg",src:pe,cover:""},{placeholder:s(()=>[a("div",he,[l(K,{color:"grey-lighten-4",indeterminate:""})])]),_:1})])])]),be]),l(ce,null,{default:s(()=>[l(de,null,{default:s(()=>[l(B,{cols:"12"},{default:s(()=>[ge]),_:1}),l(B,{cols:"12",class:"cartheight"},{default:s(()=>[l(O,null,{default:s(()=>[ke,a("tbody",null,[(i(!0),g(T,null,Q(n.value,e=>(i(),g("tr",{key:e._id,class:oe({"bg-red-lighten-5":!e.product.sell})},[a("td",null,[l(P,{src:e.product.images[0],cover:"","aspect-ratio":"1"},null,8,["src"])]),a("td",null,[l(u,{to:`/proHome/${e.product._id}`},{default:s(()=>[p(f(e.product.name),1)]),_:2},1032,["to"])]),a("td",null,f(e.product.price),1),a("td",null,[l(d,{color:"primary",variant:"text",icon:"mdi-minus",onClick:b=>k(e.product._id,-1)},null,8,["onClick"]),p(" "+f(e.quantity)+" ",1),l(d,{color:"primary",variant:"text",icon:"mdi-plus",onClick:b=>k(e.product._id,1)},null,8,["onClick"])]),a("td",null,f(e.quantity*e.product.price),1),a("td",null,[l(d,{color:"red",variant:"text",icon:"mdi-delete",onClick:b=>k(e.product._id,e.quantity*-1)},null,8,["onClick"])])],2))),128)),a("tr",null,[n.value.length===0?(i(),g("td",Ve,"沒有商品")):m("",!0)])])]),_:1})]),_:1}),l(B,{cols:"12",class:"text-center"},{default:s(()=>[a("p",null,"總金額:"+f(Y.value),1),l(d,{onClick:t[0]||(t[0]=e=>v.value=!0),color:"secondary"},{default:s(()=>[p("結帳")]),_:1})]),_:1})]),_:1}),l(W,{modelValue:v.value,"onUpdate:modelValue":t[6]||(t[6]=e=>v.value=e),width:"400px",persistent:""},{default:s(()=>[l(ee,{class:"text-center"},{default:s(()=>[l(te,null,{default:s(()=>[p("結帳資訊")]),_:1}),l(ne,{disabled:r(E),onSubmit:ae(r(I),["prevent"])},{default:s(()=>[c.value?m("",!0):(i(),y(L,{key:0,items:F,label:"便利商店貨到付款",modelValue:r(V).value.value,"onUpdate:modelValue":t[1]||(t[1]=e=>r(V).value.value=e),"error-messages":r(V).errorMessage.value},null,8,["modelValue","error-messages"])),c.value?(i(),y(L,{key:1,label:"付款方式?",modelValue:r(h).value.value,"onUpdate:modelValue":t[2]||(t[2]=e=>r(h).value.value=e),"error-messages":r(h).errorMessage.value,items:R},null,8,["modelValue","error-messages"])):m("",!0),c.value?m("",!0):(i(),y(le,{key:2,label:"哪一家店?",modelValue:r(x).value.value,"onUpdate:modelValue":t[3]||(t[3]=e=>r(x).value.value=e),"error-messages":r(x).errorMessage.value},null,8,["modelValue","error-messages"])),c.value?m("",!0):(i(),y(d,{key:3,onClick:t[4]||(t[4]=e=>c.value=!0)},{default:s(()=>[p("上一步")]),_:1})),c.value?(i(),y(d,{key:4,onClick:H},{default:s(()=>[p("下一步")]),_:1})):m("",!0),l(d,{color:"green",onClick:r(I),disabled:!X.value},{default:s(()=>[p("結帳")]),_:1},8,["onClick","disabled"]),l(d,{onClick:t[5]||(t[5]=e=>(v.value=!1,r(U)()))},{default:s(()=>[p("取消")]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),l(ue)],64)}}};export{Ue as default};

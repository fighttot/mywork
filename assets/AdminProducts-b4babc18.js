import{I as be,$ as ye,a0 as Se,a1 as Be,K as ke,a2 as he,a3 as Ce,a4 as Ie,c as ae,R as we,a5 as Pe,a6 as re,a7 as de,i as t,A as K,a8 as Re,a9 as Ue,r as u,aa as Me,N as Ae,o as Te,O as X,P as _e,ab as De,ac as Ee,F as le,ad as ce,ae as Ne,af as $e,ag as He,ah as ze,ai as ne,aj as qe,ak as Ge,Q as Oe,b as je,H as se,e as ve,f as S,j as N,w as s,E as me,v as $,Z as O,al as Le,z as fe,am as ge,V as j,h as ue,p as pe,s as Ke,k as ee,m as n,Y as Ye,B as Qe,an as Ze,D as Je,C as We,ao as Xe,ap as ea,y as aa,l as Ve}from"./index-31ac7712.js";import{c as la,a as L,e as ta,f as oa,u as ra,b as A,V as na}from"./index.esm-e8240ee2.js";import{V as sa}from"./VContainer-d6a65531.js";import{a as ie,V as xe}from"./VRow-f96e4da1.js";import{V as ua,a as ia}from"./VToolbar-c69aa5ec.js";/* empty css              */const da=be({...ye(),...Se(Be(),["inline"])},"VCheckbox"),ca=ke()({name:"VCheckbox",inheritAttrs:!1,props:da(),emits:{"update:modelValue":e=>!0,"update:focused":e=>!0},setup(e,x){let{attrs:k,slots:B}=x;const i=he(e,"modelValue"),{isFocused:c,focus:h,blur:Y}=Ce(e),T=Ie(),H=ae(()=>e.id||`checkbox-${T}`);return we(()=>{const[R,F]=Pe(k),[C,b]=re.filterProps(e),[_,D]=de.filterProps(e);return t(re,K({class:["v-checkbox",e.class]},R,C,{modelValue:i.value,"onUpdate:modelValue":E=>i.value=E,id:H.value,focused:c.value,style:e.style}),{...B,default:E=>{let{id:U,messagesId:Q,isDisabled:z,isReadonly:Z}=E;return t(de,K(_,{id:U.value,"aria-describedby":Q.value,disabled:z.value,readonly:Z.value},F,{modelValue:i.value,"onUpdate:modelValue":J=>i.value=J,onFocus:h,onBlur:Y}),B)}})}),{}}});const va=be({autoGrow:Boolean,autofocus:Boolean,counter:[Boolean,Number,String],counterValue:Function,prefix:String,placeholder:String,persistentPlaceholder:Boolean,persistentCounter:Boolean,noResize:Boolean,rows:{type:[Number,String],default:5,validator:e=>!isNaN(parseFloat(e))},maxRows:{type:[Number,String],validator:e=>!isNaN(parseFloat(e))},suffix:String,modelModifiers:Object,...ye(),...Re()},"VTextarea"),ma=ke()({name:"VTextarea",directives:{Intersect:Ue},inheritAttrs:!1,props:va(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,x){let{attrs:k,emit:B,slots:i}=x;const c=he(e,"modelValue"),{isFocused:h,focus:Y,blur:T}=Ce(e),H=ae(()=>typeof e.counterValue=="function"?e.counterValue(c.value):(c.value||"").toString().length),R=ae(()=>{if(k.maxlength)return k.maxlength;if(!(!e.counter||typeof e.counter!="number"&&typeof e.counter!="string"))return e.counter});function F(r,f){var d,p;!e.autofocus||!r||(p=(d=f[0].target)==null?void 0:d.focus)==null||p.call(d)}const C=u(),b=u(),_=Me(""),D=u(),E=ae(()=>e.persistentPlaceholder||h.value||e.active);function U(){var r;D.value!==document.activeElement&&((r=D.value)==null||r.focus()),h.value||Y()}function Q(r){U(),B("click:control",r)}function z(r){B("mousedown:control",r)}function Z(r){r.stopPropagation(),U(),ne(()=>{c.value="",qe(e["onClick:clear"],r)})}function J(r){var d;const f=r.target;if(c.value=f.value,(d=e.modelModifiers)!=null&&d.trim){const p=[f.selectionStart,f.selectionEnd];ne(()=>{f.selectionStart=p[0],f.selectionEnd=p[1]})}}const w=u(),q=u(+e.rows),W=ae(()=>["plain","underlined"].includes(e.variant));Ae(()=>{e.autoGrow||(q.value=+e.rows)});function P(){e.autoGrow&&ne(()=>{if(!w.value||!b.value)return;const r=getComputedStyle(w.value),f=getComputedStyle(b.value.$el),d=parseFloat(r.getPropertyValue("--v-field-padding-top"))+parseFloat(r.getPropertyValue("--v-input-padding-top"))+parseFloat(r.getPropertyValue("--v-field-padding-bottom")),p=w.value.scrollHeight,I=parseFloat(r.lineHeight),M=Math.max(parseFloat(e.rows)*I+d,parseFloat(f.getPropertyValue("--v-input-control-height"))),v=parseFloat(e.maxRows)*I+d||1/0,m=Oe(p??0,M,v);q.value=Math.floor((m-d)/I),_.value=Ge(m)})}Te(P),X(c,P),X(()=>e.rows,P),X(()=>e.maxRows,P),X(()=>e.density,P);let g;return X(w,r=>{r?(g=new ResizeObserver(P),g.observe(w.value)):g==null||g.disconnect()}),_e(()=>{g==null||g.disconnect()}),we(()=>{const r=!!(i.counter||e.counter||e.counterValue),f=!!(r||i.details),[d,p]=Pe(k),[{modelValue:I,...M}]=re.filterProps(e),[v]=De(e);return t(re,K({ref:C,modelValue:c.value,"onUpdate:modelValue":m=>c.value=m,class:["v-textarea v-text-field",{"v-textarea--prefixed":e.prefix,"v-textarea--suffixed":e.suffix,"v-text-field--prefixed":e.prefix,"v-text-field--suffixed":e.suffix,"v-textarea--auto-grow":e.autoGrow,"v-textarea--no-resize":e.noResize||e.autoGrow,"v-text-field--plain-underlined":W.value},e.class],style:e.style},d,M,{centerAffix:q.value===1&&!W.value,focused:h.value}),{...i,default:m=>{let{isDisabled:V,isDirty:te,isReadonly:l,isValid:a}=m;return t(Ee,K({ref:b,style:{"--v-textarea-control-height":_.value},onClick:Q,onMousedown:z,"onClick:clear":Z,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"],role:"textbox"},v,{active:E.value||te.value,centerAffix:q.value===1&&!W.value,dirty:te.value||e.dirty,disabled:V.value,focused:h.value,error:a.value===!1}),{...i,default:y=>{let{props:{class:oe,...o}}=y;return t(le,null,[e.prefix&&t("span",{class:"v-text-field__prefix"},[e.prefix]),ce(t("textarea",K({ref:D,class:oe,value:c.value,onInput:J,autofocus:e.autofocus,readonly:l.value,disabled:V.value,placeholder:e.placeholder,rows:e.rows,name:e.name,onFocus:U,onBlur:T},o,p),null),[[Ne("intersect"),{handler:F},null,{once:!0}]]),e.autoGrow&&ce(t("textarea",{class:[oe,"v-textarea__sizer"],"onUpdate:modelValue":G=>c.value=G,ref:w,readonly:!0,"aria-hidden":"true"},null),[[$e,c.value]]),e.suffix&&t("span",{class:"v-text-field__suffix"},[e.suffix])])}})},details:f?m=>{var V;return t(le,null,[(V=i.details)==null?void 0:V.call(i,m),r&&t(le,null,[t("span",null,null),t(He,{active:e.persistentCounter||h.value,value:H.value,max:R.value},i.counter)])])}:void 0})}),ze({},C,b,D)}}),fa=aa("h1",{class:"text-center"},"商品管理",-1),ga={key:2,class:"text-center"},ha={__name:"AdminProducts",setup(e){const x=u([]),k=je(),B=u(5),i=u([{key:"name",order:"asc"}]),c=u(1),h=u([]),Y=[{title:"圖片",align:"center",sortable:!1,key:"images"},{title:"名稱",align:"center",sortable:!0,key:"name"},{title:"製造商",align:"center",sortable:!0,key:"manufacturers"},{title:"分類",align:"center",sortable:!0,key:"category"},{title:"價錢",align:"center",sortable:!0,key:"price"},{title:"主題色",align:"center",sortable:!1,key:"color"},{title:"文字主題色",align:"center",sortable:!1,key:"textColor"},{title:"上架",align:"center",sortable:!0,key:"sell"},{title:"喜歡",align:"center",sortable:!0,key:"totle"},{title:"售出數",align:"center",sortable:!0,key:"sellTotle"},{title:"編輯",align:"center",sortable:!1,key:"edit"}],T=u(!1),H=u(0),R=u(""),F=async()=>{var l,a;T.value=!0;try{const{data:y}=await se.get("./products/all",{params:{page:c.value,itemsPerPage:B.value,sortBy:((l=i.value[0])==null?void 0:l.key)||"_id",sortOrder:((a=i.value[0])==null?void 0:a.order)||"asc",search:R.value}});h.value.splice(0,h.value.length,...y.result.data),H.value=y.result.count}catch(y){k({text:y.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}T.value=!1};F();const C=u(!1),b=u(""),_=()=>{c.value=1,F()},D=l=>{b.value=l._id,P.value.value=l.name,g.value.value=l.price,r.value.value=l.description,f.value.value=l.category,d.value.value=l.manufacturers,I.value.value=l.color,M.value.value=l.textColor,p.value.value=l.sell,x.value=l.images,C.value=!0},E=()=>{b.value=""},U=()=>{if(C.value=!1,W(),x.value=u([]),m.value.length>0)for(let l=0;l<m.value.length*2;l++)V.value.deleteFileRecord(m.value[l]),V.value.deleteFileRecord(v.value[l]);for(let l=0;l<v.value.length*2;l++)V.value.deleteFileRecord(v.value[l])},Q=()=>{if(q(),m.value.length>0)for(let l=0;l<m.value.length*2;l++)V.value.deleteFileRecord(m.value[l]),V.value.deleteFileRecord(v.value[l]);for(let l=0;l<v.value.length*2;l++)V.value.deleteFileRecord(v.value[l])},z=["MIMEYOI","ALTER","好微笑","壽屋"],Z=la({name:L().required("缺少名稱"),price:ta().required("缺少價格").min(0,"價格錯誤").typeError("沒有價格"),description:L().required("缺少說明"),category:L().required("缺少分類"),manufacturers:L().required("缺少製造商").test("製造商錯誤",l=>z.includes(l)),sell:oa(),color:L().required("需要主題色"),textColor:L().required("需要文字主題色")}),{handleSubmit:J,isSubmitting:w,handleReset:q,resetForm:W}=ra({validationSchema:Z,initialValues:{name:"",price:0,description:"",category:"",manufacturers:"",color:"",textColor:"",sell:!1}}),P=A("name"),g=A("price"),r=A("description"),f=A("category"),d=A("manufacturers"),p=A("sell"),I=A("color"),M=A("textColor"),v=u([]),m=u([]),V=u(null),te=J(async l=>{if(b.value.length===0&&v.value.length===0)return k({text:"沒有圖片",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}});try{const a=new FormData;a.append("name",l.name),a.append("price",l.price),a.append("description",l.description),a.append("category",l.category),a.append("manufacturers",l.manufacturers),a.append("sell",l.sell),a.append("color",l.color),a.append("textColor",l.textColor);for(let y=0;y<v.value.length;y++)v.value.length>0&&a.append("images",v.value[y].file);b.value.length>0?(await se.patch("/products/"+b.value,a),k({text:"修改成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}})):(await se.post("/products",a),k({text:"新增成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}})),U(),F()}catch(a){k({text:a.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}});return(l,a)=>{const y=ve("VDataTableServer"),oe=ve("VueFileAgent");return S(),N(sa,null,{default:s(()=>[t(xe,null,{default:s(()=>[t(ie,{cols:"12"},{default:s(()=>[fa]),_:1}),t(me),t(ie,{cols:"12"},{default:s(()=>[t(y,{"items-per-page":B.value,"onUpdate:itemsPerPage":[a[2]||(a[2]=o=>B.value=o),F],"sort-by":i.value,"onUpdate:sortBy":[a[3]||(a[3]=o=>i.value=o),F],page:c.value,"onUpdate:page":[a[4]||(a[4]=o=>c.value=o),F],items:h.value,headers:Y,loading:T.value,"items-length":H.value,hover:"",search:R.value},{top:s(()=>[t(ua,{flat:""},{default:s(()=>[t(ia,null,{default:s(()=>[$("我的商品")]),_:1}),t(O,{label:"搜尋","append-icon":"mdi-magnify",modelValue:R.value,"onUpdate:modelValue":a[0]||(a[0]=o=>R.value=o),"onClick:append":_,onKeydown:Le(_,["enter"])},null,8,["modelValue","onKeydown"]),t(me,{class:"mx-4",inset:"",vertical:""}),t(fe),t(ge,{modelValue:C.value,"onUpdate:modelValue":a[1]||(a[1]=o=>C.value=o),"max-width":"500px"},{activator:s(({props:o})=>[t(j,K({color:"primary",dark:"",class:"mb-2"},o,{onClick:E}),{default:s(()=>[$(" 新增商品 ")]),_:2},1040)]),_:1},8,["modelValue"])]),_:1})]),"item.images":s(({item:o})=>[(S(!0),ue(le,null,pe(o.raw.images,(G,Fe)=>(S(),N(Ve,{src:G,key:Fe,cover:"","aspect-ratio":"16/9"},null,8,["src"]))),128))]),"item.sell":s(({item:o})=>[o.raw.sell?(S(),N(Ke,{key:0,icon:"mdi-check"})):ee("",!0)]),"item.edit":s(({item:o})=>[t(j,{icon:"mdi-pencil",onClick:G=>D(o.raw),variant:"text"},null,8,["onClick"])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),_:1})]),_:1}),t(ge,{persistent:"",modelValue:C.value,"onUpdate:modelValue":a[16]||(a[16]=o=>C.value=o),width:"800px",scrollable:""},{default:s(()=>[t(na,{disabled:n(w),onSubmit:Ye(n(te),["prevent"])},{default:s(()=>[t(Qe,{style:{height:"80vh"}},{default:s(()=>[t(Ze,null,{default:s(()=>[$(Je(b.value.length>0?"編輯商品":"新增商品"),1)]),_:1}),t(We,null,{default:s(()=>[t(O,{label:"名稱",modelValue:n(P).value.value,"onUpdate:modelValue":a[5]||(a[5]=o=>n(P).value.value=o),"error-messages":n(P).errorMessage.value},null,8,["modelValue","error-messages"]),t(O,{label:"價格",modelValue:n(g).value.value,"onUpdate:modelValue":a[6]||(a[6]=o=>n(g).value.value=o),modelModifiers:{number:!0},"error-messages":n(g).errorMessage.value,type:"number",min:"0"},null,8,["modelValue","error-messages"]),t(O,{label:"分類",modelValue:n(f).value.value,"onUpdate:modelValue":a[7]||(a[7]=o=>n(f).value.value=o),"error-messages":n(f).errorMessage.value},null,8,["modelValue","error-messages"]),t(Xe,{items:z,label:"製造商",modelValue:n(d).value.value,"onUpdate:modelValue":a[8]||(a[8]=o=>n(d).value.value=o),"error-messages":n(d).errorMessage.value},null,8,["modelValue","error-messages"]),t(O,{label:"主題色",modelValue:n(I).value.value,"onUpdate:modelValue":a[9]||(a[9]=o=>n(I).value.value=o),"error-messages":n(I).errorMessage.value},null,8,["modelValue","error-messages"]),t(O,{label:"文字主題色",modelValue:n(M).value.value,"onUpdate:modelValue":a[10]||(a[10]=o=>n(M).value.value=o),"error-messages":n(M).errorMessage.value},null,8,["modelValue","error-messages"]),t(ma,{label:"說明",modelValue:n(r).value.value,"onUpdate:modelValue":a[11]||(a[11]=o=>n(r).value.value=o),"error-messages":n(r).errorMessage.value},null,8,["modelValue","error-messages"]),t(ca,{label:"上架",modelValue:n(p).value.value,"onUpdate:modelValue":a[12]||(a[12]=o=>n(p).value.value=o)},null,8,["modelValue"]),!x.value.length>0?(S(),N(oe,{key:0,modelValue:v.value,"onUpdate:modelValue":a[13]||(a[13]=o=>v.value=o),"raw-model-value":m.value,"onUpdate:rawModelValue":a[14]||(a[14]=o=>m.value=o),"max-files":6,"max-size":"5MB",accept:"image/jpg,image/jpeg,image/png",multiple:!0,"error-text":{type:"檔案格式錯誤",size:"檔案太大"},"help-text":"選擇檔案或拖曳至此",deletable:"",ref_key:"fileAgent",ref:V},null,8,["modelValue","raw-model-value"])):ee("",!0),x.value.length>0?(S(),N(xe,{key:1},{default:s(()=>[(S(!0),ue(le,null,pe(x.value,(o,G)=>(S(),N(ie,{key:G,cover:"","aspect-ratio":"16/9"},{default:s(()=>[t(Ve,{src:o},null,8,["src"])]),_:2},1024))),128))]),_:1})):ee("",!0),!v.value.length>0&&!x.value.length>0?(S(),ue("p",ga,"需要圖片")):ee("",!0),x.value.length>0?(S(),N(j,{key:3,onClick:a[15]||(a[15]=o=>x.value=[])},{default:s(()=>[$("重新上傳圖片")]),_:1})):ee("",!0)]),_:1}),t(ea,null,{default:s(()=>[t(fe,null,{default:s(()=>[t(j,{color:"red",onClick:U,loading:n(w)},{default:s(()=>[$("取消")]),_:1},8,["loading"]),t(j,{color:"primary",onClick:Q,loading:n(w)},{default:s(()=>[$("重製")]),_:1},8,["loading"]),t(j,{color:"green",type:"submit",loading:n(w)},{default:s(()=>[$("送出")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])]),_:1})}}};export{ha as default};

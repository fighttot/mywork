import{aX as fe,b as ve,a as me,r as I,O as ge,H as O,T as J,o as ye,e as he,f as _,h as q,y as n,i as o,w as i,aY as we,Y as f,am as be,F,m as g,p as R,W as K,D as C,Z as Q,$ as ee,V as A,v as D,k as X,B as xe,an as ke,l as W,C as Ce,j as te}from"./index-c57fb7bc.js";import{c as ae,a as Se,u as le,b as oe,e as Ee,V as se}from"./index.esm-eb2e8ccd.js";import{g as Z,S as $e}from"./ScrollTrigger-1fe021b6.js";import{d as _e,g as ce,c as Ve,e as Le,S as re,P as Te,A as qe,a as ne}from"./effect-init-b13e525a.js";import{e as Pe}from"./effect-target-deff5e6b.js";import{V as ie}from"./VContainer-aa0b2b54.js";import{V as Be}from"./VNavigationDrawer-19fefa8e.js";import{V as G,a as H}from"./VRow-cb658920.js";/* empty css              */function Me(N){let{swiper:t,extendParams:P,on:w,emit:y}=N;P({navigation:{nextEl:null,prevEl:null,hideOnClick:!1,disabledClass:"swiper-button-disabled",hiddenClass:"swiper-button-hidden",lockClass:"swiper-button-lock",navigationDisabledClass:"swiper-navigation-disabled"}}),t.navigation={nextEl:null,prevEl:null};const v=a=>(Array.isArray(a)?a:[a]).filter(l=>!!l);function E(a){let l;return a&&typeof a=="string"&&t.isElement&&(l=t.el.querySelector(a),l)?l:(a&&(typeof a=="string"&&(l=[...document.querySelectorAll(a)]),t.params.uniqueNavElements&&typeof a=="string"&&l.length>1&&t.el.querySelectorAll(a).length===1&&(l=t.el.querySelector(a))),a&&!l?a:l)}function S(a,l){const c=t.params.navigation;a=v(a),a.forEach(r=>{r&&(r.classList[l?"add":"remove"](...c.disabledClass.split(" ")),r.tagName==="BUTTON"&&(r.disabled=l),t.params.watchOverflow&&t.enabled&&r.classList[t.isLocked?"add":"remove"](c.lockClass))})}function b(){const{nextEl:a,prevEl:l}=t.navigation;if(t.params.loop){S(l,!1),S(a,!1);return}S(l,t.isBeginning&&!t.params.rewind),S(a,t.isEnd&&!t.params.rewind)}function B(a){a.preventDefault(),!(t.isBeginning&&!t.params.loop&&!t.params.rewind)&&(t.slidePrev(),y("navigationPrev"))}function x(a){a.preventDefault(),!(t.isEnd&&!t.params.loop&&!t.params.rewind)&&(t.slideNext(),y("navigationNext"))}function k(){const a=t.params.navigation;if(t.params.navigation=_e(t,t.originalParams.navigation,t.params.navigation,{nextEl:"swiper-button-next",prevEl:"swiper-button-prev"}),!(a.nextEl||a.prevEl))return;let l=E(a.nextEl),c=E(a.prevEl);Object.assign(t.navigation,{nextEl:l,prevEl:c}),l=v(l),c=v(c);const r=(d,T)=>{d&&d.addEventListener("click",T==="next"?x:B),!t.enabled&&d&&d.classList.add(...a.lockClass.split(" "))};l.forEach(d=>r(d,"next")),c.forEach(d=>r(d,"prev"))}function M(){let{nextEl:a,prevEl:l}=t.navigation;a=v(a),l=v(l);const c=(r,d)=>{r.removeEventListener("click",d==="next"?x:B),r.classList.remove(...t.params.navigation.disabledClass.split(" "))};a.forEach(r=>c(r,"next")),l.forEach(r=>c(r,"prev"))}w("init",()=>{t.params.navigation.enabled===!1?L():(k(),b())}),w("toEdge fromEdge lock unlock",()=>{b()}),w("destroy",()=>{M()}),w("enable disable",()=>{let{nextEl:a,prevEl:l}=t.navigation;a=v(a),l=v(l),[...a,...l].filter(c=>!!c).forEach(c=>c.classList[t.enabled?"remove":"add"](t.params.navigation.lockClass))}),w("click",(a,l)=>{let{nextEl:c,prevEl:r}=t.navigation;c=v(c),r=v(r);const d=l.target;if(t.params.navigation.hideOnClick&&!r.includes(d)&&!c.includes(d)){if(t.pagination&&t.params.pagination&&t.params.pagination.clickable&&(t.pagination.el===d||t.pagination.el.contains(d)))return;let T;c.length?T=c[0].classList.contains(t.params.navigation.hiddenClass):r.length&&(T=r[0].classList.contains(t.params.navigation.hiddenClass)),y(T===!0?"navigationShow":"navigationHide"),[...c,...r].filter(e=>!!e).forEach(e=>e.classList.toggle(t.params.navigation.hiddenClass))}});const Y=()=>{t.el.classList.remove(...t.params.navigation.navigationDisabledClass.split(" ")),k(),b()},L=()=>{t.el.classList.add(...t.params.navigation.navigationDisabledClass.split(" ")),M()};Object.assign(t.navigation,{enable:Y,disable:L,update:b,init:k,destroy:M})}function ue(N,t,P){const w=`swiper-slide-shadow${P?`-${P}`:""}${N?` swiper-slide-shadow-${N}`:""}`,y=ce(t);let v=y.querySelector(`.${w.split(" ").join(".")}`);return v||(v=Ve("div",w.split(" ")),y.append(v)),v}function De(N){let{swiper:t,extendParams:P,on:w}=N;P({coverflowEffect:{rotate:50,stretch:0,depth:100,scale:1,modifier:1,slideShadows:!0}}),Le({effect:"coverflow",swiper:t,on:w,setTranslate:()=>{const{width:E,height:S,slides:b,slidesSizesGrid:B}=t,x=t.params.coverflowEffect,k=t.isHorizontal(),M=t.translate,Y=k?-M+E/2:-M+S/2,L=k?x.rotate:-x.rotate,a=x.depth;for(let l=0,c=b.length;l<c;l+=1){const r=b[l],d=B[l],T=r.swiperSlideOffset,e=(Y-T-d/2)/d,m=typeof x.modifier=="function"?x.modifier(e):e*x.modifier;let j=k?L*m:0,p=k?0:L*m,u=-a*Math.abs(m),h=x.stretch;typeof h=="string"&&h.indexOf("%")!==-1&&(h=parseFloat(x.stretch)/100*d);let s=k?0:h*m,$=k?h*m:0,V=1-(1-x.scale)*Math.abs(m);Math.abs($)<.001&&($=0),Math.abs(s)<.001&&(s=0),Math.abs(u)<.001&&(u=0),Math.abs(j)<.001&&(j=0),Math.abs(p)<.001&&(p=0),Math.abs(V)<.001&&(V=0);const de=`translate3d(${$}px,${s}px,${u}px)  rotateX(${p}deg) rotateY(${j}deg) scale(${V})`,pe=Pe(x,r);if(pe.style.transform=de,r.style.zIndex=-Math.abs(Math.round(m))+1,x.slideShadows){let z=k?r.querySelector(".swiper-slide-shadow-left"):r.querySelector(".swiper-slide-shadow-top"),U=k?r.querySelector(".swiper-slide-shadow-right"):r.querySelector(".swiper-slide-shadow-bottom");z||(z=ue("coverflow",r,k?"left":"top")),U||(U=ue("coverflow",r,k?"right":"bottom")),z&&(z.style.opacity=m>0?m:0),U&&(U.style.opacity=-m>0?-m:0)}}},setTransition:E=>{t.slides.map(b=>ce(b)).forEach(b=>{b.style.transitionDuration=`${E}ms`,b.querySelectorAll(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").forEach(B=>{B.style.transitionDuration=`${E}ms`})})},perspective:()=>!0,overwriteParams:()=>({watchSlidesProgress:!0})})}const Ne={id:"proviewpage"},Oe=n("h1",{class:"text-red"}," 已下架 ",-1),Ae={class:"gastlike"},We={__name:"ProductView",setup(N){const t=[De,Te,qe,Me],P=fe(),w=ve(),y=me(),v=I(!1),E=I(!1),S=I(!1),b=I([]);ge(S,()=>{S.value?(document.documentElement.style.overflow="hidden",document.documentElement.style.height="100vh"):(document.documentElement.style.overflow="auto",document.documentElement.style.height="")});const B=async(p,u)=>{console.log(e.value._id);try{await O.patch(`products/${e.value._id}/review`,{id:u}),e.value.peopleSay[p].review=!e.value.peopleSay[p].review}catch(h){console.log(h),w({text:h.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}},x=ae({text:Se().required("缺少評論").min(10,"最少10個字").max(150,"最多150")}),{isSubmitting:k,handleSubmit:M,handleReset:Y}=le({validationSchema:x}),L=oe("text"),a=M(async p=>{try{if(e.value.peopleSay.findIndex(h=>h.user.account===y.account)>-1){const{data:h}=await O.patch(`products/${e.value._id}/say`,{text:p.text});e.value.peopleSay=h.result}else{const{data:h}=await O.post(`products/${e.value._id}/say`,{text:p.text});e.value.peopleSay=h.result,E.value=!0}Y(),v.value=!1}catch(u){w({text:u.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}}),l=ae({quantity:Ee().typeError("缺少數量").required("缺少數量").min(1,"最少1")}),{isSubmitting:c,handleSubmit:r}=le({validationSchema:l,initialValues:{quantity:0}}),d=oe("quantity"),T=r(async p=>{try{const{data:u}=await O.post("users/cart",{product:e.value._id,quantity:p.quantity});y.cart=u.result,d.value.value=0}catch(u){w({text:u.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}}),e=I({_id:"",name:"",price:"",images:[],description:"",category:"",manufacturers:"",sell:!0,color:"",textColor:"",totle:"",peopleSay:[]}),m=I(!1),j=async()=>{try{const{data:p}=await O.post("users/like",{product:e.value._id});y.like=p.result.length,e.value.totle=p.result.totle,(await O.post("/products/red",{app:e.value._id})).data.result?m.value=!0:m.value=!1}catch(p){w({text:p.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}};return(async()=>{try{const{data:p}=await J.get("/products/"+P.params.id);e.value=p.result,e.value.peopleSay.findIndex(V=>V.user.account===y.account)>-1&&(E.value=!0),(await O.post("/products/red",{app:e.value._id})).data.result?m.value=!0:m.value=!1;const{data:s}=await J.get("/products");b.value=s.result.filter(V=>V.category===p.result.category);const $=s.result.findIndex(V=>V._id===e.value._id);b.value.splice($,1),document.title="購物網 |"+e.value.name}catch(p){w({text:p.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}})(),Z.registerPlugin($e),ye(()=>{Z.from(".animationtable",{scrollTrigger:{trigger:".animationtable",start:"top 60%",end:"bottom center"},x:100,opacity:0,duration:2,ease:"none"}),Z.from(".animationfield",{scrollTrigger:{trigger:".animationfield",start:"top 60%",end:"bottom center"},opacity:0,duration:1,ease:"none"}),Z.from(".gastlike",{scrollTrigger:{trigger:".gastlike",start:"top 60%",end:"bottom center"},y:-50,opacity:0,duration:3,ease:"none"})}),(p,u)=>{const h=he("RouterLink");return _(),q(F,null,[n("section",Ne,[o(ie,null,{default:i(()=>[o(G,null,{default:i(()=>[o(H,{cols:"12"},{default:i(()=>[o(g(re),{pagination:{type:"fraction"},navigation:!0,modules:t,loop:!0,speed:3e3,autoplay:{delay:5e3,disableOnInteraction:!1},class:"mySwiper"},{default:i(()=>[(_(!0),q(F,null,R(e.value.images,(s,$)=>(_(),te(g(ne),{key:$},{default:i(()=>[o(W,{src:s,cover:"",style:{width:"100%",height:"100%"}},null,8,["src"])]),_:2},1024))),128))]),_:1})]),_:1}),o(H,{cols:"12"},{default:i(()=>[o(G,null,{default:i(()=>[o(H,{cols:"6",class:"animationtable"},{default:i(()=>[o(K,{style:f(`color:${e.value.color}`),class:"mainveiw"},{default:i(()=>[n("thead",null,[n("tr",null,[n("th",{style:f(`color: ${e.value.color};`)},"作品名",4),n("td",null,C(e.value.name),1)]),n("tr",null,[n("th",{style:f(`color: ${e.value.color};`)},"分類",4),n("td",null,C(e.value.category),1)]),n("tr",null,[n("th",{style:f(`color: ${e.value.color};`)},"製造商",4),n("td",null,C(e.value.manufacturers),1)]),n("tr",null,[n("th",{style:f(`color: ${e.value.color};`)},"價格",4),n("td",null,C(e.value.price),1)])])]),_:1},8,["style"])]),_:1}),o(H,{style:f(`color: ${e.value.color};`),class:"txt"},{default:i(()=>[o(G,{class:"d-flex align-center flex-column justify-center animationfield",style:{"text-align":"center",height:"100%"}},{default:i(()=>[o(H,null,{default:i(()=>[n("p",null,C(e.value.description),1)]),_:1}),o(H,null,{default:i(()=>[o(se,{disabled:g(c),onSubmit:Q(g(T),["prevent"]),style:f(`border-bottom: 15px solid ${e.value.color};`),class:"underline"},{default:i(()=>[o(ee,{modelValue:g(d).value.value,"onUpdate:modelValue":u[0]||(u[0]=s=>g(d).value.value=s),modelModifiers:{number:!0},type:"number",label:"數量",min:"0","error-messages":g(d).errorMessage.value},null,8,["modelValue","error-messages"]),o(A,{style:f(`background-color:${e.value.color};color: ${e.value.textColor};`),type:"submit"},{default:i(()=>[D("加入購物車 ")]),_:1},8,["style"]),o(A,{style:f(`background-color:${m.value?e.value.textColor:e.value.color}; color:${m.value?e.value.color:e.value.textColor}`),onClick:j},{default:i(()=>[D(C(m.value?"已加收藏":"加入收藏"),1)]),_:1},8,["style"]),o(A,{style:f(`background-color:${e.value.color};color: ${e.value.textColor};`),onClick:u[1]||(u[1]=s=>S.value=!S.value)},{default:i(()=>[D(" 查看評論 ")]),_:1},8,["style"])]),_:1},8,["disabled","onSubmit","style"])]),_:1})]),_:1})]),_:1},8,["style"])]),_:1})]),_:1})]),_:1})]),_:1}),o(we,{"model-value":!e.value.sell,persistent:"",class:"align-center justify-center text-center"},{default:i(()=>[Oe,o(A,{to:"/"},{default:i(()=>[D(" 回上頁")]),_:1})]),_:1},8,["model-value"]),o(Be,{modelValue:S.value,"onUpdate:modelValue":u[3]||(u[3]=s=>S.value=s),location:"right",temporary:"",width:"700",style:f(`background-color:${e.value.color};`)},{default:i(()=>[n("div",null,[o(K,{style:f(`color:${e.value.textColor}; background-color:${e.value.color};`)},{default:i(()=>[n("thead",null,[n("tr",null,[n("th",{style:f(`color:${e.value.textColor};`)},"使用者",4),n("th",{style:f(`color:${e.value.textColor};`)},"評論",4),n("th",{style:f(`color:${e.value.textColor};`)},"日期",4),g(y).role===1?(_(),q("th",{key:0,style:f(`color:${e.value.textColor};`)},"審核",4)):X("",!0)])]),n("tbody",null,[g(y).role===0?(_(!0),q(F,{key:0},R(e.value.peopleSay,(s,$)=>(_(),q("tr",{key:$},[s.review?X("",!0):(_(),q(F,{key:0},[n("td",null,C(s.user.name),1),n("td",null,C(s.text),1),n("td",null,C(new Date(s.date).toLocaleString()),1)],64))]))),128)):X("",!0),g(y).role===1?(_(!0),q(F,{key:1},R(e.value.peopleSay,(s,$)=>(_(),q("tr",{key:$},[n("td",null,[o(W,{style:{display:"inline-block","vertical-align":"middle"},src:`https://source.boringavatars.com/beam/120/${s.user.account}?colors=0db2ac,f5dd7e,fc8d4d,fc694d,faba32`,width:"50px"},null,8,["src"]),D(" "+C(s.user.name),1)]),n("td",null,C(s.text),1),n("td",null,C(new Date(s.date).toLocaleString()),1),n("td",null,[o(A,{onClick:V=>B($,s.user._id),style:f(`background-color:${s.review?e.value.textColor:e.value.color}; color:${s.review?e.value.color:e.value.textColor}`)},{default:i(()=>[D(C(s.review?"未通過":"已通過"),1)]),_:2},1032,["onClick","style"])])]))),128)):X("",!0)])]),_:1},8,["style"])]),o(A,{onClick:u[2]||(u[2]=s=>v.value=!0),style:f(`background-color:${E.value?e.value.textColor:e.value.color}; color:${E.value?e.value.color:e.value.textColor}`),class:"otherbtn"},{default:i(()=>[D(C(E.value?"編輯評論":"新增評論"),1)]),_:1},8,["style"])]),_:1},8,["modelValue","style"]),o(be,{modelValue:v.value,"onUpdate:modelValue":u[5]||(u[5]=s=>v.value=s),width:"auto"},{default:i(()=>[o(se,{disabled:g(k),onSubmit:Q(g(a),["prevent"]),style:{width:"400px"}},{default:i(()=>[o(xe,{style:f(`background-color:${e.value.color};color: ${e.value.textColor};`)},{default:i(()=>[o(ke,null,{default:i(()=>[o(W,{src:g(y).avatar,style:{width:"20%",display:"inline-block"}},null,8,["src"]),n("span",null,C(g(y).name),1)]),_:1}),o(Ce,null,{default:i(()=>[o(ee,{modelValue:g(L).value.value,"onUpdate:modelValue":u[4]||(u[4]=s=>g(L).value.value=s),label:"留言",counter:"",maxlength:"150","error-messages":g(L).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),o(A,{type:"submit",class:"otherbtn",style:f(`background-color:${e.value.textColor};color: ${e.value.color};`)},{default:i(()=>[D(" 確認")]),_:1},8,["style"])]),_:1},8,["style"])]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])]),o(ie,null,{default:i(()=>[n("section",Ae,[n("div",{class:"link",style:f(`border-bottom: 5px solid ${e.value.color};`)},[n("span",{style:f(`background-color:${e.value.color};color: ${e.value.textColor};`)}," 關聯商品",4)],4),o(g(re),{effect:"coverflow",grabCursor:!0,centeredSlides:!0,slidesPerView:"auto",coverflowEffect:{rotate:50,stretch:0,depth:100,modifier:1,slideShadows:!0},speed:2e3,pagination:!0,modules:t,class:"mySwiper",initialSlide:2},{default:i(()=>[(_(!0),q(F,null,R(b.value,s=>(_(),te(g(ne),{key:s._id},{default:i(()=>[o(h,{to:/proHome/+s._id},{default:i(()=>[o(W,{src:s.images[0],cover:""},null,8,["src"])]),_:2},1032,["to"])]),_:2},1024))),128))]),_:1})])]),_:1})],64)}}};export{We as default};

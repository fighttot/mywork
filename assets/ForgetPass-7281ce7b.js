import{b as S,d as B,a as F,T as v,f as M,j as U,w as r,i as s,E as q,l as a,$ as P,a1 as l,x as w,y as V,t as g}from"./index-bd1cf992.js";import{v as $}from"./index-33ee1372.js";import{c as E,a as n,d as N,u as R,b as u,V as T}from"./index.esm-463ea2d4.js";import{V as j}from"./VContainer-abffc603.js";import{a as b,V as D}from"./VRow-91ca0be0.js";/* empty css              */const O=w("h1",null,"忘記密碼",-1),z={class:"text-center"},Q={__name:"ForgetPass",setup(A){const i=S(),x=B(),k=F(),C=E({account:n().required("帳號必填").min(4,"最少四個字").max(20,"最多20"),email:n().required("信箱必填").test("isEmail","信箱格式錯誤",o=>$.isEmail(o)),password:n().required("密碼必填").min(4,"最少四個字").max(20,"最多20"),passwordConfirm:n().required("密碼必填").min(4,"最少四個字").max(20,"最多20").oneOf([N("password")],"密碼不一致")}),{handleSubmit:_,isSubmitting:h,handleReset:f}=R({validationSchema:C}),m=u("account"),d=u("email"),c=u("password"),p=u("passwordConfirm"),y=_(async o=>{try{await v.post("/users/forget",{account:o.account,email:o.email,password:o.password}),i({text:"修改成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom",rounded:"pill",variant:"tonal"}});const{data:e}=await v.post("/users/login",{account:o.account,password:o.password});k.login({token:e.result.token,account:e.result.account,name:e.result.name,email:e.result.email,cart:e.result.cart,role:e.result.role,like:e.result.like}),i({text:"登入成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom",rounded:"pill",variant:"tonal"}}),f(),x.push("/")}catch(e){i({text:e.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom",rounded:"pill",variant:"tonal"}})}});return(o,e)=>(M(),U(j,null,{default:r(()=>[s(D,null,{default:r(()=>[s(b,{cols:"12",class:"text-center"},{default:r(()=>[O]),_:1}),s(q),s(b,{cols:"12",style:{padding:"200px 10px 30px 10px"}},{default:r(()=>[s(T,{disabled:a(h),onSubmit:P(a(y),["prevent"])},{default:r(()=>[s(l,{modelValue:a(m).value.value,"onUpdate:modelValue":e[0]||(e[0]=t=>a(m).value.value=t),label:"帳號:",counter:"","max-length":"20","error-messages":a(m).errorMessage.value},null,8,["modelValue","error-messages"]),s(l,{modelValue:a(c).value.value,"onUpdate:modelValue":e[1]||(e[1]=t=>a(c).value.value=t),label:"密碼:",counter:"","max-length":"20",type:"password","error-messages":a(c).errorMessage.value},null,8,["modelValue","error-messages"]),s(l,{modelValue:a(p).value.value,"onUpdate:modelValue":e[2]||(e[2]=t=>a(p).value.value=t),label:"確認密碼:",counter:"","max-length":"20",type:"password","error-messages":a(p).errorMessage.value},null,8,["modelValue","error-messages"]),s(l,{modelValue:a(d).value.value,"onUpdate:modelValue":e[3]||(e[3]=t=>a(d).value.value=t),label:"信箱(不得重複):",type:"email","error-messages":a(d).errorMessage.value},null,8,["modelValue","error-messages"]),w("div",z,[s(V,{type:"submit"},{default:r(()=>[g("創新密碼")]),_:1}),s(V,{onClick:a(f)},{default:r(()=>[g("重製")]),_:1},8,["onClick"])])]),_:1},8,["disabled","onSubmit"])]),_:1})]),_:1})]),_:1}))}};export{Q as default};

import{aX as Q,b as W,a as ee,r as P,O as te,aY as ae,H as _,T as le,f as k,h as $,i as r,w as n,aZ as oe,X as d,am as re,m,F as T,p as j,U as H,y as s,D as f,Y as R,Z as X,V as S,v as E,k as U,B as se,an as ne,l as I,C as ie,j as ue}from"./index-96f45286.js";import{c as Z,a as ce,u as z,b as G,e as de,V as J}from"./index.esm-bcc65104.js";import{b as ve,S as pe,P as me,A as fe,a as ge}from"./autoplay-2f613c62.js";import{V as ye}from"./VContainer-cd18ad95.js";import{V as be}from"./VNavigationDrawer-9f835b66.js";import{V as M,a as L}from"./VRow-c8f2bb70.js";/* empty css              */function xe(Y){let{swiper:t,extendParams:F,on:b,emit:g}=Y;F({navigation:{nextEl:null,prevEl:null,hideOnClick:!1,disabledClass:"swiper-button-disabled",hiddenClass:"swiper-button-hidden",lockClass:"swiper-button-lock",navigationDisabledClass:"swiper-navigation-disabled"}}),t.navigation={nextEl:null,prevEl:null};const y=a=>(Array.isArray(a)?a:[a]).filter(o=>!!o);function C(a){let o;return a&&typeof a=="string"&&t.isElement&&(o=t.el.querySelector(a),o)?o:(a&&(typeof a=="string"&&(o=[...document.querySelectorAll(a)]),t.params.uniqueNavElements&&typeof a=="string"&&o.length>1&&t.el.querySelectorAll(a).length===1&&(o=t.el.querySelector(a))),a&&!o?a:o)}function x(a,o){const c=t.params.navigation;a=y(a),a.forEach(i=>{i&&(i.classList[o?"add":"remove"](...c.disabledClass.split(" ")),i.tagName==="BUTTON"&&(i.disabled=o),t.params.watchOverflow&&t.enabled&&i.classList[t.isLocked?"add":"remove"](c.lockClass))})}function V(){const{nextEl:a,prevEl:o}=t.navigation;if(t.params.loop){x(o,!1),x(a,!1);return}x(o,t.isBeginning&&!t.params.rewind),x(a,t.isEnd&&!t.params.rewind)}function D(a){a.preventDefault(),!(t.isBeginning&&!t.params.loop&&!t.params.rewind)&&(t.slidePrev(),g("navigationPrev"))}function A(a){a.preventDefault(),!(t.isEnd&&!t.params.loop&&!t.params.rewind)&&(t.slideNext(),g("navigationNext"))}function B(){const a=t.params.navigation;if(t.params.navigation=ve(t,t.originalParams.navigation,t.params.navigation,{nextEl:"swiper-button-next",prevEl:"swiper-button-prev"}),!(a.nextEl||a.prevEl))return;let o=C(a.nextEl),c=C(a.prevEl);Object.assign(t.navigation,{nextEl:o,prevEl:c}),o=y(o),c=y(c);const i=(v,e)=>{v&&v.addEventListener("click",e==="next"?A:D),!t.enabled&&v&&v.classList.add(...a.lockClass.split(" "))};o.forEach(v=>i(v,"next")),c.forEach(v=>i(v,"prev"))}function q(){let{nextEl:a,prevEl:o}=t.navigation;a=y(a),o=y(o);const c=(i,v)=>{i.removeEventListener("click",v==="next"?A:D),i.classList.remove(...t.params.navigation.disabledClass.split(" "))};a.forEach(i=>c(i,"next")),o.forEach(i=>c(i,"prev"))}b("init",()=>{t.params.navigation.enabled===!1?O():(B(),V())}),b("toEdge fromEdge lock unlock",()=>{V()}),b("destroy",()=>{q()}),b("enable disable",()=>{let{nextEl:a,prevEl:o}=t.navigation;a=y(a),o=y(o),[...a,...o].filter(c=>!!c).forEach(c=>c.classList[t.enabled?"remove":"add"](t.params.navigation.lockClass))}),b("click",(a,o)=>{let{nextEl:c,prevEl:i}=t.navigation;c=y(c),i=y(i);const v=o.target;if(t.params.navigation.hideOnClick&&!i.includes(v)&&!c.includes(v)){if(t.pagination&&t.params.pagination&&t.params.pagination.clickable&&(t.pagination.el===v||t.pagination.el.contains(v)))return;let e;c.length?e=c[0].classList.contains(t.params.navigation.hiddenClass):i.length&&(e=i[0].classList.contains(t.params.navigation.hiddenClass)),g(e===!0?"navigationShow":"navigationHide"),[...c,...i].filter(h=>!!h).forEach(h=>h.classList.toggle(t.params.navigation.hiddenClass))}});const N=()=>{t.el.classList.remove(...t.params.navigation.navigationDisabledClass.split(" ")),B(),V()},O=()=>{t.el.classList.add(...t.params.navigation.navigationDisabledClass.split(" ")),q()};Object.assign(t.navigation,{enable:N,disable:O,update:V,init:B,destroy:q})}const he={id:"proviewpage"},ke=s("h1",{class:"text-red"}," 已下架 ",-1),Be={__name:"ProductView",setup(Y){const t=[me,fe,xe],F=Q(),b=W(),g=ee(),y=P(!1),C=P(!1),x=P(!1);te(x,()=>{x.value?(document.documentElement.style.overflow="hidden",document.documentElement.style.height="100vh"):(document.documentElement.style.overflow="auto",document.documentElement.style.height="")}),ae({text:""});const V=async(p,u)=>{console.log(e.value._id);try{await _.patch(`products/${e.value._id}/review`,{id:u}),e.value.peopleSay[p].review=!e.value.peopleSay[p].review}catch(l){console.log(l),b({text:l.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}},D=Z({text:ce().required("缺少評論").min(10,"最少10個字").max(150,"最多150")}),{isSubmitting:A,handleSubmit:B,handleReset:q}=z({validationSchema:D}),N=G("text"),O=B(async p=>{try{if(e.value.peopleSay.findIndex(l=>l.user.account===g.account)>-1){const{data:l}=await _.patch(`products/${e.value._id}/say`,{text:p.text});e.value.peopleSay=l.result}else{const{data:l}=await _.post(`products/${e.value._id}/say`,{text:p.text});e.value.peopleSay=l.result,C.value=!0}q(),y.value=!1}catch(u){b({text:u.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}}),a=Z({quantity:de().typeError("缺少數量").required("缺少數量").min(1,"最少1")}),{isSubmitting:o,handleSubmit:c}=z({validationSchema:a,initialValues:{quantity:0}}),i=G("quantity"),v=c(async p=>{try{const{data:u}=await _.post("users/cart",{product:e.value._id,quantity:p.quantity});g.cart=u.result,i.value.value=0}catch(u){b({text:u.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}}),e=P({_id:"",name:"",price:"",images:[],description:"",category:"",manufacturers:"",sell:!0,color:"",textColor:"",totle:"",peopleSay:[]}),h=P(!1),K=async()=>{try{const{data:p}=await _.post("users/like",{product:e.value._id});g.like=p.result.length,e.value.totle=p.result.totle,(await _.post("/products/red",{app:e.value._id})).data.result?h.value=!0:h.value=!1}catch(p){b({text:p.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}};return(async()=>{try{const{data:p}=await le.get("/products/"+F.params.id);e.value=p.result;const u=e.value.peopleSay.findIndex(w=>w.user.account===g.account);console.log(u),u>-1&&(C.value=!0),(await _.post("/products/red",{app:e.value._id})).data.result?h.value=!0:h.value=!1,document.title="購物網 |"+e.value.name}catch(p){b({text:p.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}})(),(p,u)=>(k(),$("section",he,[r(ye,null,{default:n(()=>[r(M,null,{default:n(()=>[r(L,{cols:"12"},{default:n(()=>[r(m(pe),{pagination:{type:"fraction"},navigation:!0,modules:t,loop:!0,speed:3e3,autoplay:{delay:5e3,disableOnInteraction:!1},class:"mySwiper"},{default:n(()=>[(k(!0),$(T,null,j(e.value.images,(l,w)=>(k(),ue(m(ge),{key:w},{default:n(()=>[r(I,{src:l,cover:"",style:{width:"100%",height:"100%"}},null,8,["src"])]),_:2},1024))),128))]),_:1})]),_:1}),r(L,{cols:"12"},{default:n(()=>[r(M,null,{default:n(()=>[r(L,{cols:"6"},{default:n(()=>[r(H,{style:d(`color:${e.value.textColor}`),class:"mainveiw"},{default:n(()=>[s("thead",null,[s("tr",null,[s("th",{style:d(`background-color:${e.value.color};color: ${e.value.textColor};`)},"作品名",4),s("td",{style:d(`background-color:${e.value.color};`)},f(e.value.name),5)]),s("tr",null,[s("th",{style:d(`background-color:${e.value.color};color: ${e.value.textColor};`)},"分類",4),s("td",{style:d(`background-color:${e.value.color};`)},f(e.value.category),5)]),s("tr",null,[s("th",{style:d(`background-color:${e.value.color};color: ${e.value.textColor};`)},"製造商",4),s("td",{style:d(`background-color:${e.value.color};`)},f(e.value.manufacturers),5)]),s("tr",null,[s("th",{style:d(`background-color:${e.value.color};color: ${e.value.textColor};`)},"價格",4),s("td",{style:d(`background-color:${e.value.color};`)},f(e.value.price),5)])])]),_:1},8,["style"])]),_:1}),r(L,{style:d(`color: ${e.value.textColor}; background-color:${e.value.color};`),class:"txt"},{default:n(()=>[r(M,{class:"d-flex align-center flex-column justify-center",style:{"text-align":"center",height:"100%"}},{default:n(()=>[r(L,null,{default:n(()=>[s("p",null,f(e.value.description),1)]),_:1}),r(L,null,{default:n(()=>[r(J,{disabled:m(o),onSubmit:R(m(v),["prevent"])},{default:n(()=>[r(X,{modelValue:m(i).value.value,"onUpdate:modelValue":u[0]||(u[0]=l=>m(i).value.value=l),modelModifiers:{number:!0},type:"number",label:"數量",min:"0","error-messages":m(i).errorMessage.value},null,8,["modelValue","error-messages"]),r(S,{style:d(`background-color:${e.value.color};color: ${e.value.textColor};`),type:"submit"},{default:n(()=>[E("加入購物車 ")]),_:1},8,["style"]),r(S,{style:d(`background-color:${h.value?e.value.textColor:e.value.color}; color:${h.value?e.value.color:e.value.textColor}`),onClick:K},{default:n(()=>[E(f(h.value?"已加收藏":"加入收藏"),1)]),_:1},8,["style"]),r(S,{style:d(`background-color:${e.value.color};color: ${e.value.textColor};`),onClick:u[1]||(u[1]=l=>x.value=!x.value)},{default:n(()=>[E(" 查看評論 ")]),_:1},8,["style"])]),_:1},8,["disabled","onSubmit"])]),_:1})]),_:1})]),_:1},8,["style"])]),_:1})]),_:1})]),_:1})]),_:1}),r(oe,{"model-value":!e.value.sell,persistent:"",class:"align-center justify-center text-center"},{default:n(()=>[ke,r(S,{to:"/"},{default:n(()=>[E(" 回上頁")]),_:1})]),_:1},8,["model-value"]),r(be,{modelValue:x.value,"onUpdate:modelValue":u[3]||(u[3]=l=>x.value=l),location:"right",temporary:"",width:"700",style:d(`background-color:${e.value.color};`)},{default:n(()=>[s("div",null,[r(H,{style:d(`color:${e.value.textColor}; background-color:${e.value.color};`)},{default:n(()=>[s("thead",null,[s("tr",null,[s("th",{style:d(`color:${e.value.textColor};`)},"使用者",4),s("th",{style:d(`color:${e.value.textColor};`)},"評論",4),s("th",{style:d(`color:${e.value.textColor};`)},"日期",4),m(g).role===1?(k(),$("th",{key:0,style:d(`color:${e.value.textColor};`)},"審核",4)):U("",!0)])]),s("tbody",null,[m(g).role===0?(k(!0),$(T,{key:0},j(e.value.peopleSay,(l,w)=>(k(),$("tr",{key:w},[l.review?U("",!0):(k(),$(T,{key:0},[s("td",null,f(l.user.name),1),s("td",null,f(l.text),1),s("td",null,f(new Date(l.date).toLocaleString()),1)],64))]))),128)):U("",!0),m(g).role===1?(k(!0),$(T,{key:1},j(e.value.peopleSay,(l,w)=>(k(),$("tr",{key:w},[s("td",null,[r(I,{style:{display:"inline-block","vertical-align":"middle"},src:`https://source.boringavatars.com/beam/120/${l.user.account}?colors=0db2ac,f5dd7e,fc8d4d,fc694d,faba32`,width:"50px"},null,8,["src"]),E(" "+f(l.user.name),1)]),s("td",null,f(l.text),1),s("td",null,f(new Date(l.date).toLocaleString()),1),s("td",null,[r(S,{onClick:Ce=>V(w,l.user._id),style:d(`background-color:${l.review?e.value.textColor:e.value.color}; color:${l.review?e.value.color:e.value.textColor}`)},{default:n(()=>[E(f(l.review?"未通過":"已通過"),1)]),_:2},1032,["onClick","style"])])]))),128)):U("",!0)])]),_:1},8,["style"])]),r(S,{onClick:u[2]||(u[2]=l=>y.value=!0),style:d(`background-color:${C.value?e.value.textColor:e.value.color}; color:${C.value?e.value.color:e.value.textColor}`),class:"otherbtn"},{default:n(()=>[E(f(C.value?"編輯評論":"新增評論"),1)]),_:1},8,["style"])]),_:1},8,["modelValue","style"]),r(re,{modelValue:y.value,"onUpdate:modelValue":u[5]||(u[5]=l=>y.value=l),width:"auto"},{default:n(()=>[r(J,{disabled:m(A),onSubmit:R(m(O),["prevent"]),style:{width:"400px"}},{default:n(()=>[r(se,{style:d(`background-color:${e.value.color};color: ${e.value.textColor};`)},{default:n(()=>[r(ne,null,{default:n(()=>[r(I,{src:m(g).avatar,style:{width:"20%",display:"inline-block"}},null,8,["src"]),s("span",null,f(m(g).name),1)]),_:1}),r(ie,null,{default:n(()=>[r(X,{modelValue:m(N).value.value,"onUpdate:modelValue":u[4]||(u[4]=l=>m(N).value.value=l),label:"留言",counter:"",maxlength:"150","error-messages":m(N).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),r(S,{type:"submit",class:"otherbtn",style:d(`background-color:${e.value.color};color: ${e.value.textColor};`)},{default:n(()=>[E(" 確認")]),_:1},8,["style"])]),_:1},8,["style"])]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])]))}};export{Be as default};

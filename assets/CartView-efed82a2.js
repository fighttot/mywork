import{b as E,d as X,a as Y,r as x,c as I,H as w,e as G,f as u,h as b,x as a,i as l,w as s,F as M,m as N,X as J,n as K,k as m,D as y,y as i,t as c,Y as O,B as Q,Z as W,l as r,_ as ee,j as f,$ as P,a0 as te,a1 as ae,a2 as le}from"./index-135ad35f.js";import{c as oe,a as S,u as se,b as $,V as re}from"./index.esm-b2c7d774.js";import{F as ne}from"./FooTer-5c2c6d54.js";import{V as ue}from"./VContainer-2029351e.js";import{V as de,a as B}from"./VRow-e45d5b6b.js";/* empty css              */const ie=""+new URL("Zuikaku-a004b63d.jpg",import.meta.url).href,ce={class:"cardview"},pe={class:"othertitle"},me={class:"bgbox"},ve=a("div",{class:"bgbox2"},null,-1),ye=a("h1",null,"購物車",-1),fe=a("thead",null,[a("tr",null,[a("th",null,"圖片"),a("th",null,"名稱"),a("th",null,"單價"),a("th",null,"數量"),a("th",null,"小記"),a("th",null,"操作")])],-1),_e={key:0,colspan:"6",class:"text-center"},we={__name:"CartView",setup(he){const _=E(),R=X(),q=Y(),n=x([]),v=x(!1),d=x(!0),F=["萊爾富","7-11","全家"],D=["貨到付款現金","貨到付款刷卡"],g=async(o,t)=>{try{const{data:p}=await w.post("users/cart",{product:o,quantity:t}),e=n.value.findIndex(k=>k.product._id===o);n.value[e].quantity+=t,n.value[e].quantity<=0&&n.value.splice(e,1),q.cart=p.result}catch(p){console.log(p),_({text:p.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom",rounded:"pill",variant:"tonal"}})}},j=I(()=>n.value.length>0&&!n.value.some(o=>!o.product.sell)),z=I(()=>n.value.reduce((o,t)=>o+t.quantity*t.product.price,0));(async()=>{try{const{data:o}=await w.get("/users/cart");n.value.push(...o.result)}catch(o){_({text:o.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom",rounded:"pill",variant:"tonal"}})}})();const H=oe({seventhome:S().required("缺少製造商").test("地址錯誤",o=>F.includes(o)),paypoint:S().required("缺少店址"),payway:S().required("缺少付款方式")}),{handleSubmit:L,isSubmitting:Z,handleReset:U}=se({validationSchema:H}),V=$("seventhome"),C=$("paypoint"),h=$("payway"),A=()=>{h.value.value?d.value=!1:_({text:"請填寫付款方式",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom",rounded:"pill",variant:"tonal"}})},T=L(async o=>{try{await w.post("/orders",{seventhome:o.seventhome+o.paypoint,paywat:o.payway}),q.cart=0,R.push("/orders"),v.value=!1,d.value=!0,U()}catch(t){_({text:t.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom",rounded:"pill",variant:"tonal"}})}});return(o,t)=>{const p=G("router-link");return u(),b(M,null,[a("section",ce,[a("section",pe,[a("div",me,[l(N,{class:"mainimg",src:ie,cover:""})]),ve]),l(ue,null,{default:s(()=>[l(de,null,{default:s(()=>[l(B,{cols:"12"},{default:s(()=>[ye]),_:1}),l(B,{cols:"12",class:"cartheight"},{default:s(()=>[l(J,null,{default:s(()=>[fe,a("tbody",null,[(u(!0),b(M,null,K(n.value,e=>(u(),b("tr",{key:e._id,class:ae({"bg-red-lighten-5":!e.product.sell})},[a("td",null,[l(N,{src:e.product.images[0],cover:"","aspect-ratio":"1"},null,8,["src"])]),a("td",{style:le(`color: ${e.product.textColor};`)},[l(p,{to:`/proHome/${e.product._id}`},{default:s(()=>[c(y(e.product.name),1)]),_:2},1032,["to"])],4),a("td",null,y(e.product.price),1),a("td",null,[l(i,{color:"primary",variant:"text",icon:"mdi-minus",onClick:k=>g(e.product._id,-1)},null,8,["onClick"]),c(" "+y(e.quantity)+" ",1),l(i,{color:"primary",variant:"text",icon:"mdi-plus",onClick:k=>g(e.product._id,1)},null,8,["onClick"])]),a("td",null,y(e.quantity*e.product.price),1),a("td",null,[l(i,{color:"red",variant:"text",icon:"mdi-delete",onClick:k=>g(e.product._id,e.quantity*-1)},null,8,["onClick"])])],2))),128)),a("tr",null,[n.value.length===0?(u(),b("td",_e,"沒有商品")):m("",!0)])])]),_:1})]),_:1}),l(B,{cols:"12",class:"text-center"},{default:s(()=>[a("p",null,"總金額:"+y(z.value),1),l(i,{color:"green",onClick:t[0]||(t[0]=e=>v.value=!0)},{default:s(()=>[c("結帳")]),_:1})]),_:1})]),_:1}),l(O,{modelValue:v.value,"onUpdate:modelValue":t[6]||(t[6]=e=>v.value=e),width:"400px",persistent:""},{default:s(()=>[l(Q,{class:"text-center"},{default:s(()=>[l(W,null,{default:s(()=>[c("結帳資訊")]),_:1}),l(re,{disabled:r(Z),onSubmit:ee(r(T),["prevent"])},{default:s(()=>[d.value?m("",!0):(u(),f(P,{key:0,items:F,label:"便利商店貨到付款",modelValue:r(V).value.value,"onUpdate:modelValue":t[1]||(t[1]=e=>r(V).value.value=e),"error-messages":r(V).errorMessage.value},null,8,["modelValue","error-messages"])),d.value?(u(),f(P,{key:1,label:"付款方式?",modelValue:r(h).value.value,"onUpdate:modelValue":t[2]||(t[2]=e=>r(h).value.value=e),"error-messages":r(h).errorMessage.value,items:D},null,8,["modelValue","error-messages"])):m("",!0),d.value?m("",!0):(u(),f(te,{key:2,label:"哪一家店?",modelValue:r(C).value.value,"onUpdate:modelValue":t[3]||(t[3]=e=>r(C).value.value=e),"error-messages":r(C).errorMessage.value},null,8,["modelValue","error-messages"])),d.value?m("",!0):(u(),f(i,{key:3,onClick:t[4]||(t[4]=e=>d.value=!0)},{default:s(()=>[c("上一步")]),_:1})),d.value?(u(),f(i,{key:4,onClick:A},{default:s(()=>[c("下一步")]),_:1})):m("",!0),l(i,{color:"green",onClick:r(T),disabled:!j.value},{default:s(()=>[c("結帳")]),_:1},8,["onClick","disabled"]),l(i,{onClick:t[5]||(t[5]=e=>(v.value=!1,r(U)()))},{default:s(()=>[c("取消")]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),l(ne)],64)}}};export{we as default};

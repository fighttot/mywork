import{b as Z,d as A,a as G,r as $,c as E,I as B,U as J,X as K,e as O,o as i,f as V,i as a,j as o,l,V as c,F as L,Z as Q,_ as ee,p as te,m as g,E as f,z as d,x as p,$ as oe,C as ae,a0 as le,h as r,a1 as se,k as h,a2 as N,a3 as re,a4 as ne}from"./index-b6fafbca.js";import{_ as ie,a as ue,b as ce,c as de,d as pe,e as me}from"./kokkoro5-b37e87e4.js";import{c as ve,a as F,u as ge,b as U,V as ye}from"./index.esm-74ac7573.js";import{F as _e}from"./FooTer-21f1a44d.js";import{p as fe}from"./parallax-51db526d.js";import{g as he}from"./index-4db78ffb.js";import{V as be}from"./VContainer-897ff6ef.js";import{V as ke,a as I}from"./VRow-d4423488.js";/* empty css              */const Ve=""+new URL("Zuikaku3-d1cccb77.jpg",import.meta.url).href,xe={class:"cardview"},Ce={class:"othertitle"},we={class:"bgbox"},Se={class:"scene"},qe={class:"imgbox","data-depth":"-0.5"},$e={class:"d-flex align-center justify-center fill-height"},Be=a("div",{class:"bgbox2"},null,-1),Fe=a("h1",null,"購物車",-1),Ue=a("thead",null,[a("tr",null,[a("th",null,"圖片"),a("th",null,"名稱"),a("th",null,"單價"),a("th",null,"數量"),a("th",null,"小記"),a("th",null,"操作")])],-1),Ie={key:0,colspan:"6",class:"text-center"},We={__name:"CartView",setup(Te){const b=Z(),R=A(),x=G(),n=$([]),y=$(!1),u=$(!0),T=["萊爾富","7-11","全家"],X=["貨到付款現金","貨到付款刷卡"],C=async(s,t)=>{try{const{data:m}=await B.post("users/cart",{product:s,quantity:t}),e=n.value.findIndex(v=>v.product._id===s);n.value[e].quantity+=t,n.value[e].quantity<=0&&n.value.splice(e,1),x.cart=m.result}catch(m){console.log(m),b({text:m.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom",rounded:"pill",variant:"tonal"}})}},j=E(()=>n.value.length>0&&!n.value.some(s=>!s.product.sell)),H=E(()=>n.value.reduce((s,t)=>s+t.quantity*t.product.price,0)),W=ve({seventhome:F().required("缺少製造商").test("地址錯誤",s=>T.includes(s)),paypoint:F().required("缺少店址"),payway:F().required("缺少付款方式")}),{handleSubmit:Y,isSubmitting:z,handleReset:M}=ge({validationSchema:W}),w=U("seventhome"),S=U("paypoint"),k=U("payway"),D=()=>{k.value.value?u.value=!1:b({text:"請填寫付款方式",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom",rounded:"pill",variant:"tonal"}})},P=Y(async s=>{try{await B.post("/orders",{seventhome:s.seventhome+s.paypoint,paywat:s.payway}),x.cart=0,R.push("/orders"),y.value=!1,u.value=!0,M()}catch(t){b({text:t.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom",rounded:"pill",variant:"tonal"}})}});return J(async()=>{try{const{data:_}=await B.get("/users/cart");n.value.push(..._.result)}catch(_){b({text:_.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom",rounded:"pill",variant:"tonal"}})}await K();const s=window.innerWidth,t=window.innerHeight;he.timeline({defaults:{duration:6,ease:"linear"},repeat:-1}).to(".scrolling1",{y:t/2}).to(".scrolling1",{opacity:0,duration:0}).to(".scrolling",{opacity:1,duration:0}).to(".scrolling",{x:s-100,duration:10}).to(".scrolling",{opacity:0,duration:0}).to(".scrolling2",{opacity:1,duration:0}).to(".scrolling2",{y:-t/2}).to(".scrolling2",{opacity:0,duration:0}).to(".scrolling3",{opacity:1,duration:0}).to(".scrolling3",{y:t/2}).to(".scrolling3",{opacity:0,duration:0}).to(".scrolling4",{opacity:1,duration:0}).to(".scrolling4",{x:-s+100,duration:10}).to(".scrolling4",{opacity:0,duration:0}).to(".scrolling5",{opacity:1,duration:0}).to(".scrolling5",{y:-t/2});const e=document.querySelector(".scene"),v=document.querySelector(".bgbox"),q=new fe(e,{scalarX:10,scalarY:10,frictionX:.1,frictionY:.1,limitX:100,limitY:100});q.disable(),v.addEventListener("mouseover",_=>{q.enable()}),v.addEventListener("mouseout",_=>{q.disable()}),x.loding=!1}),(s,t)=>{const m=O("router-link");return i(),V(L,null,[a("section",xe,[o(c,{src:ie,cover:"",class:"scrolling"}),o(c,{src:ue,cover:"",class:"scrolling1"}),o(c,{src:ce,cover:"",class:"scrolling2"}),o(c,{src:de,cover:"",class:"scrolling3"}),o(c,{src:pe,cover:"",class:"scrolling4"}),o(c,{src:me,cover:"",class:"scrolling5"}),a("section",Ce,[a("div",we,[a("div",Se,[a("div",qe,[o(c,{class:"mainimg",src:Ve,cover:""},{placeholder:l(()=>[a("div",$e,[o(Q,{color:"grey-lighten-4",indeterminate:""})])]),_:1})])])]),Be]),o(be,null,{default:l(()=>[o(ke,null,{default:l(()=>[o(I,{cols:"12"},{default:l(()=>[Fe]),_:1}),o(I,{cols:"12",class:"cartheight"},{default:l(()=>[o(ee,null,{default:l(()=>[Ue,a("tbody",null,[(i(!0),V(L,null,te(n.value,e=>(i(),V("tr",{key:e._id,class:ne({"bg-red-lighten-5":!e.product.sell})},[a("td",null,[o(c,{src:e.product.images[0],cover:"","aspect-ratio":"1"},null,8,["src"])]),a("td",null,[o(m,{to:`/proHome/${e.product._id}`},{default:l(()=>[p(f(e.product.name),1)]),_:2},1032,["to"])]),a("td",null,f(e.product.price),1),a("td",null,[o(d,{color:"primary",variant:"text",icon:"mdi-minus",onClick:v=>C(e.product._id,-1)},null,8,["onClick"]),p(" "+f(e.quantity)+" ",1),o(d,{color:"primary",variant:"text",icon:"mdi-plus",onClick:v=>C(e.product._id,1)},null,8,["onClick"])]),a("td",null,f(e.quantity*e.product.price),1),a("td",null,[o(d,{color:"red",variant:"text",icon:"mdi-delete",onClick:v=>C(e.product._id,e.quantity*-1)},null,8,["onClick"])])],2))),128)),a("tr",null,[n.value.length===0?(i(),V("td",Ie,"沒有商品")):g("",!0)])])]),_:1})]),_:1}),o(I,{cols:"12",class:"text-center"},{default:l(()=>[a("p",null,"總金額:"+f(H.value),1),o(d,{onClick:t[0]||(t[0]=e=>y.value=!0),color:"secondary"},{default:l(()=>[p("結帳")]),_:1})]),_:1})]),_:1}),o(oe,{modelValue:y.value,"onUpdate:modelValue":t[6]||(t[6]=e=>y.value=e),width:"400px",persistent:""},{default:l(()=>[o(ae,{class:"text-center"},{default:l(()=>[o(le,null,{default:l(()=>[p("結帳資訊")]),_:1}),o(ye,{disabled:r(z),onSubmit:se(r(P),["prevent"])},{default:l(()=>[u.value?g("",!0):(i(),h(N,{key:0,items:T,label:"便利商店貨到付款",modelValue:r(w).value.value,"onUpdate:modelValue":t[1]||(t[1]=e=>r(w).value.value=e),"error-messages":r(w).errorMessage.value},null,8,["modelValue","error-messages"])),u.value?(i(),h(N,{key:1,label:"付款方式?",modelValue:r(k).value.value,"onUpdate:modelValue":t[2]||(t[2]=e=>r(k).value.value=e),"error-messages":r(k).errorMessage.value,items:X},null,8,["modelValue","error-messages"])):g("",!0),u.value?g("",!0):(i(),h(re,{key:2,label:"哪一家店?",modelValue:r(S).value.value,"onUpdate:modelValue":t[3]||(t[3]=e=>r(S).value.value=e),"error-messages":r(S).errorMessage.value},null,8,["modelValue","error-messages"])),u.value?g("",!0):(i(),h(d,{key:3,onClick:t[4]||(t[4]=e=>u.value=!0)},{default:l(()=>[p("上一步")]),_:1})),u.value?(i(),h(d,{key:4,onClick:D},{default:l(()=>[p("下一步")]),_:1})):g("",!0),o(d,{color:"green",onClick:r(P),disabled:!j.value},{default:l(()=>[p("結帳")]),_:1},8,["onClick","disabled"]),o(d,{onClick:t[5]||(t[5]=e=>(y.value=!1,r(M)()))},{default:l(()=>[p("取消")]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),o(_e)],64)}}};export{We as default};

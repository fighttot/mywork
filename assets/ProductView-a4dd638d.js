import{aX as fe,b as ve,a as me,r as A,O as ge,H as N,T as J,o as ye,e as he,f as E,h as T,x as l,i as s,w as i,aY as we,Y as c,am as be,F as I,D as h,l as w,n as R,W as K,Z as Q,$ as ee,y as O,t as M,k as X,B as xe,an as Ce,V as W,C as ke,j as te}from"./index-4e24dfd9.js";import{c as ae,a as Se,u as le,b as oe,e as $e,V as se}from"./index.esm-31a09c6d.js";import{g as Z,S as _e}from"./ScrollTrigger-1fe021b6.js";import{d as Ee,g as ce,c as Ve,e as Le,S as re,P as Te,A as qe,a as ne}from"./effect-init-b2c39f19.js";import{e as Pe}from"./effect-target-72d1d489.js";import{V as ie}from"./VContainer-95f77cfa.js";import{V as Be}from"./VNavigationDrawer-c9ccc4e2.js";import{V as G,a as F}from"./VRow-e0d2e2b2.js";/* empty css              */function Me(D){let{swiper:t,extendParams:q,on:x,emit:m}=D;q({navigation:{nextEl:null,prevEl:null,hideOnClick:!1,disabledClass:"swiper-button-disabled",hiddenClass:"swiper-button-hidden",lockClass:"swiper-button-lock",navigationDisabledClass:"swiper-navigation-disabled"}}),t.navigation={nextEl:null,prevEl:null};const v=a=>(Array.isArray(a)?a:[a]).filter(o=>!!o);function _(a){let o;return a&&typeof a=="string"&&t.isElement&&(o=t.el.querySelector(a),o)?o:(a&&(typeof a=="string"&&(o=[...document.querySelectorAll(a)]),t.params.uniqueNavElements&&typeof a=="string"&&o.length>1&&t.el.querySelectorAll(a).length===1&&(o=t.el.querySelector(a))),a&&!o?a:o)}function $(a,o){const d=t.params.navigation;a=v(a),a.forEach(n=>{n&&(n.classList[o?"add":"remove"](...d.disabledClass.split(" ")),n.tagName==="BUTTON"&&(n.disabled=o),t.params.watchOverflow&&t.enabled&&n.classList[t.isLocked?"add":"remove"](d.lockClass))})}function C(){const{nextEl:a,prevEl:o}=t.navigation;if(t.params.loop){$(o,!1),$(a,!1);return}$(o,t.isBeginning&&!t.params.rewind),$(a,t.isEnd&&!t.params.rewind)}function P(a){a.preventDefault(),!(t.isBeginning&&!t.params.loop&&!t.params.rewind)&&(t.slidePrev(),m("navigationPrev"))}function k(a){a.preventDefault(),!(t.isEnd&&!t.params.loop&&!t.params.rewind)&&(t.slideNext(),m("navigationNext"))}function S(){const a=t.params.navigation;if(t.params.navigation=Ee(t,t.originalParams.navigation,t.params.navigation,{nextEl:"swiper-button-next",prevEl:"swiper-button-prev"}),!(a.nextEl||a.prevEl))return;let o=_(a.nextEl),d=_(a.prevEl);Object.assign(t.navigation,{nextEl:o,prevEl:d}),o=v(o),d=v(d);const n=(p,L)=>{p&&p.addEventListener("click",L==="next"?k:P),!t.enabled&&p&&p.classList.add(...a.lockClass.split(" "))};o.forEach(p=>n(p,"next")),d.forEach(p=>n(p,"prev"))}function B(){let{nextEl:a,prevEl:o}=t.navigation;a=v(a),o=v(o);const d=(n,p)=>{n.removeEventListener("click",p==="next"?k:P),n.classList.remove(...t.params.navigation.disabledClass.split(" "))};a.forEach(n=>d(n,"next")),o.forEach(n=>d(n,"prev"))}x("init",()=>{t.params.navigation.enabled===!1?V():(S(),C())}),x("toEdge fromEdge lock unlock",()=>{C()}),x("destroy",()=>{B()}),x("enable disable",()=>{let{nextEl:a,prevEl:o}=t.navigation;a=v(a),o=v(o),[...a,...o].filter(d=>!!d).forEach(d=>d.classList[t.enabled?"remove":"add"](t.params.navigation.lockClass))}),x("click",(a,o)=>{let{nextEl:d,prevEl:n}=t.navigation;d=v(d),n=v(n);const p=o.target;if(t.params.navigation.hideOnClick&&!n.includes(p)&&!d.includes(p)){if(t.pagination&&t.params.pagination&&t.params.pagination.clickable&&(t.pagination.el===p||t.pagination.el.contains(p)))return;let L;d.length?L=d[0].classList.contains(t.params.navigation.hiddenClass):n.length&&(L=n[0].classList.contains(t.params.navigation.hiddenClass)),m(L===!0?"navigationShow":"navigationHide"),[...d,...n].filter(e=>!!e).forEach(e=>e.classList.toggle(t.params.navigation.hiddenClass))}});const H=()=>{t.el.classList.remove(...t.params.navigation.navigationDisabledClass.split(" ")),S(),C()},V=()=>{t.el.classList.add(...t.params.navigation.navigationDisabledClass.split(" ")),B()};Object.assign(t.navigation,{enable:H,disable:V,update:C,init:S,destroy:B})}function ue(D,t,q){const x=`swiper-slide-shadow${q?`-${q}`:""}${D?` swiper-slide-shadow-${D}`:""}`,m=ce(t);let v=m.querySelector(`.${x.split(" ").join(".")}`);return v||(v=Ve("div",x.split(" ")),m.append(v)),v}function De(D){let{swiper:t,extendParams:q,on:x}=D;q({coverflowEffect:{rotate:50,stretch:0,depth:100,scale:1,modifier:1,slideShadows:!0}}),Le({effect:"coverflow",swiper:t,on:x,setTranslate:()=>{const{width:_,height:$,slides:C,slidesSizesGrid:P}=t,k=t.params.coverflowEffect,S=t.isHorizontal(),B=t.translate,H=S?-B+_/2:-B+$/2,V=S?k.rotate:-k.rotate,a=k.depth;for(let o=0,d=C.length;o<d;o+=1){const n=C[o],p=P[o],L=n.swiperSlideOffset,e=(H-L-p/2)/p,g=typeof k.modifier=="function"?k.modifier(e):e*k.modifier;let Y=S?V*g:0,f=S?0:V*g,u=-a*Math.abs(g),y=k.stretch;typeof y=="string"&&y.indexOf("%")!==-1&&(y=parseFloat(k.stretch)/100*p);let r=S?0:y*g,b=S?y*g:0,j=1-(1-k.scale)*Math.abs(g);Math.abs(b)<.001&&(b=0),Math.abs(r)<.001&&(r=0),Math.abs(u)<.001&&(u=0),Math.abs(Y)<.001&&(Y=0),Math.abs(f)<.001&&(f=0),Math.abs(j)<.001&&(j=0);const de=`translate3d(${b}px,${r}px,${u}px)  rotateX(${f}deg) rotateY(${Y}deg) scale(${j})`,pe=Pe(k,n);if(pe.style.transform=de,n.style.zIndex=-Math.abs(Math.round(g))+1,k.slideShadows){let z=S?n.querySelector(".swiper-slide-shadow-left"):n.querySelector(".swiper-slide-shadow-top"),U=S?n.querySelector(".swiper-slide-shadow-right"):n.querySelector(".swiper-slide-shadow-bottom");z||(z=ue("coverflow",n,S?"left":"top")),U||(U=ue("coverflow",n,S?"right":"bottom")),z&&(z.style.opacity=g>0?g:0),U&&(U.style.opacity=-g>0?-g:0)}}},setTransition:_=>{t.slides.map(C=>ce(C)).forEach(C=>{C.style.transitionDuration=`${_}ms`,C.querySelectorAll(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").forEach(P=>{P.style.transitionDuration=`${_}ms`})})},perspective:()=>!0,overwriteParams:()=>({watchSlidesProgress:!0})})}const Ne={id:"proviewpage"},Oe=l("br",null,null,-1),Ae=l("br",null,null,-1),Ie=l("br",null,null,-1),Fe=l("br",null,null,-1),He=l("h1",{class:"text-red"}," 已下架 ",-1),Ye={class:"gastlike"},Ke={__name:"ProductView",setup(D){const t=[De,Te,qe,Me],q=fe(),x=ve(),m=me(),v=A(!1),_=A(!1),$=A(!1),C=A([]);ge($,()=>{$.value?(document.documentElement.style.overflow="hidden",document.documentElement.style.height="100vh"):(document.documentElement.style.overflow="auto",document.documentElement.style.height="")});const P=async(f,u)=>{console.log(e.value._id);try{await N.patch(`products/${e.value._id}/review`,{id:u}),e.value.peopleSay[f].review=!e.value.peopleSay[f].review}catch(y){console.log(y),x({text:y.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}},k=ae({text:Se().required("缺少評論").min(10,"最少10個字").max(150,"最多150")}),{isSubmitting:S,handleSubmit:B,handleReset:H}=le({validationSchema:k}),V=oe("text"),a=B(async f=>{try{if(e.value.peopleSay.findIndex(y=>y.user.account===m.account)>-1){const{data:y}=await N.patch(`products/${e.value._id}/say`,{text:f.text});e.value.peopleSay=y.result}else{const{data:y}=await N.post(`products/${e.value._id}/say`,{text:f.text});e.value.peopleSay=y.result,_.value=!0}H(),v.value=!1}catch(u){x({text:u.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}}),o=ae({quantity:$e().typeError("缺少數量").required("缺少數量").min(1,"最少1")}),{isSubmitting:d,handleSubmit:n}=le({validationSchema:o,initialValues:{quantity:0}}),p=oe("quantity"),L=n(async f=>{try{const{data:u}=await N.post("users/cart",{product:e.value._id,quantity:f.quantity});m.cart=u.result,p.value.value=0}catch(u){x({text:u.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}}),e=A({_id:"",name:"",price:"",images:[],description:"",category:"",manufacturers:"",sell:!0,color:"",textColor:"",totle:"",peopleSay:[]}),g=A(!1),Y=async()=>{try{const{data:f}=await N.post("users/like",{product:e.value._id});m.like=f.result.length,e.value.totle=f.result.totle,(await N.post("/products/red",{app:e.value._id})).data.result?g.value=!0:g.value=!1}catch(f){x({text:f.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}};return(async()=>{try{const{data:f}=await J.get("/products/"+q.params.id);e.value=f.result,e.value.peopleSay.findIndex(b=>b.user.account===m.account)>-1&&(_.value=!0),m.isLogin&&((await N.post("/products/red",{app:e.value._id})).data.result?g.value=!0:g.value=!1);const{data:y}=await J.get("/products");C.value=y.result.filter(b=>b.category===f.result.category);const r=y.result.findIndex(b=>b._id===e.value._id);C.value.splice(r,1),document.title="購物網 |"+e.value.name}catch(f){x({text:f.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}})(),Z.registerPlugin(_e),ye(()=>{Z.from(".animationtable",{scrollTrigger:{trigger:".animationtable",start:"top 60%",end:"bottom center"},x:100,opacity:0,duration:2,ease:"none"}),Z.from(".animationfield",{scrollTrigger:{trigger:".animationfield",start:"top 60%",end:"bottom center"},opacity:0,duration:1,ease:"none"}),Z.from(".gastlike",{scrollTrigger:{trigger:".gastlike",start:"top 60%",end:"bottom center"},y:-50,opacity:0,duration:3,ease:"none"})}),(f,u)=>{const y=he("RouterLink");return E(),T(I,null,[l("section",Ne,[s(ie,null,{default:i(()=>[s(G,null,{default:i(()=>[s(F,{cols:"12"},{default:i(()=>[l("section",{class:"trantext",style:c(`border-left: 1px solid ${e.value.textColor};`)},[l("span",{style:c(`color:${e.value.textColor}`)},h(e.value.name),5),Oe,l("span",{style:c(`color:${e.value.textColor}`)},h(e.value.category),5),Ae,Ie,l("span",{style:c(`color:${e.value.textColor}`)},"$"+h(e.value.price),5),Fe,l("span",{style:c(`color:${e.value.textColor}`)},h(e.value.manufacturers),5)],4),s(w(re),{pagination:{type:"fraction"},navigation:!0,modules:t,loop:!0,speed:3e3,autoplay:{delay:5e3,disableOnInteraction:!1},class:"mySwiper"},{default:i(()=>[(E(!0),T(I,null,R(e.value.images,(r,b)=>(E(),te(w(ne),{key:b},{default:i(()=>[s(W,{src:r,cover:"",style:{width:"100%",height:"100%"}},null,8,["src"])]),_:2},1024))),128))]),_:1})]),_:1}),s(F,{cols:"12"},{default:i(()=>[s(G,null,{default:i(()=>[s(F,{cols:"6",class:"animationtable"},{default:i(()=>[s(K,{style:c(`color:${e.value.color}`),class:"mainveiw"},{default:i(()=>[l("thead",null,[l("tr",null,[l("th",{style:c(`color: ${e.value.color};`)},"作品名",4),l("td",null,h(e.value.name),1)]),l("tr",null,[l("th",{style:c(`color: ${e.value.color};`)},"分類",4),l("td",null,h(e.value.category),1)]),l("tr",null,[l("th",{style:c(`color: ${e.value.color};`)},"製造商",4),l("td",null,h(e.value.manufacturers),1)]),l("tr",null,[l("th",{style:c(`color: ${e.value.color};`)},"價格",4),l("td",null,h(e.value.price),1)])])]),_:1},8,["style"])]),_:1}),s(F,{style:c(`color: ${e.value.color};`),class:"txt"},{default:i(()=>[s(G,{class:"d-flex align-center flex-column justify-center animationfield",style:{"text-align":"center",height:"100%"}},{default:i(()=>[s(F,null,{default:i(()=>[l("p",null,h(e.value.description),1)]),_:1}),s(F,null,{default:i(()=>[s(se,{disabled:w(d),onSubmit:Q(w(L),["prevent"]),style:c(`border-bottom: 15px solid ${e.value.color};`),class:"underline"},{default:i(()=>[s(ee,{modelValue:w(p).value.value,"onUpdate:modelValue":u[0]||(u[0]=r=>w(p).value.value=r),modelModifiers:{number:!0},type:"number",label:"數量",min:"0","error-messages":w(p).errorMessage.value},null,8,["modelValue","error-messages"]),s(O,{style:c(`background-color:${e.value.color};color: ${e.value.textColor};`),type:"submit"},{default:i(()=>[M("加入購物車 ")]),_:1},8,["style"]),s(O,{style:c(`background-color:${g.value?e.value.textColor:e.value.color}; color:${g.value?e.value.color:e.value.textColor}`),onClick:Y},{default:i(()=>[M(h(g.value?"已加收藏":"加入收藏"),1)]),_:1},8,["style"]),s(O,{style:c(`background-color:${e.value.color};color: ${e.value.textColor};`),onClick:u[1]||(u[1]=r=>$.value=!$.value)},{default:i(()=>[M(" 查看評論 ")]),_:1},8,["style"])]),_:1},8,["disabled","onSubmit","style"])]),_:1})]),_:1})]),_:1},8,["style"])]),_:1})]),_:1})]),_:1})]),_:1}),s(we,{"model-value":!e.value.sell,persistent:"",class:"align-center justify-center text-center"},{default:i(()=>[He,s(O,{to:"/"},{default:i(()=>[M(" 回上頁")]),_:1})]),_:1},8,["model-value"]),s(Be,{modelValue:$.value,"onUpdate:modelValue":u[3]||(u[3]=r=>$.value=r),location:"right",temporary:"",width:"700",style:c(`background-color:${e.value.color};`)},{default:i(()=>[l("div",null,[s(K,{style:c(`color:${e.value.textColor}; background-color:${e.value.color};`)},{default:i(()=>[l("thead",null,[l("tr",null,[l("th",{style:c(`color:${e.value.textColor};`)},"使用者",4),l("th",{style:c(`color:${e.value.textColor};`)},"評論",4),l("th",{style:c(`color:${e.value.textColor};`)},"日期",4),w(m).role===1?(E(),T("th",{key:0,style:c(`color:${e.value.textColor};`)},"審核",4)):X("",!0)])]),l("tbody",null,[w(m).role===0?(E(!0),T(I,{key:0},R(e.value.peopleSay,(r,b)=>(E(),T("tr",{key:b},[r.review?X("",!0):(E(),T(I,{key:0},[l("td",null,h(r.user.name),1),l("td",null,h(r.text),1),l("td",null,h(new Date(r.date).toLocaleString()),1)],64))]))),128)):X("",!0),w(m).role===1?(E(!0),T(I,{key:1},R(e.value.peopleSay,(r,b)=>(E(),T("tr",{key:b},[l("td",null,[s(W,{style:{display:"inline-block","vertical-align":"middle"},src:`https://source.boringavatars.com/beam/120/${r.user.account}?colors=0db2ac,f5dd7e,fc8d4d,fc694d,faba32`,width:"50px"},null,8,["src"]),M(" "+h(r.user.name),1)]),l("td",null,h(r.text),1),l("td",null,h(new Date(r.date).toLocaleString()),1),l("td",null,[s(O,{onClick:j=>P(b,r.user._id),style:c(`background-color:${r.review?e.value.textColor:e.value.color}; color:${r.review?e.value.color:e.value.textColor}`)},{default:i(()=>[M(h(r.review?"未通過":"已通過"),1)]),_:2},1032,["onClick","style"])])]))),128)):X("",!0)])]),_:1},8,["style"])]),s(O,{onClick:u[2]||(u[2]=r=>v.value=!0),style:c(`background-color:${_.value?e.value.textColor:e.value.color}; color:${_.value?e.value.color:e.value.textColor}`),class:"otherbtn"},{default:i(()=>[M(h(_.value?"編輯評論":"新增評論"),1)]),_:1},8,["style"])]),_:1},8,["modelValue","style"]),s(be,{modelValue:v.value,"onUpdate:modelValue":u[5]||(u[5]=r=>v.value=r),width:"auto"},{default:i(()=>[s(se,{disabled:w(S),onSubmit:Q(w(a),["prevent"]),style:{width:"400px"}},{default:i(()=>[s(xe,{style:c(`background-color:${e.value.color};color: ${e.value.textColor};`)},{default:i(()=>[s(Ce,null,{default:i(()=>[s(W,{src:w(m).avatar,style:{width:"20%",display:"inline-block"}},null,8,["src"]),l("span",null,h(w(m).name),1)]),_:1}),s(ke,null,{default:i(()=>[s(ee,{modelValue:w(V).value.value,"onUpdate:modelValue":u[4]||(u[4]=r=>w(V).value.value=r),label:"留言",counter:"",maxlength:"150","error-messages":w(V).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),s(O,{type:"submit",class:"otherbtn",style:c(`background-color:${e.value.textColor};color: ${e.value.color};`)},{default:i(()=>[M(" 確認")]),_:1},8,["style"])]),_:1},8,["style"])]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])]),s(ie,null,{default:i(()=>[l("section",Ye,[l("div",{class:"link",style:c(`border-bottom: 5px solid ${e.value.color};`)},[l("span",{style:c(`background-color:${e.value.color};color: ${e.value.textColor};`)}," 關聯商品",4)],4),s(w(re),{effect:"coverflow",grabCursor:!0,centeredSlides:!0,slidesPerView:"auto",coverflowEffect:{rotate:50,stretch:0,depth:100,modifier:1,slideShadows:!0},speed:2e3,pagination:!0,modules:t,class:"mySwiper",initialSlide:2},{default:i(()=>[(E(!0),T(I,null,R(C.value,r=>(E(),te(w(ne),{key:r._id},{default:i(()=>[s(y,{to:/proHome/+r._id},{default:i(()=>[s(W,{src:r.images[0],cover:""},null,8,["src"])]),_:2},1032,["to"])]),_:2},1024))),128))]),_:1})])]),_:1})],64)}}};export{Ke as default};

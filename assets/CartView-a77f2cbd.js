import{b as w,d as B,a as q,r as S,c as k,H as h,f as u,j as $,w as s,i as l,U as N,y as e,h as _,p as P,F as z,k as D,D as c,V as d,v,W as F,l as I,X as f}from"./index-31ac7712.js";import{V as R}from"./VContainer-d6a65531.js";import{a as m,V as T}from"./VRow-f96e4da1.js";/* empty css              */const U=e("h1",null,"購物車",-1),j=e("thead",null,[e("tr",null,[e("th",null,"圖片"),e("th",null,"名稱"),e("th",null,"單價"),e("th",null,"數量"),e("th",null,"小記"),e("th",null,"操作")])],-1),A={key:0,colspan:"6",class:"text-center"},G={__name:"CartView",setup(E){const i=w(),C=B(),y=q(),o=S([]),p=async(a,r)=>{try{const{data:t}=await h.post("users/cart",{product:a,quantity:r}),n=o.value.findIndex(V=>V.product._id===a);o.value[n].quantity+=r,o.value[n].quantity<=0&&o.value.splice(n,1),y.cart=t.result}catch(t){console.log(t),i({text:t.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}},b=k(()=>o.value.length>0&&!o.value.some(a=>!a.product.sell)),g=k(()=>o.value.reduce((a,r)=>a+r.quantity*r.product.price,0));(async()=>{try{const{data:a}=await h.get("/users/cart");o.value.push(...a.result)}catch(a){i({text:a.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}})();const x=async(a,r)=>{try{await h.post("/orders"),y.cart=0,C.push("/orders")}catch(t){i({text:t.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}};return(a,r)=>(u(),$(R,null,{default:s(()=>[l(T,null,{default:s(()=>[l(m,{cols:"12"},{default:s(()=>[U]),_:1}),l(m,{cols:"12"},{default:s(()=>[l(N,null,{default:s(()=>[j,e("tbody",null,[(u(!0),_(z,null,P(o.value,t=>(u(),_("tr",{key:t._id,class:F({"bg-red-lighten-5":!t.product.sell})},[e("td",null,[l(I,{src:t.product.images[0],cover:"","aspect-ratio":"1"},null,8,["src"])]),e("td",{style:f(`color: ${t.product.textColor};`)},c(t.product.name),5),e("td",{style:f(`background-color: ${t.product.color};`)},c(t.product.price),5),e("td",null,[l(d,{color:"primary",variant:"text",icon:"mdi-minus",onClick:n=>p(t.product._id,-1)},null,8,["onClick"]),v(" "+c(t.quantity)+" ",1),l(d,{color:"primary",variant:"text",icon:"mdi-plus",onClick:n=>p(t.product._id,1)},null,8,["onClick"])]),e("td",null,c(t.quantity*t.product.price),1),e("td",null,[l(d,{color:"red",variant:"text",icon:"mdi-delete",onClick:n=>p(t.product._id,t.quantity*-1)},null,8,["onClick"])])],2))),128)),e("tr",null,[o.value.length===0?(u(),_("td",A,"沒有商品")):D("",!0)])])]),_:1})]),_:1}),l(m,{cols:"12",class:"text-center"},{default:s(()=>[e("p",null,"總金額:"+c(g.value),1),l(d,{color:"green",onClick:x,disabled:!b.value},{default:s(()=>[v("結帳")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1}))}};export{G as default};

import{b as X,d as Y,a as Z,r as C,c as I,H as x,f as n,h as g,x as a,i as l,w as s,F as M,m as N,W as G,n as J,k as m,D as y,y as c,t as i,X as K,B as O,Y as Q,l as r,Z as ee,j as f,_ as P,$ as te,a0 as ae,a1 as T}from"./index-0c9fed02.js";import{_ as le}from"./71b8e0fl_cL._AC_SL1500-811e8b6d.js";import{c as oe,a as w,u as se,b as S,V as re}from"./index.esm-96a35300.js";import{V as ue}from"./VContainer-4e7a447d.js";import{V as ne,a as $}from"./VRow-22674c50.js";/* empty css              */const de={class:"othertitle"},ce={class:"bgbox"},ie=a("div",{class:"bgbox2"},null,-1),pe=a("h1",null,"購物車",-1),me=a("thead",null,[a("tr",null,[a("th",null,"圖片"),a("th",null,"名稱"),a("th",null,"單價"),a("th",null,"數量"),a("th",null,"小記"),a("th",null,"操作")])],-1),ve={key:0,colspan:"6",class:"text-center"},_e={__name:"CartView",setup(ye){const b=X(),D=Y(),B=Z(),u=C([]),v=C(!1),d=C(!0),q=["萊爾富","7-11","全家"],R=["貨到付款現金","貨到付款刷卡"],k=async(o,t)=>{try{const{data:e}=await x.post("users/cart",{product:o,quantity:t}),p=u.value.findIndex(W=>W.product._id===o);u.value[p].quantity+=t,u.value[p].quantity<=0&&u.value.splice(p,1),B.cart=e.result}catch(e){console.log(e),b({text:e.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}},z=I(()=>u.value.length>0&&!u.value.some(o=>!o.product.sell)),j=I(()=>u.value.reduce((o,t)=>o+t.quantity*t.product.price,0));(async()=>{try{const{data:o}=await x.get("/users/cart");u.value.push(...o.result)}catch(o){b({text:o.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}})();const A=oe({seventhome:w().required("缺少製造商").test("地址錯誤",o=>q.includes(o)),paypoint:w().required("缺少店址"),payway:w().required("缺少付款方式")}),{handleSubmit:E,isSubmitting:H,handleReset:F}=se({validationSchema:A}),h=S("seventhome"),_=S("paypoint"),V=S("payway"),L=()=>{V.value.value?d.value=!1:b({text:"請填寫付款方式",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})},U=E(async o=>{try{await x.post("/orders",{seventhome:o.seventhome+o.paypoint,paywat:o.payway}),B.cart=0,D.push("/orders"),v.value=!1,d.value=!0,F()}catch(t){b({text:t.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}});return(o,t)=>(n(),g(M,null,[a("section",de,[a("div",ce,[l(N,{class:"mainimg",src:le,cover:""})]),ie]),l(ue,null,{default:s(()=>[l(ne,null,{default:s(()=>[l($,{cols:"12"},{default:s(()=>[pe]),_:1}),l($,{cols:"12"},{default:s(()=>[l(G,null,{default:s(()=>[me,a("tbody",null,[(n(!0),g(M,null,J(u.value,e=>(n(),g("tr",{key:e._id,class:ae({"bg-red-lighten-5":!e.product.sell})},[a("td",null,[l(N,{src:e.product.images[0],cover:"","aspect-ratio":"1"},null,8,["src"])]),a("td",{style:T(`color: ${e.product.textColor};`)},y(e.product.name),5),a("td",{style:T(`background-color: ${e.product.color};`)},y(e.product.price),5),a("td",null,[l(c,{color:"primary",variant:"text",icon:"mdi-minus",onClick:p=>k(e.product._id,-1)},null,8,["onClick"]),i(" "+y(e.quantity)+" ",1),l(c,{color:"primary",variant:"text",icon:"mdi-plus",onClick:p=>k(e.product._id,1)},null,8,["onClick"])]),a("td",null,y(e.quantity*e.product.price),1),a("td",null,[l(c,{color:"red",variant:"text",icon:"mdi-delete",onClick:p=>k(e.product._id,e.quantity*-1)},null,8,["onClick"])])],2))),128)),a("tr",null,[u.value.length===0?(n(),g("td",ve,"沒有商品")):m("",!0)])])]),_:1})]),_:1}),l($,{cols:"12",class:"text-center"},{default:s(()=>[a("p",null,"總金額:"+y(j.value),1),l(c,{color:"green",onClick:t[0]||(t[0]=e=>v.value=!0)},{default:s(()=>[i("結帳")]),_:1})]),_:1})]),_:1}),l(K,{modelValue:v.value,"onUpdate:modelValue":t[6]||(t[6]=e=>v.value=e),width:"400px",persistent:""},{default:s(()=>[l(O,{class:"text-center"},{default:s(()=>[l(Q,null,{default:s(()=>[i("結帳資訊")]),_:1}),l(re,{disabled:r(H),onSubmit:ee(r(U),["prevent"])},{default:s(()=>[d.value?m("",!0):(n(),f(P,{key:0,items:q,label:"便利商店貨到付款",modelValue:r(h).value.value,"onUpdate:modelValue":t[1]||(t[1]=e=>r(h).value.value=e),"error-messages":r(h).errorMessage.value},null,8,["modelValue","error-messages"])),d.value?(n(),f(P,{key:1,label:"付款方式?",modelValue:r(V).value.value,"onUpdate:modelValue":t[2]||(t[2]=e=>r(V).value.value=e),"error-messages":r(V).errorMessage.value,items:R},null,8,["modelValue","error-messages"])):m("",!0),d.value?m("",!0):(n(),f(te,{key:2,label:"哪一家店?",modelValue:r(_).value.value,"onUpdate:modelValue":t[3]||(t[3]=e=>r(_).value.value=e),"error-messages":r(_).errorMessage.value},null,8,["modelValue","error-messages"])),d.value?m("",!0):(n(),f(c,{key:3,onClick:t[4]||(t[4]=e=>d.value=!0)},{default:s(()=>[i("上一步")]),_:1})),d.value?(n(),f(c,{key:4,onClick:L},{default:s(()=>[i("下一步")]),_:1})):m("",!0),l(c,{color:"green",onClick:r(U),disabled:!z.value},{default:s(()=>[i("結帳")]),_:1},8,["onClick","disabled"]),l(c,{onClick:t[5]||(t[5]=e=>(v.value=!1,r(F)()))},{default:s(()=>[i("取消")]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1})]),_:1},8,["modelValue"])]),_:1})],64))}};export{_e as default};

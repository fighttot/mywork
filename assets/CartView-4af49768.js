import{b as Z,d as A,a as H,r as w,c as T,I as S,U as G,X as J,e as K,o as i,f as g,i as a,j as l,l as o,V as M,F as P,Z as O,_ as Q,p as W,m,E as f,z as d,x as p,$ as ee,C as te,a0 as ae,h as r,a1 as le,k as y,a2 as E,a3 as oe,a4 as se}from"./index-4da1c3a6.js";import{c as re,a as q,u as ne,b as $,V as ue}from"./index.esm-152e704f.js";import{F as ie}from"./FooTer-51eb310b.js";import{p as ce}from"./parallax-68c12e2e.js";import{V as de}from"./VContainer-69f72ce6.js";import{V as pe,a as B}from"./VRow-d99317f6.js";/* empty css              */const me=""+new URL("Zuikaku3-d1cccb77.jpg",import.meta.url).href,ve={class:"cardview"},fe={class:"othertitle"},ye={class:"bgbox"},_e={class:"scene"},he={class:"imgbox","data-depth":"-0.5"},be={class:"d-flex align-center justify-center fill-height"},ge=a("div",{class:"bgbox2"},null,-1),ke=a("h1",null,"購物車",-1),Ve=a("thead",null,[a("tr",null,[a("th",null,"圖片"),a("th",null,"名稱"),a("th",null,"單價"),a("th",null,"數量"),a("th",null,"小記"),a("th",null,"操作")])],-1),xe={key:0,colspan:"6",class:"text-center"},Ie={__name:"CartView",setup(Ce){const _=Z(),L=A(),k=H(),n=w([]),v=w(!1),c=w(!0),F=["萊爾富","7-11","全家"],N=["貨到付款現金","貨到付款刷卡"],V=async(s,t)=>{try{const{data:u}=await S.post("users/cart",{product:s,quantity:t}),e=n.value.findIndex(b=>b.product._id===s);n.value[e].quantity+=t,n.value[e].quantity<=0&&n.value.splice(e,1),k.cart=u.result}catch(u){console.log(u),_({text:u.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom",rounded:"pill",variant:"tonal"}})}},R=T(()=>n.value.length>0&&!n.value.some(s=>!s.product.sell)),X=T(()=>n.value.reduce((s,t)=>s+t.quantity*t.product.price,0)),j=re({seventhome:q().required("缺少製造商").test("地址錯誤",s=>F.includes(s)),paypoint:q().required("缺少店址"),payway:q().required("缺少付款方式")}),{handleSubmit:Y,isSubmitting:z,handleReset:U}=ne({validationSchema:j}),x=$("seventhome"),C=$("paypoint"),h=$("payway"),D=()=>{h.value.value?c.value=!1:_({text:"請填寫付款方式",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom",rounded:"pill",variant:"tonal"}})},I=Y(async s=>{try{await S.post("/orders",{seventhome:s.seventhome+s.paypoint,paywat:s.payway}),k.cart=0,L.push("/orders"),v.value=!1,c.value=!0,U()}catch(t){_({text:t.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom",rounded:"pill",variant:"tonal"}})}});return G(async()=>{try{const{data:e}=await S.get("/users/cart");n.value.push(...e.result)}catch(e){_({text:e.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom",rounded:"pill",variant:"tonal"}})}k.loding=!1,await J();const s=document.querySelector(".scene"),t=document.querySelector(".bgbox"),u=new ce(s,{scalarX:10,scalarY:10,frictionX:.1,frictionY:.1,limitX:100,limitY:100});u.disable(),t.addEventListener("mouseover",e=>{u.enable()}),t.addEventListener("mouseout",e=>{u.disable()})}),(s,t)=>{const u=K("router-link");return i(),g(P,null,[a("section",ve,[a("section",fe,[a("div",ye,[a("div",_e,[a("div",he,[l(M,{class:"mainimg",src:me,cover:""},{placeholder:o(()=>[a("div",be,[l(O,{color:"grey-lighten-4",indeterminate:""})])]),_:1})])])]),ge]),l(de,null,{default:o(()=>[l(pe,null,{default:o(()=>[l(B,{cols:"12"},{default:o(()=>[ke]),_:1}),l(B,{cols:"12",class:"cartheight"},{default:o(()=>[l(Q,null,{default:o(()=>[Ve,a("tbody",null,[(i(!0),g(P,null,W(n.value,e=>(i(),g("tr",{key:e._id,class:se({"bg-red-lighten-5":!e.product.sell})},[a("td",null,[l(M,{src:e.product.images[0],cover:"","aspect-ratio":"1"},null,8,["src"])]),a("td",null,[l(u,{to:`/proHome/${e.product._id}`},{default:o(()=>[p(f(e.product.name),1)]),_:2},1032,["to"])]),a("td",null,f(e.product.price),1),a("td",null,[l(d,{color:"primary",variant:"text",icon:"mdi-minus",onClick:b=>V(e.product._id,-1)},null,8,["onClick"]),p(" "+f(e.quantity)+" ",1),l(d,{color:"primary",variant:"text",icon:"mdi-plus",onClick:b=>V(e.product._id,1)},null,8,["onClick"])]),a("td",null,f(e.quantity*e.product.price),1),a("td",null,[l(d,{color:"red",variant:"text",icon:"mdi-delete",onClick:b=>V(e.product._id,e.quantity*-1)},null,8,["onClick"])])],2))),128)),a("tr",null,[n.value.length===0?(i(),g("td",xe,"沒有商品")):m("",!0)])])]),_:1})]),_:1}),l(B,{cols:"12",class:"text-center"},{default:o(()=>[a("p",null,"總金額:"+f(X.value),1),l(d,{onClick:t[0]||(t[0]=e=>v.value=!0),color:"secondary"},{default:o(()=>[p("結帳")]),_:1})]),_:1})]),_:1}),l(ee,{modelValue:v.value,"onUpdate:modelValue":t[6]||(t[6]=e=>v.value=e),width:"400px",persistent:""},{default:o(()=>[l(te,{class:"text-center"},{default:o(()=>[l(ae,null,{default:o(()=>[p("結帳資訊")]),_:1}),l(ue,{disabled:r(z),onSubmit:le(r(I),["prevent"])},{default:o(()=>[c.value?m("",!0):(i(),y(E,{key:0,items:F,label:"便利商店貨到付款",modelValue:r(x).value.value,"onUpdate:modelValue":t[1]||(t[1]=e=>r(x).value.value=e),"error-messages":r(x).errorMessage.value},null,8,["modelValue","error-messages"])),c.value?(i(),y(E,{key:1,label:"付款方式?",modelValue:r(h).value.value,"onUpdate:modelValue":t[2]||(t[2]=e=>r(h).value.value=e),"error-messages":r(h).errorMessage.value,items:N},null,8,["modelValue","error-messages"])):m("",!0),c.value?m("",!0):(i(),y(oe,{key:2,label:"哪一家店?",modelValue:r(C).value.value,"onUpdate:modelValue":t[3]||(t[3]=e=>r(C).value.value=e),"error-messages":r(C).errorMessage.value},null,8,["modelValue","error-messages"])),c.value?m("",!0):(i(),y(d,{key:3,onClick:t[4]||(t[4]=e=>c.value=!0)},{default:o(()=>[p("上一步")]),_:1})),c.value?(i(),y(d,{key:4,onClick:D},{default:o(()=>[p("下一步")]),_:1})):m("",!0),l(d,{color:"green",onClick:r(I),disabled:!R.value},{default:o(()=>[p("結帳")]),_:1},8,["onClick","disabled"]),l(d,{onClick:t[5]||(t[5]=e=>(v.value=!1,r(U)()))},{default:o(()=>[p("取消")]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),l(ie)],64)}}};export{Ie as default};

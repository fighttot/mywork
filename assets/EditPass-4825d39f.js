import{b as E,d as R,a as z,I as _,r as v,e as N,o as $,f as D,j as l,l as r,G as I,h as a,a1 as T,a3 as u,i as F,z as w,x,V as G}from"./index-ea2ca1d0.js";import{v as O}from"./index-4e112faa.js";import{c as H,a as i,d as J,u as K,b as m,V as L}from"./index.esm-25868ffb.js";import{V as Q}from"./VContainer-aebd8b61.js";import{V as B,a as h}from"./VRow-886c420e.js";/* empty css              */const W={class:"editpass"},X=F("h1",null,"修改會員資料",-1),Y={class:"text-center"},re={__name:"EditPass",setup(Z){const n=E(),M=R(),t=z(),S=H({account:i().required("帳號必填").min(4,"最少四個字").max(20,"最多20"),email:i().required("信箱必填").test("isEmail","信箱格式錯誤",o=>O.isEmail(o)),password:i().required("密碼必填").min(4,"最少四個字").max(20,"最多20"),passwordConfirm:i().required("密碼必填").min(4,"最少四個字").max(20,"最多20").oneOf([J("password")],"密碼不一致"),name:i().required("暱稱必填").max(10,"最多10")}),{handleSubmit:U,isSubmitting:P,handleReset:y}=K({validationSchema:S}),d=m("account"),c=m("email"),f=m("password"),V=m("passwordConfirm"),p=m("name"),j=U(async o=>{try{const{data:e}=await _.patch("/users/edit",{account:o.account,email:o.email,name:o.name,password:o.password});t.account=e.result.account,t.email=e.result.email,t.name=e.result.name,n({text:"修改成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom",rounded:"pill",variant:"tonal"}}),y(),M.push("/")}catch(e){n({text:e.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom",rounded:"pill",variant:"tonal"}})}}),g=v([]),C=v([]),k=v(null),b=v(!1),q=async()=>{b.value=!0;try{const o=new FormData;g.value.length>0&&o.append("image",g.value[0].file);const{data:e}=await _.post("/users/upimg",o);console.log(e.result),t.image=e.result,k.value.deleteFileRecord(),n({text:"大頭貼搞定",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom",rounded:"pill",variant:"tonal"}})}catch(o){n({text:o.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom",rounded:"pill",variant:"tonal"}})}b.value=!1};return(async()=>{try{d.value.value=t.account,c.value.value=t.email,p.value.value=t.name,t.loding=!1}catch(o){n({text:o.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom",rounded:"pill",variant:"tonal"}})}})(),(o,e)=>{const A=N("VueFileAgent");return $(),D("section",W,[l(Q,null,{default:r(()=>[l(B,null,{default:r(()=>[l(h,{cols:"12",class:"text-center"},{default:r(()=>[X]),_:1}),l(I),l(B,{"justify-xl":"space-around","justify-lg":"space-between"},{default:r(()=>[l(h,{cols:"6",lg:"3"},{default:r(()=>[l(L,{disabled:a(P),onSubmit:T(a(j),["prevent"])},{default:r(()=>[l(u,{modelValue:a(d).value.value,"onUpdate:modelValue":e[0]||(e[0]=s=>a(d).value.value=s),label:"帳號:",counter:"","max-length":"20","error-messages":a(d).errorMessage.value},null,8,["modelValue","error-messages"]),l(u,{modelValue:a(f).value.value,"onUpdate:modelValue":e[1]||(e[1]=s=>a(f).value.value=s),label:"密碼:",counter:"","max-length":"20",type:"password","error-messages":a(f).errorMessage.value},null,8,["modelValue","error-messages"]),l(u,{modelValue:a(V).value.value,"onUpdate:modelValue":e[2]||(e[2]=s=>a(V).value.value=s),label:"確認密碼:",counter:"","max-length":"20",type:"password","error-messages":a(V).errorMessage.value},null,8,["modelValue","error-messages"]),l(u,{modelValue:a(c).value.value,"onUpdate:modelValue":e[3]||(e[3]=s=>a(c).value.value=s),label:"信箱(不得重複):",type:"email","error-messages":a(c).errorMessage.value},null,8,["modelValue","error-messages"]),l(u,{modelValue:a(p).value.value,"onUpdate:modelValue":e[4]||(e[4]=s=>a(p).value.value=s),label:"暱稱(不得重複):",counter:"","max-length":"10","error-messages":a(p).errorMessage.value},null,8,["modelValue","error-messages"]),F("div",Y,[l(w,{type:"submit"},{default:r(()=>[x("修改會員資料")]),_:1}),l(w,{onClick:a(y)},{default:r(()=>[x("重製")]),_:1},8,["onClick"])])]),_:1},8,["disabled","onSubmit"])]),_:1}),l(h,{cols:"6",lg:"2",class:"userimage"},{default:r(()=>[l(G,{src:a(t).image?a(t).image:a(t).avatar,style:{height:"200px",width:"200px","border-radius":"50%"},cover:""},null,8,["src"]),l(A,{modelValue:g.value,"onUpdate:modelValue":e[5]||(e[5]=s=>g.value=s),"raw-model-value":C.value,"onUpdate:rawModelValue":e[6]||(e[6]=s=>C.value=s),"max-files":1,"max-size":"1MB",accept:"image/jpg,image/jpeg,image/png",multiple:!1,"error-text":{type:"檔案格式錯誤",size:"檔案太大"},"help-text":"選擇檔案或拖放到這裡",deletable:"",ref_key:"fileAgent",ref:k,class:"userimageinpute"},null,8,["modelValue","raw-model-value"]),l(w,{onClick:q,loading:b.value},{default:r(()=>[x("送出大頭貼")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1})])}}};export{re as default};

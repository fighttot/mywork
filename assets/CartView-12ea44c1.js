import{b as H,d as X,a as Y,r as C,c as T,H as x,f as u,h as g,x as a,i as l,w as s,m as I,X as G,F as J,n as K,k as m,D as y,y as c,t as i,Y as O,B as Q,Z as W,l as r,_ as ee,j as f,$ as M,a0 as te,a1 as ae,a2 as N}from"./index-856a1c81.js";import{c as le,a as w,u as oe,b as S,V as se}from"./index.esm-0f4f10cb.js";import{F as re}from"./FooTer-ae8d41c3.js";import{V as ne}from"./VContainer-df1bf70b.js";import{V as ue,a as $}from"./VRow-ebfea824.js";/* empty css              */const de=""+new URL("Zuikaku-a004b63d.jpg",import.meta.url).href,ce={class:"cardview"},ie={class:"othertitle"},pe={class:"bgbox"},me=a("div",{class:"bgbox2"},null,-1),ve=a("h1",null,"購物車",-1),ye=a("thead",null,[a("tr",null,[a("th",null,"圖片"),a("th",null,"名稱"),a("th",null,"單價"),a("th",null,"數量"),a("th",null,"小記"),a("th",null,"操作")])],-1),fe={key:0,colspan:"6",class:"text-center"},xe={__name:"CartView",setup(be){const b=H(),P=X(),B=Y(),n=C([]),v=C(!1),d=C(!0),q=["萊爾富","7-11","全家"],R=["貨到付款現金","貨到付款刷卡"],h=async(o,t)=>{try{const{data:e}=await x.post("users/cart",{product:o,quantity:t}),p=n.value.findIndex(E=>E.product._id===o);n.value[p].quantity+=t,n.value[p].quantity<=0&&n.value.splice(p,1),B.cart=e.result}catch(e){console.log(e),b({text:e.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom",rounded:"pill",variant:"tonal"}})}},D=T(()=>n.value.length>0&&!n.value.some(o=>!o.product.sell)),j=T(()=>n.value.reduce((o,t)=>o+t.quantity*t.product.price,0));(async()=>{try{const{data:o}=await x.get("/users/cart");n.value.push(...o.result)}catch(o){b({text:o.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom",rounded:"pill",variant:"tonal"}})}})();const z=le({seventhome:w().required("缺少製造商").test("地址錯誤",o=>q.includes(o)),paypoint:w().required("缺少店址"),payway:w().required("缺少付款方式")}),{handleSubmit:L,isSubmitting:Z,handleReset:F}=oe({validationSchema:z}),V=S("seventhome"),_=S("paypoint"),k=S("payway"),A=()=>{k.value.value?d.value=!1:b({text:"請填寫付款方式",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom",rounded:"pill",variant:"tonal"}})},U=L(async o=>{try{await x.post("/orders",{seventhome:o.seventhome+o.paypoint,paywat:o.payway}),B.cart=0,P.push("/orders"),v.value=!1,d.value=!0,F()}catch(t){b({text:t.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom",rounded:"pill",variant:"tonal"}})}});return(o,t)=>(u(),g("section",ce,[a("section",ie,[a("div",pe,[l(I,{class:"mainimg",src:de,cover:""})]),me]),l(ne,null,{default:s(()=>[l(ue,null,{default:s(()=>[l($,{cols:"12"},{default:s(()=>[ve]),_:1}),l($,{cols:"12"},{default:s(()=>[l(G,null,{default:s(()=>[ye,a("tbody",null,[(u(!0),g(J,null,K(n.value,e=>(u(),g("tr",{key:e._id,class:ae({"bg-red-lighten-5":!e.product.sell})},[a("td",null,[l(I,{src:e.product.images[0],cover:"","aspect-ratio":"1"},null,8,["src"])]),a("td",{style:N(`color: ${e.product.textColor};`)},y(e.product.name),5),a("td",{style:N(`background-color: ${e.product.color};`)},y(e.product.price),5),a("td",null,[l(c,{color:"primary",variant:"text",icon:"mdi-minus",onClick:p=>h(e.product._id,-1)},null,8,["onClick"]),i(" "+y(e.quantity)+" ",1),l(c,{color:"primary",variant:"text",icon:"mdi-plus",onClick:p=>h(e.product._id,1)},null,8,["onClick"])]),a("td",null,y(e.quantity*e.product.price),1),a("td",null,[l(c,{color:"red",variant:"text",icon:"mdi-delete",onClick:p=>h(e.product._id,e.quantity*-1)},null,8,["onClick"])])],2))),128)),a("tr",null,[n.value.length===0?(u(),g("td",fe,"沒有商品")):m("",!0)])])]),_:1})]),_:1}),l($,{cols:"12",class:"text-center"},{default:s(()=>[a("p",null,"總金額:"+y(j.value),1),l(c,{color:"green",onClick:t[0]||(t[0]=e=>v.value=!0)},{default:s(()=>[i("結帳")]),_:1})]),_:1})]),_:1}),l(O,{modelValue:v.value,"onUpdate:modelValue":t[6]||(t[6]=e=>v.value=e),width:"400px",persistent:""},{default:s(()=>[l(Q,{class:"text-center"},{default:s(()=>[l(W,null,{default:s(()=>[i("結帳資訊")]),_:1}),l(se,{disabled:r(Z),onSubmit:ee(r(U),["prevent"])},{default:s(()=>[d.value?m("",!0):(u(),f(M,{key:0,items:q,label:"便利商店貨到付款",modelValue:r(V).value.value,"onUpdate:modelValue":t[1]||(t[1]=e=>r(V).value.value=e),"error-messages":r(V).errorMessage.value},null,8,["modelValue","error-messages"])),d.value?(u(),f(M,{key:1,label:"付款方式?",modelValue:r(k).value.value,"onUpdate:modelValue":t[2]||(t[2]=e=>r(k).value.value=e),"error-messages":r(k).errorMessage.value,items:R},null,8,["modelValue","error-messages"])):m("",!0),d.value?m("",!0):(u(),f(te,{key:2,label:"哪一家店?",modelValue:r(_).value.value,"onUpdate:modelValue":t[3]||(t[3]=e=>r(_).value.value=e),"error-messages":r(_).errorMessage.value},null,8,["modelValue","error-messages"])),d.value?m("",!0):(u(),f(c,{key:3,onClick:t[4]||(t[4]=e=>d.value=!0)},{default:s(()=>[i("上一步")]),_:1})),d.value?(u(),f(c,{key:4,onClick:A},{default:s(()=>[i("下一步")]),_:1})):m("",!0),l(c,{color:"green",onClick:r(U),disabled:!D.value},{default:s(()=>[i("結帳")]),_:1},8,["onClick","disabled"]),l(c,{onClick:t[5]||(t[5]=e=>(v.value=!1,r(F)()))},{default:s(()=>[i("取消")]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(re)]))}};export{xe as default};

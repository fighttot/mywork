import{aZ as fe,b as ve,a as me,r as F,O as ge,H as A,T as G,o as ye,e as he,f as E,h as V,x as a,i as r,w as i,a_ as be,a2 as c,Y as we,F as N,l as w,D as m,n as W,X as K,_ as Q,a0 as ee,y as O,t as M,k as z,B as xe,Z as Ce,m as X,C as ke,j as te}from"./index-7b3d898f.js";import{c as ae,a as _e,u as le,b as oe,e as Se,V as se}from"./index.esm-7f6701dc.js";import{g as J}from"./index-4db78ffb.js";import{S as $e}from"./ScrollTrigger-c3252e56.js";import{d as Ee,g as ce,c as Ve,e as Be,S as re,P as Pe,A as Te,a as ne}from"./effect-init-e3e5c697.js";import{e as Le}from"./effect-target-f7b9545a.js";import{V as ie}from"./VContainer-f7842cdb.js";import{V as qe}from"./VNavigationDrawer-ce3b190b.js";import{V as Z,a as I}from"./VRow-759ad6d2.js";/* empty css              */function Me(D){let{swiper:t,extendParams:T,on:v,emit:y}=D;T({navigation:{nextEl:null,prevEl:null,hideOnClick:!1,disabledClass:"swiper-button-disabled",hiddenClass:"swiper-button-hidden",lockClass:"swiper-button-lock",navigationDisabledClass:"swiper-navigation-disabled"}}),t.navigation={nextEl:null,prevEl:null};const g=l=>(Array.isArray(l)?l:[l]).filter(o=>!!o);function $(l){let o;return l&&typeof l=="string"&&t.isElement&&(o=t.el.querySelector(l),o)?o:(l&&(typeof l=="string"&&(o=[...document.querySelectorAll(l)]),t.params.uniqueNavElements&&typeof l=="string"&&o.length>1&&t.el.querySelectorAll(l).length===1&&(o=t.el.querySelector(l))),l&&!o?l:o)}function S(l,o){const d=t.params.navigation;l=g(l),l.forEach(n=>{n&&(n.classList[o?"add":"remove"](...d.disabledClass.split(" ")),n.tagName==="BUTTON"&&(n.disabled=o),t.params.watchOverflow&&t.enabled&&n.classList[t.isLocked?"add":"remove"](d.lockClass))})}function C(){const{nextEl:l,prevEl:o}=t.navigation;if(t.params.loop){S(o,!1),S(l,!1);return}S(o,t.isBeginning&&!t.params.rewind),S(l,t.isEnd&&!t.params.rewind)}function L(l){l.preventDefault(),!(t.isBeginning&&!t.params.loop&&!t.params.rewind)&&(t.slidePrev(),y("navigationPrev"))}function k(l){l.preventDefault(),!(t.isEnd&&!t.params.loop&&!t.params.rewind)&&(t.slideNext(),y("navigationNext"))}function _(){const l=t.params.navigation;if(t.params.navigation=Ee(t,t.originalParams.navigation,t.params.navigation,{nextEl:"swiper-button-next",prevEl:"swiper-button-prev"}),!(l.nextEl||l.prevEl))return;let o=$(l.nextEl),d=$(l.prevEl);Object.assign(t.navigation,{nextEl:o,prevEl:d}),o=g(o),d=g(d);const n=(p,P)=>{p&&p.addEventListener("click",P==="next"?k:L),!t.enabled&&p&&p.classList.add(...l.lockClass.split(" "))};o.forEach(p=>n(p,"next")),d.forEach(p=>n(p,"prev"))}function q(){let{nextEl:l,prevEl:o}=t.navigation;l=g(l),o=g(o);const d=(n,p)=>{n.removeEventListener("click",p==="next"?k:L),n.classList.remove(...t.params.navigation.disabledClass.split(" "))};l.forEach(n=>d(n,"next")),o.forEach(n=>d(n,"prev"))}v("init",()=>{t.params.navigation.enabled===!1?B():(_(),C())}),v("toEdge fromEdge lock unlock",()=>{C()}),v("destroy",()=>{q()}),v("enable disable",()=>{let{nextEl:l,prevEl:o}=t.navigation;l=g(l),o=g(o),[...l,...o].filter(d=>!!d).forEach(d=>d.classList[t.enabled?"remove":"add"](t.params.navigation.lockClass))}),v("click",(l,o)=>{let{nextEl:d,prevEl:n}=t.navigation;d=g(d),n=g(n);const p=o.target;if(t.params.navigation.hideOnClick&&!n.includes(p)&&!d.includes(p)){if(t.pagination&&t.params.pagination&&t.params.pagination.clickable&&(t.pagination.el===p||t.pagination.el.contains(p)))return;let P;d.length?P=d[0].classList.contains(t.params.navigation.hiddenClass):n.length&&(P=n[0].classList.contains(t.params.navigation.hiddenClass)),y(P===!0?"navigationShow":"navigationHide"),[...d,...n].filter(e=>!!e).forEach(e=>e.classList.toggle(t.params.navigation.hiddenClass))}});const H=()=>{t.el.classList.remove(...t.params.navigation.navigationDisabledClass.split(" ")),_(),C()},B=()=>{t.el.classList.add(...t.params.navigation.navigationDisabledClass.split(" ")),q()};Object.assign(t.navigation,{enable:H,disable:B,update:C,init:_,destroy:q})}function ue(D,t,T){const v=`swiper-slide-shadow${T?`-${T}`:""}${D?` swiper-slide-shadow-${D}`:""}`,y=ce(t);let g=y.querySelector(`.${v.split(" ").join(".")}`);return g||(g=Ve("div",v.split(" ")),y.append(g)),g}function De(D){let{swiper:t,extendParams:T,on:v}=D;T({coverflowEffect:{rotate:50,stretch:0,depth:100,scale:1,modifier:1,slideShadows:!0}}),Be({effect:"coverflow",swiper:t,on:v,setTranslate:()=>{const{width:$,height:S,slides:C,slidesSizesGrid:L}=t,k=t.params.coverflowEffect,_=t.isHorizontal(),q=t.translate,H=_?-q+$/2:-q+S/2,B=_?k.rotate:-k.rotate,l=k.depth;for(let o=0,d=C.length;o<d;o+=1){const n=C[o],p=L[o],P=n.swiperSlideOffset,e=(H-P-p/2)/p,h=typeof k.modifier=="function"?k.modifier(e):e*k.modifier;let j=_?B*h:0,f=_?0:B*h,u=-l*Math.abs(h),b=k.stretch;typeof b=="string"&&b.indexOf("%")!==-1&&(b=parseFloat(k.stretch)/100*p);let s=_?0:b*h,x=_?b*h:0,U=1-(1-k.scale)*Math.abs(h);Math.abs(x)<.001&&(x=0),Math.abs(s)<.001&&(s=0),Math.abs(u)<.001&&(u=0),Math.abs(j)<.001&&(j=0),Math.abs(f)<.001&&(f=0),Math.abs(U)<.001&&(U=0);const de=`translate3d(${x}px,${s}px,${u}px)  rotateX(${f}deg) rotateY(${j}deg) scale(${U})`,pe=Le(k,n);if(pe.style.transform=de,n.style.zIndex=-Math.abs(Math.round(h))+1,k.slideShadows){let Y=_?n.querySelector(".swiper-slide-shadow-left"):n.querySelector(".swiper-slide-shadow-top"),R=_?n.querySelector(".swiper-slide-shadow-right"):n.querySelector(".swiper-slide-shadow-bottom");Y||(Y=ue("coverflow",n,_?"left":"top")),R||(R=ue("coverflow",n,_?"right":"bottom")),Y&&(Y.style.opacity=h>0?h:0),R&&(R.style.opacity=-h>0?-h:0)}}},setTransition:$=>{t.slides.map(C=>ce(C)).forEach(C=>{C.style.transitionDuration=`${$}ms`,C.querySelectorAll(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").forEach(L=>{L.style.transitionDuration=`${$}ms`})})},perspective:()=>!0,overwriteParams:()=>({watchSlidesProgress:!0})})}const Ae={id:"proviewpage"},Ne=a("br",null,null,-1),Oe=a("br",null,null,-1),Fe=a("br",null,null,-1),Ie=a("br",null,null,-1),He=a("h1",{class:"text-red"}," 已下架 ",-1),je=a("td",null,"管理員審核中",-1),ze={class:"gastlike"},Ue=a("div",{style:{"text-align":"center",margin:"10px 0 20px 0",color:"#B8860B","text-shadow":"0px 0px 10px #000000"}}," Copyright © PFSK. All figure in here. ",-1),tt={__name:"ProductView",setup(D){const t=[De,Pe,Te,Me],T=fe(),v=ve(),y=me(),g=F(!1),$=F(!1),S=F(!1),C=F([]);ge(S,()=>{S.value?(document.documentElement.style.overflow="hidden",document.documentElement.style.height="100vh"):(document.documentElement.style.overflow="auto",document.documentElement.style.height="")});const L=async(f,u)=>{console.log(e.value._id);try{await A.patch(`products/${e.value._id}/review`,{id:u}),e.value.peopleSay[f].review=!e.value.peopleSay[f].review}catch(b){console.log(b),v({text:b.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}},k=ae({text:_e().required("缺少評論").min(10,"最少10個字").max(150,"最多150")}),{isSubmitting:_,handleSubmit:q,handleReset:H}=le({validationSchema:k}),B=oe("text"),l=q(async f=>{try{if(e.value.peopleSay.findIndex(b=>b.user.account===y.account)>-1){const{data:b}=await A.patch(`products/${e.value._id}/say`,{text:f.text});e.value.peopleSay=b.result}else{const{data:b}=await A.post(`products/${e.value._id}/say`,{text:f.text});e.value.peopleSay=b.result,$.value=!0}H(),g.value=!1,v({text:"成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom",rounded:"pill",variant:"tonal"}})}catch(u){u.response.data.message==="缺少JWT"?v({text:"請登入或加入會員",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom",rounded:"pill",variant:"tonal"}}):v({text:u.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom",rounded:"pill"}})}}),o=ae({quantity:Se().typeError("缺少數量").required("缺少數量").min(1,"最少1")}),{isSubmitting:d,handleSubmit:n}=le({validationSchema:o,initialValues:{quantity:0}}),p=oe("quantity"),P=n(async f=>{try{const{data:u}=await A.post("users/cart",{product:e.value._id,quantity:f.quantity});y.cart=u.result,p.value.value=0,v({text:"加入成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom",rounded:"pill",variant:"tonal"}})}catch(u){u.response.data.message==="缺少JWT"?v({text:"請登入或加入會員",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom",rounded:"pill",variant:"tonal"}}):v({text:u.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom",rounded:"pill"}})}}),e=F({_id:"",name:"",price:"",images:[],description:"",category:"",manufacturers:"",sell:!0,color:"",textColor:"",totle:"",peopleSay:[]}),h=F(!1),j=async()=>{try{const{data:f}=await A.post("users/like",{product:e.value._id});y.like=f.result.length,e.value.totle=f.result.totle,(await A.post("/products/red",{app:e.value._id})).data.result?h.value=!0:h.value=!1,v({text:"操作成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom",rounded:"pill",variant:"tonal"}})}catch(f){f.response.data.message==="缺少JWT"?v({text:"請登入或加入會員",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom",rounded:"pill",variant:"tonal"}}):v({text:f.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom",rounded:"pill"}})}};return(async()=>{try{const{data:f}=await G.get("/products/"+T.params.id);e.value=f.result,e.value.peopleSay.findIndex(x=>x.user.account===y.account)>-1&&($.value=!0),y.isLogin&&((await A.post("/products/red",{app:e.value._id})).data.result?h.value=!0:h.value=!1);const{data:b}=await G.get("/products");C.value=b.result.filter(x=>x.category===f.result.category);const s=b.result.findIndex(x=>x._id===e.value._id);C.value.splice(s,1),document.title="購物網 |"+e.value.name}catch(f){v({text:f.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}})(),J.registerPlugin($e),ye(()=>{J.from(".animationtable",{scrollTrigger:{trigger:".animationtable",start:"top 60%",end:"bottom center"},x:100,opacity:0,duration:2,ease:"none"}),J.from(".animationfield",{scrollTrigger:{trigger:".animationfield",start:"top 60%",end:"bottom center"},opacity:0,duration:1,ease:"none"}),J.from(".gastlike",{scrollTrigger:{trigger:".gastlike",start:"top 70%",end:"bottom center"},y:-50,opacity:0,duration:3,ease:"none"})}),(f,u)=>{const b=he("RouterLink");return E(),V(N,null,[a("section",Ae,[r(ie,null,{default:i(()=>[r(Z,null,{default:i(()=>[r(I,{cols:"12"},{default:i(()=>[r(w(re),{pagination:{type:"fraction"},navigation:!0,modules:t,loop:!0,speed:3e3,autoplay:{delay:5e3,disableOnInteraction:!1},class:"mySwiper"},{default:i(()=>[a("section",{class:"trantext",style:c(`border-left: 1px solid ${e.value.textColor};`)},[a("span",{style:c(`color:${e.value.textColor}`)},m(e.value.name),5),Ne,a("span",{style:c(`color:${e.value.textColor}`)},m(e.value.category),5),Oe,Fe,a("span",{style:c(`color:${e.value.textColor}`)},"$"+m(e.value.price),5),Ie,a("span",{style:c(`color:${e.value.textColor}`)},m(e.value.manufacturers),5)],4),(E(!0),V(N,null,W(e.value.images,(s,x)=>(E(),te(w(ne),{key:x},{default:i(()=>[r(X,{src:s,cover:"",style:{width:"100%",height:"100%"}},null,8,["src"])]),_:2},1024))),128))]),_:1})]),_:1}),r(I,{cols:"12"},{default:i(()=>[r(Z,null,{default:i(()=>[r(I,{cols:"6",class:"animationtable"},{default:i(()=>[r(K,{style:c(`color:${e.value.color}`),class:"mainveiw"},{default:i(()=>[a("thead",null,[a("tr",null,[a("th",{style:c(`color: ${e.value.color};`)},"作品名",4),a("td",null,m(e.value.name),1)]),a("tr",null,[a("th",{style:c(`color: ${e.value.color};`)},"分類",4),a("td",null,m(e.value.category),1)]),a("tr",null,[a("th",{style:c(`color: ${e.value.color};`)},"製造商",4),a("td",null,m(e.value.manufacturers),1)]),a("tr",null,[a("th",{style:c(`color: ${e.value.color};`)},"價格",4),a("td",null,m(e.value.price),1)])])]),_:1},8,["style"])]),_:1}),r(I,{style:c(`color: ${e.value.color};`),class:"txt"},{default:i(()=>[r(Z,{class:"d-flex align-center flex-column justify-center animationfield",style:{"text-align":"center",height:"100%"}},{default:i(()=>[r(I,null,{default:i(()=>[a("p",null,m(e.value.description),1)]),_:1}),r(I,null,{default:i(()=>[r(se,{disabled:w(d),onSubmit:Q(w(P),["prevent"]),style:c(`border-bottom: 15px solid ${e.value.color};`),class:"underline"},{default:i(()=>[r(ee,{modelValue:w(p).value.value,"onUpdate:modelValue":u[0]||(u[0]=s=>w(p).value.value=s),modelModifiers:{number:!0},type:"number",label:"數量",min:"0","error-messages":w(p).errorMessage.value},null,8,["modelValue","error-messages"]),r(O,{style:c(`background-color:${e.value.color};color: ${e.value.textColor};`),type:"submit"},{default:i(()=>[M("加購物車 ")]),_:1},8,["style"]),r(O,{style:c(`background-color:${h.value?e.value.textColor:e.value.color}; color:${h.value?e.value.color:e.value.textColor}`),onClick:j},{default:i(()=>[M(m(h.value?"已加收藏":"加入收藏"),1)]),_:1},8,["style"]),r(O,{style:c(`background-color:${e.value.color};color: ${e.value.textColor};`),onClick:u[1]||(u[1]=s=>S.value=!S.value)},{default:i(()=>[M(" 查看評論 ")]),_:1},8,["style"])]),_:1},8,["disabled","onSubmit","style"])]),_:1})]),_:1})]),_:1},8,["style"])]),_:1})]),_:1})]),_:1})]),_:1}),r(be,{"model-value":!e.value.sell,persistent:"",class:"align-center justify-center text-center"},{default:i(()=>[He,r(O,{to:"/"},{default:i(()=>[M(" 回上頁")]),_:1})]),_:1},8,["model-value"]),r(qe,{modelValue:S.value,"onUpdate:modelValue":u[3]||(u[3]=s=>S.value=s),location:"right",temporary:"",width:"600",style:c(`background-color:${e.value.color};`)},{default:i(()=>[a("div",null,[r(K,{style:c(`color:${e.value.textColor}; background-color:${e.value.color};`)},{default:i(()=>[a("thead",null,[a("tr",null,[a("th",{style:c(`color:${e.value.textColor};`)},"使用者",4),a("th",{style:c(`color:${e.value.textColor};`)},"評論",4),a("th",{style:c(`color:${e.value.textColor};`)},"日期",4),w(y).role===1?(E(),V("th",{key:0,style:c(`color:${e.value.textColor};`)},"審核",4)):z("",!0)])]),a("tbody",null,[w(y).role===0?(E(!0),V(N,{key:0},W(e.value.peopleSay,(s,x)=>(E(),V("tr",{key:x},[s.review?z("",!0):(E(),V(N,{key:0},[a("td",null,m(s.user.name),1),a("td",null,m(s.text),1),a("td",null,m(new Date(s.date).toLocaleString()),1)],64)),s.review?(E(),V(N,{key:1},[a("td",null,m(s.user.name),1),je,a("td",null,m(new Date(s.date).toLocaleString()),1)],64)):z("",!0)]))),128)):z("",!0),w(y).role===1?(E(!0),V(N,{key:1},W(e.value.peopleSay,(s,x)=>(E(),V("tr",{key:x},[a("td",null,[r(X,{style:{display:"inline-block","vertical-align":"middle"},src:`https://source.boringavatars.com/beam/120/${s.user.account}?colors=0db2ac,f5dd7e,fc8d4d,fc694d,faba32`,width:"50px"},null,8,["src"]),M(" "+m(s.user.name),1)]),a("td",null,m(s.text),1),a("td",null,m(new Date(s.date).toLocaleString()),1),a("td",null,[r(O,{onClick:U=>L(x,s.user._id),style:c(`background-color:${s.review?e.value.textColor:e.value.color}; color:${s.review?e.value.color:e.value.textColor}`)},{default:i(()=>[M(m(s.review?"未通過":"已通過"),1)]),_:2},1032,["onClick","style"])])]))),128)):z("",!0)])]),_:1},8,["style"])]),r(O,{onClick:u[2]||(u[2]=s=>g.value=!0),style:c(`background-color:${$.value?e.value.textColor:e.value.color}; color:${$.value?e.value.color:e.value.textColor}`),class:"otherbtn"},{default:i(()=>[M(m($.value?"編輯評論":"新增評論"),1)]),_:1},8,["style"])]),_:1},8,["modelValue","style"]),r(we,{modelValue:g.value,"onUpdate:modelValue":u[5]||(u[5]=s=>g.value=s),width:"auto"},{default:i(()=>[r(se,{disabled:w(_),onSubmit:Q(w(l),["prevent"]),style:{width:"400px"}},{default:i(()=>[r(xe,{style:c(`background-color:${e.value.color};color: ${e.value.textColor};`)},{default:i(()=>[r(Ce,null,{default:i(()=>[r(X,{src:w(y).avatar,style:{width:"20%",display:"inline-block"}},null,8,["src"]),a("span",null,m(w(y).name),1)]),_:1}),r(ke,null,{default:i(()=>[r(ee,{modelValue:w(B).value.value,"onUpdate:modelValue":u[4]||(u[4]=s=>w(B).value.value=s),label:"留言",counter:"",maxlength:"150","error-messages":w(B).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),r(O,{type:"submit",class:"otherbtn",style:c(`background-color:${e.value.textColor};color: ${e.value.color};`)},{default:i(()=>[M(" 確認")]),_:1},8,["style"])]),_:1},8,["style"])]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])]),r(ie,null,{default:i(()=>[a("section",ze,[a("div",{class:"link",style:c(`border-bottom: 5px solid ${e.value.color};`)},[a("span",{style:c(`background-color:${e.value.color};color: ${e.value.textColor};`)}," 關聯商品",4)],4),r(w(re),{effect:"coverflow",grabCursor:!0,centeredSlides:!0,slidesPerView:"auto",coverflowEffect:{rotate:50,stretch:0,depth:100,modifier:1,slideShadows:!0},speed:2e3,pagination:!0,modules:t,class:"mySwiper",initialSlide:2},{default:i(()=>[(E(!0),V(N,null,W(C.value,s=>(E(),te(w(ne),{key:s._id},{default:i(()=>[r(b,{to:/proHome/+s._id},{default:i(()=>[r(X,{src:s.images[0],cover:""},null,8,["src"])]),_:2},1032,["to"])]),_:2},1024))),128))]),_:1})])]),_:1}),Ue],64)}}};export{tt as default};
